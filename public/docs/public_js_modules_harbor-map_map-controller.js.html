<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>public/js/modules/harbor-map/map-controller.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* Dark theme matching app style - carefully scoped to not break layout */
        html, body {
            background-color: #1a1a1a !important;
            color: #e0e0e0 !important;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
            overflow-x: hidden !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Ultra-thin scrollbar with gradient - all webkit browsers */
        ::-webkit-scrollbar {
            width: 5px;
            height: 5px;
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
            border-radius: 2px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #60a5fa 0%, #a78bfa 100%);
            border-radius: 2px;
            border: 1px solid #1a1a1a;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #93c5fd 0%, #c4b5fd 100%);
        }

        ::-webkit-scrollbar-corner {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-button {
            display: none;
            width: 0;
            height: 0;
        }

        /* Specific elements scrollbars */
        body::-webkit-scrollbar,
        nav::-webkit-scrollbar,
        #main::-webkit-scrollbar,
        .container-overview::-webkit-scrollbar,
        pre::-webkit-scrollbar {
            width: 5px;
            height: 5px;
            background: #1a1a1a;
        }

        body::-webkit-scrollbar-thumb,
        nav::-webkit-scrollbar-thumb,
        #main::-webkit-scrollbar-thumb,
        .container-overview::-webkit-scrollbar-thumb,
        pre::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #60a5fa 0%, #a78bfa 100%);
            border-radius: 2px;
            border: 1px solid #1a1a1a;
        }

        body::-webkit-scrollbar-thumb:hover,
        nav::-webkit-scrollbar-thumb:hover,
        #main::-webkit-scrollbar-thumb:hover,
        .container-overview::-webkit-scrollbar-thumb:hover,
        pre::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #93c5fd 0%, #c4b5fd 100%);
        }

        /* Navigation sidebar - remove padding and white borders */
        nav {
            background-color: #242424 !important;
            border-right: 1px solid #404040 !important;
            padding: 0 !important;
            margin: 0 !important;
            overflow-x: hidden !important;
        }

        /* Nav scrollbar - explicit override */
        nav::-webkit-scrollbar {
            width: 5px !important;
            height: 5px !important;
            background: #242424 !important;
        }

        nav::-webkit-scrollbar-track {
            background: #242424 !important;
        }

        nav::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #60a5fa 0%, #a78bfa 100%) !important;
            border-radius: 2px !important;
        }

        nav::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #93c5fd 0%, #c4b5fd 100%) !important;
        }

        nav h2, nav h3 {
            color: #e0e0e0 !important;
            border-bottom: 1px solid #404040 !important;
            padding: 10px 15px !important;
            margin: 0 !important;
            background-color: #242424 !important;
            font-size: 14px !important;
            font-weight: 600 !important;
        }

        nav h3 {
            font-size: 13px !important;
        }

        nav ul {
            padding: 0 !important;
            margin: 0 !important;
            background-color: #242424 !important;
        }

        nav ul li {
            list-style: none !important;
            margin: 0 !important;
            padding: 0 !important;
            background-color: #242424 !important;
        }

        nav ul li a {
            color: #c9d1d9 !important;
            display: block !important;
            padding: 8px 15px !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            background-color: #242424 !important;
            margin: 0 !important;
            border: none !important;
            font-size: 14px !important;
        }

        nav ul li a:hover {
            color: #60a5fa !important;
            background-color: rgba(96, 165, 250, 0.1) !important;
        }

        /* Module links (direct children of nav > ul > li) */
        nav > ul > li > a {
            color: #60a5fa !important;
            font-weight: 600 !important;
            padding: 10px 15px !important;
            font-size: 14px !important;
            border-left: 3px solid #60a5fa !important;
            padding-left: 12px !important;
        }

        nav > ul > li > a:hover {
            background-color: rgba(96, 165, 250, 0.15) !important;
        }

        /* Sub-items (methods/functions) indented */
        nav ul.methods {
            padding-left: 15px !important;
        }

        nav ul.methods li a {
            color: #9ca3af !important;
            font-size: 13px !important;
            padding: 6px 15px !important;
            font-weight: 400 !important;
        }

        nav ul.methods li a:hover {
            color: #c9d1d9 !important;
        }

        nav > h2:first-child {
            font-size: 16px !important;
            font-weight: 700 !important;
            padding: 12px 15px !important;
        }

        /* Main content area - dark background */
        #main {
            background-color: #1a1a1a !important;
            padding: 20px !important;
        }

        /* Article and sections - ensure dark background */
        article, section, .container-overview, .description {
            background-color: #1a1a1a !important;
        }

        /* Images - style demo images */
        img {
            max-width: 100% !important;
            height: auto !important;
            border: 1px solid #404040 !important;
            border-radius: 8px !important;
            margin: 20px 0 !important;
        }

        /* Links */
        a {
            color: #60a5fa !important;
            text-decoration: none !important;
        }

        a:hover {
            color: #93c5fd !important;
            text-decoration: underline !important;
        }

        /* Headings */
        h1, h2, h3, h4, h5, h6 {
            color: #e0e0e0 !important;
            border-bottom-color: #404040 !important;
            background-color: transparent !important;
        }

        h4.name {
            background-color: #2a2a2a !important;
            border: 1px solid #404040 !important;
        }

        /* Code blocks */
        pre {
            background-color: #0d1117 !important;
            border: 1px solid #404040 !important;
        }

        pre code {
            background-color: transparent !important;
        }

        code {
            background-color: #2a2a2a !important;
            color: #e0e0e0 !important;
            padding: 2px 6px !important;
            border-radius: 3px !important;
        }

        /* Tables */
        table {
            border-color: #404040 !important;
            background-color: #1a1a1a !important;
        }

        table thead tr {
            background-color: #242424 !important;
        }

        table tbody tr {
            background-color: #1a1a1a !important;
        }

        table tbody tr:nth-child(even) {
            background-color: #1f1f1f !important;
        }

        table td, table th {
            border-color: #404040 !important;
            color: #e0e0e0 !important;
            background-color: transparent !important;
        }

        .params .name, .props .name {
            color: #10b981 !important;
            font-family: 'Courier New', monospace !important;
        }

        /* Descriptions and details */
        .description, .details, dt, dd, p, ul, ol, dl {
            color: #e0e0e0 !important;
            background-color: transparent !important;
        }

        /* Types */
        .type-signature {
            color: #a78bfa !important;
        }

        /* Source links */
        .details .details-item-container {
            border-left-color: #404040 !important;
        }

        /* Breadcrumbs */
        .page-title {
            color: #e0e0e0 !important;
        }

        /* Search */
        #nav-search {
            background-color: #2a2a2a !important;
            border: 1px solid #404040 !important;
            color: #e0e0e0 !important;
        }

        /* Mobile nav trigger */
        .navicon-button {
            background-color: #2a2a2a !important;
        }

        /* Footer */
        footer {
            background-color: #1a1a1a !important;
            color: #9ca3af !important;
            border-top: 1px solid #404040 !important;
            text-align: center !important;
            padding: 20px !important;
        }

        /* Remove horizontal scrollbar and white borders */
        * {
            box-sizing: border-box !important;
        }
    </style>
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h3>Home</h3><ul><li><a href="index.html">README</a></li></ul><h3>ShippingManager</h3><ul><li><a href="tutorial-03-discovered-formulars.html">Discovered Formulas</a></li><li><a href="https://shippingmanager-api-reference.pages.dev/" target="_blank" rel="noopener noreferrer">API Reference &#8599;</a></li></ul><h3>COPILOT Tutorials</h3><ul><li><a href="tutorial-01-installation-guide.html">Installation</a></li><li><a href="tutorial-02-build-guide.html">Build Guide</a></li><li><a href="tutorial-04-cheatsheet.html">Cheat-Sheet</a></li><li><a href="tutorial-05-beginners-guide.html">Beginners Guide</a></li></ul><h3>COPILOT DOCUMENTATION</h3><ul><li class="nav-list-toggle"><a>Classes</a><ul style="display: none;"><li><a href="module-core_debounced-api.DebouncedAPIManager.html">DebouncedAPIManager</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core_debounced-api.DebouncedAPIManager.html#call">call</a></li><li data-type='method' style='display: none;'><a href="module-core_debounced-api.DebouncedAPIManager.html#cancelAll">cancelAll</a></li><li data-type='method' style='display: none;'><a href="module-core_debounced-api.DebouncedAPIManager.html#get">get</a></li><li data-type='method' style='display: none;'><a href="module-core_debounced-api.DebouncedAPIManager.html#register">register</a></li></ul></li><li><a href="module-server_chatbot-ChatBot.html">ChatBot</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_chatbot-ChatBot.html#initialize">initialize</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot-ChatBot.html#processAllianceMessage">processAllianceMessage</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot-ChatBot.html#processPrivateMessage">processPrivateMessage</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot-ChatBot.html#setupScheduledTasks">setupScheduledTasks</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot-ChatBot.html#updateSettings">updateSettings</a></li></ul></li></ul></li><li class="nav-list-toggle"><a>Modules</a><ul style="display: none;"><li><a href="module-alliance-tabs.html">alliance-tabs</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#.clearAllianceTabCache">clearAllianceTabCache</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#.closeAllianceCoopOverlay">closeAllianceCoopOverlay</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#.getCurrentTab">getCurrentTab</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#.hideAllAllianceUI">hideAllAllianceUI</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#.initAllianceTabs">initAllianceTabs</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#.refreshCurrentTab">refreshCurrentTab</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#.showAllAllianceUI">showAllAllianceUI</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#.showAllianceCoopOverlay">showAllianceCoopOverlay</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#.showAllianceDetailsModal">showAllianceDetailsModal</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#.switchTab">switchTab</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#.updateCoopTabBadge">updateCoopTabBadge</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~acceptUserToAlliance">acceptUserToAlliance</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~appendSearchResults">appendSearchResults</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~attachAllianceClickHandlers">attachAllianceClickHandlers</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~attachApplicationButtonListeners">attachApplicationButtonListeners</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~attachSearchEventListeners">attachSearchEventListeners</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~createAllianceRow">createAllianceRow</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~declineUserFromAlliance">declineUserFromAlliance</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~fetchAllianceInfo">fetchAllianceInfo</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~fetchAllianceInfoById">fetchAllianceInfoById</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~fetchAllianceMembers">fetchAllianceMembers</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~fetchAllianceMembersById">fetchAllianceMembersById</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~fetchAllianceSettings">fetchAllianceSettings</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~fetchHighScores">fetchHighScores</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~fetchLeagueInfo">fetchLeagueInfo</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~fetchQueuePool">fetchQueuePool</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~generateAllianceInfoHTML">generateAllianceInfoHTML</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~handleJoinAllianceClick">handleJoinAllianceClick</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~leaveAlliance">leaveAlliance</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~loadTabContent">loadTabContent</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~loadWelcomeMessage">loadWelcomeMessage</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~normalizeColor">normalizeColor</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~performSearch">performSearch</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~refreshApplicationsQueue">refreshApplicationsQueue</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~renderAllianzTab">renderAllianzTab</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~renderCoopTab">renderCoopTab</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~renderHighScoreTab">renderHighScoreTab</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~renderLigaTab">renderLigaTab</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~renderManagementTab">renderManagementTab</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~renderMemberCard">renderMemberCard</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~renderSearchResults">renderSearchResults</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~renderSearchTab">renderSearchTab</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~renderSettingsTab">renderSettingsTab</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~saveWelcomeMessage">saveWelcomeMessage</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~sendWelcomeMessageToUser">sendWelcomeMessageToUser</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~showDonateDialog">showDonateDialog</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~showTextInputDialog">showTextInputDialog</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~updateAllianceSettings">updateAllianceSettings</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~updateManagementTabVisibility">updateManagementTabVisibility</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~updateTabVisibilityForAllianceMembers">updateTabVisibilityForAllianceMembers</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~updateTabVisibilityForNonMembers">updateTabVisibilityForNonMembers</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~updateUserRole">updateUserRole</a></li><li data-type='method' style='display: none;'><a href="module-alliance-tabs.html#~updateWelcomeMessageCharCount">updateWelcomeMessageCharCount</a></li></ul></li><li><a href="module-analytics.html">analytics</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-analytics.html#.initAnalytics">initAnalytics</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~addApiStatsTab">addApiStatsTab</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~buildPod2Html">buildPod2Html</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~checkAndBuildIndex">checkAndBuildIndex</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~clearPortDemandChart">clearPortDemandChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~closeSoldVesselPanel">closeSoldVesselPanel</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~destroyChart">destroyChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~exportAnalyticsData">exportAnalyticsData</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~formatChartPrice">formatChartPrice</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~formatCurrency">formatCurrency</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~formatPercent">formatPercent</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~getPortDemandChartOptions">getPortDemandChartOptions</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~handleRawTransactionSort">handleRawTransactionSort</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~handleRouteClick">handleRouteClick</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~handleSort">handleSort</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~handleVesselClick">handleVesselClick</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~initSortableHeaders">initSortableHeaders</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~isCacheValid">isCacheValid</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~lazyLoadPorts">lazyLoadPorts</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~lazyLoadRoutes">lazyLoadRoutes</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~lazyLoadVessels">lazyLoadVessels</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~loadAnalyticsData">loadAnalyticsData</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~loadApiStats">loadApiStats</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~loadGameLogData">loadGameLogData</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~loadMoreRawTransactions">loadMoreRawTransactions</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~loadPortDemandChart">loadPortDemandChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~loadRawTransactions">loadRawTransactions</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~populatePortDropdown">populatePortDropdown</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~populateTypeFilter">populateTypeFilter</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~preloadAllTabs">preloadAllTabs</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderApiStatsChart">renderApiStatsChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderApiStatsSummary">renderApiStatsSummary</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderApiStatsTable">renderApiStatsTable</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderBBLChart">renderBBLChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderBottomVesselsRevenueChart">renderBottomVesselsRevenueChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderExpenseTable">renderExpenseTable</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderGameLogChart">renderGameLogChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderGameLogDailyTable">renderGameLogDailyTable</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderGameLogInfo">renderGameLogInfo</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderGameLogTable">renderGameLogTable</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderPortDemandCharts">renderPortDemandCharts</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderQuickSummary">renderQuickSummary</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderRawTransactionsTable">renderRawTransactionsTable</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderRouteTable">renderRouteTable</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderSoldVesselHistory">renderSoldVesselHistory</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderSummary">renderSummary</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderTEUChart">renderTEUChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderTop10Routes">renderTop10Routes</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderTrendChart">renderTrendChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderVesselCharts">renderVesselCharts</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderVesselTable">renderVesselTable</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderVesselsCompositionChart">renderVesselsCompositionChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderVesselsRevenueChart">renderVesselsRevenueChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~renderVesselsUtilizationChart">renderVesselsUtilizationChart</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~setupApiStatsControls">setupApiStatsControls</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~setupRawTransactionsLazyLoading">setupRawTransactionsLazyLoading</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~showLookupEntryDetails">showLookupEntryDetails</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~showRouteVesselsInfoTooltip">showRouteVesselsInfoTooltip</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~showSoldVesselPanel">showSoldVesselPanel</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~sortData">sortData</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~switchTab">switchTab</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~updateFilterName">updateFilterName</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~updateLoadMoreButton">updateLoadMoreButton</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~updatePortDemandStatus">updatePortDemandStatus</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~updatePortVesselMetrics">updatePortVesselMetrics</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~updateRawSortIndicators">updateRawSortIndicators</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~updateRawTransactionCounts">updateRawTransactionCounts</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~updateRouteFilterIcons">updateRouteFilterIcons</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~updateSortIndicators">updateSortIndicators</a></li><li data-type='method' style='display: none;'><a href="module-analytics.html#~updateVesselFilterIcons">updateVesselFilterIcons</a></li></ul></li><li><a href="module-api.html">api</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api.html#.activateCampaign">activateCampaign</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.buildLookup">buildLookup</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.checkCompanyAge">checkCompanyAge</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.checkDevelMode">checkDevelMode</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.clearLookup">clearLookup</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.deleteAllLogs">deleteAllLogs</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.deleteChat">deleteChat</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.departAllVessels">departAllVessels</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.departVessel">departVessel</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.departVessels">departVessels</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.doWearMaintenanceBulk">doWearMaintenanceBulk</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.downloadLogbookExport">downloadLogbookExport</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchAcquirableVessels">fetchAcquirableVessels</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchAllianceMembers">fetchAllianceMembers</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchAssignedPorts">fetchAssignedPorts</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchBunkerPrices">fetchBunkerPrices</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchCampaigns">fetchCampaigns</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchChat">fetchChat</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchContacts">fetchContacts</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchLogbookEntries">fetchLogbookEntries</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchLogbookFileSize">fetchLogbookFileSize</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchMessengerChats">fetchMessengerChats</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchMessengerMessages">fetchMessengerMessages</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchUserCompany">fetchUserCompany</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchUserSettings">fetchUserSettings</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.fetchVessels">fetchVessels</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getAnalyticsAll">getAnalyticsAll</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getAnalyticsOverview">getAnalyticsOverview</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getAnalyticsRoutes">getAnalyticsRoutes</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getAnalyticsSummary">getAnalyticsSummary</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getAnalyticsTrend">getAnalyticsTrend</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getAnalyticsVessels">getAnalyticsVessels</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getApiStats">getApiStats</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getApiStatsDates">getApiStatsDates</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getApiStatsHourly">getApiStatsHourly</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getCompanyNameCached">getCompanyNameCached</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getLookupAll">getLookupAll</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getLookupBreakdown">getLookupBreakdown</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getLookupBuildStatus">getLookupBuildStatus</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getLookupDaily">getLookupDaily</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getLookupDetails">getLookupDetails</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getLookupEntries">getLookupEntries</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getLookupInfo">getLookupInfo</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getLookupTotals">getLookupTotals</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getMaintenanceCost">getMaintenanceCost</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getPortDemandHistory">getPortDemandHistory</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getPortDemandLatest">getPortDemandLatest</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getPortDemandStatus">getPortDemandStatus</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getPortDemandTrends">getPortDemandTrends</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getRecentIpos">getRecentIpos</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getRouteVessels">getRouteVessels</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getStockFinanceOverview">getStockFinanceOverview</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getStockMarket">getStockMarket</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getStockPurchaseTimes">getStockPurchaseTimes</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getTransactionDaily">getTransactionDaily</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getTransactionData">getTransactionData</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getTransactionInfo">getTransactionInfo</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getTransactionList">getTransactionList</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getTransactionSummary">getTransactionSummary</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getTransactionTypes">getTransactionTypes</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.increaseStockForSale">increaseStockForSale</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.markChatAsRead">markChatAsRead</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.purchaseCO2">purchaseCO2</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.purchaseFuel">purchaseFuel</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.purchaseStock">purchaseStock</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.purchaseVessel">purchaseVessel</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.rebuildLookup">rebuildLookup</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.searchUsers">searchUsers</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sellStock">sellStock</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendChatMessage">sendChatMessage</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendPrivateMessage">sendPrivateMessage</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.syncTransactions">syncTransactions</a></li><li data-type='method' style='display: none;'><a href="module-api.html#~verifyVesselPurchased">verifyVesselPurchased</a></li></ul></li><li><a href="module-app.html">app</a></li><li><a href="module-automation.html">automation</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-automation.html#.initAutomation">initAutomation</a></li><li data-type='method' style='display: none;'><a href="module-automation.html#.runAutomationChecks">runAutomationChecks</a></li><li data-type='method' style='display: none;'><a href="module-automation.html#.triggerAutoRebuyChecks">triggerAutoRebuyChecks</a></li><li data-type='method' style='display: none;'><a href="module-automation.html#~calculateRemainingDemand">calculateRemainingDemand</a></li><li data-type='method' style='display: none;'><a href="module-automation.html#~checkAutoCampaignRenewal">checkAutoCampaignRenewal</a></li><li data-type='method' style='display: none;'><a href="module-automation.html#~checkAutoDepartAll">checkAutoDepartAll</a></li><li data-type='method' style='display: none;'><a href="module-automation.html#~checkAutoRebuyCO2">checkAutoRebuyCO2</a></li><li data-type='method' style='display: none;'><a href="module-automation.html#~checkAutoRebuyFuel">checkAutoRebuyFuel</a></li><li data-type='method' style='display: none;'><a href="module-automation.html#~getTotalCapacity">getTotalCapacity</a></li><li data-type='method' style='display: none;'><a href="module-automation.html#~performAutoRebuyCO2">performAutoRebuyCO2</a></li><li data-type='method' style='display: none;'><a href="module-automation.html#~performAutoRebuyFuel">performAutoRebuyFuel</a></li><li data-type='method' style='display: none;'><a href="module-automation.html#~updateAutoDepartLabel">updateAutoDepartLabel</a></li></ul></li><li><a href="module-badge-manager.html">badge-manager</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-badge-manager.html#.getBadgeCount">getBadgeCount</a></li><li data-type='method' style='display: none;'><a href="module-badge-manager.html#.hideBadge">hideBadge</a></li><li data-type='method' style='display: none;'><a href="module-badge-manager.html#.showBadge">showBadge</a></li><li data-type='method' style='display: none;'><a href="module-badge-manager.html#.updateBadge">updateBadge</a></li><li data-type='method' style='display: none;'><a href="module-badge-manager.html#.updateButtonState">updateButtonState</a></li><li data-type='method' style='display: none;'><a href="module-badge-manager.html#.updateButtonTooltip">updateButtonTooltip</a></li><li data-type='method' style='display: none;'><a href="module-badge-manager.html#.updateButtonVisibility">updateButtonVisibility</a></li></ul></li><li><a href="module-broadcast.html">broadcast</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-broadcast.html#.initBroadcast">initBroadcast</a></li><li data-type='method' style='display: none;'><a href="module-broadcast.html#.initBroadcastForManagement">initBroadcastForManagement</a></li><li data-type='method' style='display: none;'><a href="module-broadcast.html#~deleteTemplate">deleteTemplate</a></li><li data-type='method' style='display: none;'><a href="module-broadcast.html#~editTemplate">editTemplate</a></li><li data-type='method' style='display: none;'><a href="module-broadcast.html#~loadTemplates">loadTemplates</a></li><li data-type='method' style='display: none;'><a href="module-broadcast.html#~renderTemplateList">renderTemplateList</a></li><li data-type='method' style='display: none;'><a href="module-broadcast.html#~saveTemplate">saveTemplate</a></li><li data-type='method' style='display: none;'><a href="module-broadcast.html#~toggleTemplate">toggleTemplate</a></li><li data-type='method' style='display: none;'><a href="module-broadcast.html#~updateMessageCounter">updateMessageCounter</a></li></ul></li><li><a href="module-bunker-management.html">bunker-management</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-bunker-management.html#.buyMaxCO2">buyMaxCO2</a></li><li data-type='method' style='display: none;'><a href="module-bunker-management.html#.buyMaxFuel">buyMaxFuel</a></li><li data-type='method' style='display: none;'><a href="module-bunker-management.html#.getCurrentBunkerState">getCurrentBunkerState</a></li><li data-type='method' style='display: none;'><a href="module-bunker-management.html#.setCapacityFromBunkerUpdate">setCapacityFromBunkerUpdate</a></li><li data-type='method' style='display: none;'><a href="module-bunker-management.html#.updateBunkerStatus">updateBunkerStatus</a></li><li data-type='method' style='display: none;'><a href="module-bunker-management.html#.updateCurrentCO2">updateCurrentCO2</a></li><li data-type='method' style='display: none;'><a href="module-bunker-management.html#.updateCurrentCash">updateCurrentCash</a></li><li data-type='method' style='display: none;'><a href="module-bunker-management.html#.updateCurrentFuel">updateCurrentFuel</a></li></ul></li><li><a href="module-changelog-popup.html">changelog-popup</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-changelog-popup.html#.checkAndShowChangelog">checkAndShowChangelog</a></li><li data-type='method' style='display: none;'><a href="module-changelog-popup.html#.handleChangelogAcknowledged">handleChangelogAcknowledged</a></li><li data-type='method' style='display: none;'><a href="module-changelog-popup.html#.initChangelogPopup">initChangelogPopup</a></li><li data-type='method' style='display: none;'><a href="module-changelog-popup.html#~closeChangelogPopup">closeChangelogPopup</a></li><li data-type='method' style='display: none;'><a href="module-changelog-popup.html#~showChangelogPopup">showChangelogPopup</a></li></ul></li><li><a href="module-chat.html">chat</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-chat.html#.displayMessages">displayMessages</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#.handleMessageInput">handleMessageInput</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#.initWebSocket">initWebSocket</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#.loadAllianceMembers">loadAllianceMembers</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#.loadMessages">loadMessages</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#.markAllianceChatAsRead">markAllianceChatAsRead</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#.parseMessageWithMentions">parseMessageWithMentions</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#.sendMessage">sendMessage</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#.setChatScrollListener">setChatScrollListener</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~attemptReconnect">attemptReconnect</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~displaySuggestions">displaySuggestions</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~formatLocalTime">formatLocalTime</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleAllianceChanged">handleAllianceChanged</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleAllianceIndexReady">handleAllianceIndexReady</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleAutoCoopComplete">handleAutoCoopComplete</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleAutoCoopNoTargets">handleAutoCoopNoTargets</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleAutopilotDepartStart">handleAutopilotDepartStart</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleBackendAutoRepairComplete">handleBackendAutoRepairComplete</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleBunkerUpdate">handleBunkerUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleCO2Purchased">handleCO2Purchased</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleCampaignsRenewed">handleCampaignsRenewed</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleCompanyTypeUpdate">handleCompanyTypeUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleCoopUpdate">handleCoopUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleDesktopNotification">handleDesktopNotification</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleDrydockCountUpdate">handleDrydockCountUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleFuelPurchased">handleFuelPurchased</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleGenericNotification">handleGenericNotification</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleHarborMapRefreshRequired">handleHarborMapRefreshRequired</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleHeaderDataUpdate">handleHeaderDataUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleHijackingUpdate">handleHijackingUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleIpoAlertUpdate">handleIpoAlertUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleMentionAutocomplete">handleMentionAutocomplete</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleMessengerUpdate">handleMessengerUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handlePriceAlert">handlePriceAlert</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handlePriceUpdate">handlePriceUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handlePurserPurchase">handlePurserPurchase</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handlePurserSell">handlePurserSell</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleRepairCountUpdate">handleRepairCountUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleStaffTrainingPointsUpdate">handleStaffTrainingPointsUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleStaffUpdate">handleStaffUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleUnreadMessagesUpdate">handleUnreadMessagesUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleUserActionNotification">handleUserActionNotification</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleVesselCountUpdate">handleVesselCountUpdate</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleVesselsDepartBatch">handleVesselsDepartBatch</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleVesselsDepartComplete">handleVesselsDepartComplete</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleVesselsDeparted">handleVesselsDeparted</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleVesselsDrydocked">handleVesselsDrydocked</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleVesselsFailed">handleVesselsFailed</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~handleVesselsRepaired">handleVesselsRepaired</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~hideMemberSuggestions">hideMemberSuggestions</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~insertMention">insertMention</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~registerUsernameClickEvents">registerUsernameClickEvents</a></li><li data-type='method' style='display: none;'><a href="module-chat.html#~updateAllianceChatBadge">updateAllianceChatBadge</a></li></ul></li><li><a href="module-company-profile.html">company-profile</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-company-profile.html#.closeCompanyProfile">closeCompanyProfile</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#.initCompanyProfile">initCompanyProfile</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#.openCompanyProfile">openCompanyProfile</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#.openPlayerProfile">openPlayerProfile</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~addToContacts">addToContacts</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~adjustSalary">adjustSalary</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~attachAllianceClickListener">attachAllianceClickListener</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~attachSalaryButtonListeners">attachSalaryButtonListeners</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~attachStockActionListeners">attachStockActionListeners</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~buildAchievementsSection">buildAchievementsSection</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~buildSection">buildSection</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~buildStaffSection">buildStaffSection</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~dismissStaffPointsBanner">dismissStaffPointsBanner</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~formatLabel">formatLabel</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~formatMoraleLabel">formatMoraleLabel</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~formatPerkName">formatPerkName</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~formatValue">formatValue</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~generateMoraleSmiley">generateMoraleSmiley</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~loadAllianceDetails">loadAllianceDetails</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~loadCompanyProfile">loadCompanyProfile</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~loadStaffData">loadStaffData</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~loadStockSection">loadStockSection</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~normalizeColor">normalizeColor</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~removeFromContacts">removeFromContacts</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~renderCompanyProfile">renderCompanyProfile</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~renderSearchResults">renderSearchResults</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~searchPlayers">searchPlayers</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~startStockSellTimer">startStockSellTimer</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~toggleAchievementsList">toggleAchievementsList</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~toggleStaffDetails">toggleStaffDetails</a></li><li data-type='method' style='display: none;'><a href="module-company-profile.html#~trainPerk">trainPerk</a></li></ul></li><li><a href="module-coop.html">coop</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-coop.html#.closeCoopOverlay">closeCoopOverlay</a></li><li data-type='method' style='display: none;'><a href="module-coop.html#.fetchCoopData">fetchCoopData</a></li><li data-type='method' style='display: none;'><a href="module-coop.html#.sendCoopMax">sendCoopMax</a></li><li data-type='method' style='display: none;'><a href="module-coop.html#.showCoopOverlay">showCoopOverlay</a></li><li data-type='method' style='display: none;'><a href="module-coop.html#.updateCoopBadge">updateCoopBadge</a></li><li data-type='method' style='display: none;'><a href="module-coop.html#~renderMemberCard">renderMemberCard</a></li></ul></li><li><a href="module-core_app-initializer.html">core/app-initializer</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#.initializeApp">initializeApp</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~createAllianceChatHandler">createAllianceChatHandler</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~createBuyVesselsHandler">createBuyVesselsHandler</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~createDebouncedFunctions">createDebouncedFunctions</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~createForecastHandler">createForecastHandler</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~createTestBrowserNotification">createTestBrowserNotification</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~exposeGlobalFunctions">exposeGlobalFunctions</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~formatNumberWithSeparator">formatNumberWithSeparator</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~initializeSettingsUI">initializeSettingsUI</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~loadInitialData">loadInitialData</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~loadPortsDataGlobal">loadPortsDataGlobal</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~loadUserSettings">loadUserSettings</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~registerAllEventListeners">registerAllEventListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~setCheckboxState">setCheckboxState</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~setCheckboxValue">setCheckboxValue</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~setFormattedInputValue">setFormattedInputValue</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~setInputValue">setInputValue</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~setSelectValue">setSelectValue</a></li><li data-type='method' style='display: none;'><a href="module-core_app-initializer.html#~toggleElementVisibility">toggleElementVisibility</a></li></ul></li><li><a href="module-core_auto-refresh.html">core/auto-refresh</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core_auto-refresh.html#.getActiveIntervals">getActiveIntervals</a></li><li data-type='method' style='display: none;'><a href="module-core_auto-refresh.html#.initNotificationButtonUpdater">initNotificationButtonUpdater</a></li><li data-type='method' style='display: none;'><a href="module-core_auto-refresh.html#.initVersionChecker">initVersionChecker</a></li><li data-type='method' style='display: none;'><a href="module-core_auto-refresh.html#.initVisibilityHandler">initVisibilityHandler</a></li><li data-type='method' style='display: none;'><a href="module-core_auto-refresh.html#.preloadAllImages">preloadAllImages</a></li><li data-type='method' style='display: none;'><a href="module-core_auto-refresh.html#.stopAllIntervals">stopAllIntervals</a></li><li data-type='method' style='display: none;'><a href="module-core_auto-refresh.html#.stopInterval">stopInterval</a></li></ul></li><li><a href="module-core_badge-cache.html">core/badge-cache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core_badge-cache.html#.loadCache">loadCache</a></li><li data-type='method' style='display: none;'><a href="module-core_badge-cache.html#.saveBadgeCache">saveBadgeCache</a></li><li data-type='method' style='display: none;'><a href="module-core_badge-cache.html#.updateCoopDisplay">updateCoopDisplay</a></li><li data-type='method' style='display: none;'><a href="module-core_badge-cache.html#~loadBunkerStatus">loadBunkerStatus</a></li><li data-type='method' style='display: none;'><a href="module-core_badge-cache.html#~loadCampaignsBadge">loadCampaignsBadge</a></li><li data-type='method' style='display: none;'><a href="module-core_badge-cache.html#~loadCoopData">loadCoopData</a></li><li data-type='method' style='display: none;'><a href="module-core_badge-cache.html#~loadHijackingBadge">loadHijackingBadge</a></li><li data-type='method' style='display: none;'><a href="module-core_badge-cache.html#~loadPrices">loadPrices</a></li><li data-type='method' style='display: none;'><a href="module-core_badge-cache.html#~loadRepairBadges">loadRepairBadges</a></li><li data-type='method' style='display: none;'><a href="module-core_badge-cache.html#~loadStockAndAnchor">loadStockAndAnchor</a></li><li data-type='method' style='display: none;'><a href="module-core_badge-cache.html#~loadVesselBadges">loadVesselBadges</a></li></ul></li><li><a href="module-core_debounced-api.html">core/debounced-api</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core_debounced-api.html#.cancelAllDebouncedFunctions">cancelAllDebouncedFunctions</a></li><li data-type='method' style='display: none;'><a href="module-core_debounced-api.html#.cancelDebouncedFunction">cancelDebouncedFunction</a></li><li data-type='method' style='display: none;'><a href="module-core_debounced-api.html#.createDebouncedFunction">createDebouncedFunction</a></li><li data-type='method' style='display: none;'><a href="module-core_debounced-api.html#.isDebouncePending">isDebouncePending</a></li></ul></li><li><a href="module-core_event-registry.html">core/event-registry</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerAutoDepartSettingsListeners">registerAutoDepartSettingsListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerAutoPilotFeatureListeners">registerAutoPilotFeatureListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerAutoPilotListeners">registerAutoPilotListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerAutoRebuyCO2Listeners">registerAutoRebuyCO2Listeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerAutoRebuyFuelListeners">registerAutoRebuyFuelListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerBunkerListeners">registerBunkerListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerChatBotSettingsListeners">registerChatBotSettingsListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerChatEventListeners">registerChatEventListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerCustomCommandsListeners">registerCustomCommandsListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerDialogEventListeners">registerDialogEventListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerIntelligentRebuyListeners">registerIntelligentRebuyListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerMessengerEventListeners">registerMessengerEventListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerNotificationPermissionListener">registerNotificationPermissionListener</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerNumberFormatting">registerNumberFormatting</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerSectionToggle">registerSectionToggle</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerSettingsThresholdListeners">registerSettingsThresholdListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#.registerVesselCatalogEventListeners">registerVesselCatalogEventListeners</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#~createCustomCommandElement">createCustomCommandElement</a></li><li data-type='method' style='display: none;'><a href="module-core_event-registry.html#~formatNumberWithSeparator">formatNumberWithSeparator</a></li></ul></li><li><a href="module-core_global-exports.html">core/global-exports</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core_global-exports.html#.exportApiUrl">exportApiUrl</a></li><li data-type='method' style='display: none;'><a href="module-core_global-exports.html#.exportAutopilotFunctions">exportAutopilotFunctions</a></li><li data-type='method' style='display: none;'><a href="module-core_global-exports.html#.exportCacheKeys">exportCacheKeys</a></li><li data-type='method' style='display: none;'><a href="module-core_global-exports.html#.exportDebouncedFunctions">exportDebouncedFunctions</a></li><li data-type='method' style='display: none;'><a href="module-core_global-exports.html#.exportDebugMode">exportDebugMode</a></li><li data-type='method' style='display: none;'><a href="module-core_global-exports.html#.exportGlobals">exportGlobals</a></li><li data-type='method' style='display: none;'><a href="module-core_global-exports.html#.exportLogbookHandler">exportLogbookHandler</a></li><li data-type='method' style='display: none;'><a href="module-core_global-exports.html#.exportOverlayFunctions">exportOverlayFunctions</a></li><li data-type='method' style='display: none;'><a href="module-core_global-exports.html#.exportSettingsHandler">exportSettingsHandler</a></li><li data-type='method' style='display: none;'><a href="module-core_global-exports.html#.exportStorageFunctions">exportStorageFunctions</a></li><li data-type='method' style='display: none;'><a href="module-core_global-exports.html#.exportVersionFunctions">exportVersionFunctions</a></li></ul></li><li><a href="module-core_logger.html">core/logger</a></li><li><a href="module-core_settings-sync.html">core/settings-sync</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core_settings-sync.html#.handleSettingsUpdate">handleSettingsUpdate</a></li><li data-type='method' style='display: none;'><a href="module-core_settings-sync.html#.toggleAutoPilotAgentCheckboxes">toggleAutoPilotAgentCheckboxes</a></li><li data-type='method' style='display: none;'><a href="module-core_settings-sync.html#~formatNumberWithSeparator">formatNumberWithSeparator</a></li><li data-type='method' style='display: none;'><a href="module-core_settings-sync.html#~updateAutoPilotToggles">updateAutoPilotToggles</a></li><li data-type='method' style='display: none;'><a href="module-core_settings-sync.html#~updateAutoRebuyCO2UI">updateAutoRebuyCO2UI</a></li><li data-type='method' style='display: none;'><a href="module-core_settings-sync.html#~updateAutoRebuyFuelUI">updateAutoRebuyFuelUI</a></li><li data-type='method' style='display: none;'><a href="module-core_settings-sync.html#~updateChatBotSettings">updateChatBotSettings</a></li><li data-type='method' style='display: none;'><a href="module-core_settings-sync.html#~updateNotificationSettings">updateNotificationSettings</a></li><li data-type='method' style='display: none;'><a href="module-core_settings-sync.html#~updateThresholdInputs">updateThresholdInputs</a></li></ul></li><li><a href="module-core_storage-manager.html">core/storage-manager</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core_storage-manager.html#.clearUserStorage">clearUserStorage</a></li><li data-type='method' style='display: none;'><a href="module-core_storage-manager.html#.getStorage">getStorage</a></li><li data-type='method' style='display: none;'><a href="module-core_storage-manager.html#.getUserStorageKey">getUserStorageKey</a></li><li data-type='method' style='display: none;'><a href="module-core_storage-manager.html#.getUserStoragePrefix">getUserStoragePrefix</a></li><li data-type='method' style='display: none;'><a href="module-core_storage-manager.html#.removeStorage">removeStorage</a></li><li data-type='method' style='display: none;'><a href="module-core_storage-manager.html#.setStorage">setStorage</a></li><li data-type='method' style='display: none;'><a href="module-core_storage-manager.html#.setUserStoragePrefix">setUserStoragePrefix</a></li></ul></li><li><a href="module-core_websocket-client.html">core/websocket-client</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-core_websocket-client.html#.getWebSocketState">getWebSocketState</a></li><li data-type='method' style='display: none;'><a href="module-core_websocket-client.html#.incrementReconnectCounter">incrementReconnectCounter</a></li><li data-type='method' style='display: none;'><a href="module-core_websocket-client.html#.initAutopilotControls">initAutopilotControls</a></li><li data-type='method' style='display: none;'><a href="module-core_websocket-client.html#.loadAutopilotState">loadAutopilotState</a></li><li data-type='method' style='display: none;'><a href="module-core_websocket-client.html#.resetReconnectCounter">resetReconnectCounter</a></li><li data-type='method' style='display: none;'><a href="module-core_websocket-client.html#.triggerPriceAlertCheck">triggerPriceAlertCheck</a></li><li data-type='method' style='display: none;'><a href="module-core_websocket-client.html#.updateWebSocketState">updateWebSocketState</a></li></ul></li><li><a href="module-depart-manager.html">depart-manager</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-depart-manager.html#.closeDepartManager">closeDepartManager</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#.initializeDepartManager">initializeDepartManager</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#.openDepartManager">openDepartManager</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#.refreshDepartManagerIfOpen">refreshDepartManagerIfOpen</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#.toggleDepartManager">toggleDepartManager</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#.updateDepartManagerLockState">updateDepartManagerLockState</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~addMassMoorEventHandlers">addMassMoorEventHandlers</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~addVesselItemEventHandlers">addVesselItemEventHandlers</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~clearSearch">clearSearch</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~departSelectedVessels">departSelectedVessels</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~drag">drag</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~formatDuration">formatDuration</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~formatETA">formatETA</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~formatLoadingStatus">formatLoadingStatus</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~getLoadingStatus">getLoadingStatus</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~getPortDrydock">getPortDrydock</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~getStatusInfo">getStatusInfo</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~getVesselStatusText">getVesselStatusText</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~loadPortsData">loadPortsData</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~loadVesselsByStatus">loadVesselsByStatus</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~locateVesselOnMap">locateVesselOnMap</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~moorSelectedVessels">moorSelectedVessels</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~renderDrydockEnrouteItem">renderDrydockEnrouteItem</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~renderDrydockTab">renderDrydockTab</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~renderMassMoorTab">renderMassMoorTab</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~renderMassMoorVesselItem">renderMassMoorVesselItem</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~renderVesselItem">renderVesselItem</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~resumeSelectedVessels">resumeSelectedVessels</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~searchVesselsAcrossTabs">searchVesselsAcrossTabs</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~selectAllVessels">selectAllVessels</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~selectVesselRouteOnMap">selectVesselRouteOnMap</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~startDrag">startDrag</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~stopDrag">stopDrag</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~unselectAllVessels">unselectAllVessels</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~updateAnchorTabCount">updateAnchorTabCount</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~updateAtPortTabCount">updateAtPortTabCount</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~updateAtSeaTabCount">updateAtSeaTabCount</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~updateDepartButtonCount">updateDepartButtonCount</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~updateDryDockTabCount">updateDryDockTabCount</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~updateMassMoorButtonCounts">updateMassMoorButtonCounts</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~updateMoorResumeButtonCounts">updateMoorResumeButtonCounts</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~updateMoorTabCount">updateMoorTabCount</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~updatePendingTabCount">updatePendingTabCount</a></li><li data-type='method' style='display: none;'><a href="module-depart-manager.html#~updateVesselMoorState">updateVesselMoorState</a></li></ul></li><li><a href="module-desktop-notification-templates.html">desktop-notification-templates</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-desktop-notification-templates.html#.createDesktopNotification">createDesktopNotification</a></li><li data-type='method' style='display: none;'><a href="module-desktop-notification-templates.html#.getDefaultEmoji">getDefaultEmoji</a></li><li data-type='method' style='display: none;'><a href="module-desktop-notification-templates.html#.getNotificationTypes">getNotificationTypes</a></li><li data-type='method' style='display: none;'><a href="module-desktop-notification-templates.html#.isValidNotificationType">isValidNotificationType</a></li><li data-type='method' style='display: none;'><a href="module-desktop-notification-templates.html#.notifyAlert">notifyAlert</a></li><li data-type='method' style='display: none;'><a href="module-desktop-notification-templates.html#.notifyError">notifyError</a></li><li data-type='method' style='display: none;'><a href="module-desktop-notification-templates.html#.notifySuccess">notifySuccess</a></li><li data-type='method' style='display: none;'><a href="module-desktop-notification-templates.html#.notifyWarning">notifyWarning</a></li></ul></li><li><a href="module-event-info.html">event-info</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-event-info.html#.initEventInfo">initEventInfo</a></li><li data-type='method' style='display: none;'><a href="module-event-info.html#.openEventModal">openEventModal</a></li><li data-type='method' style='display: none;'><a href="module-event-info.html#.updateEventData">updateEventData</a></li><li data-type='method' style='display: none;'><a href="module-event-info.html#~startEventTimer">startEventTimer</a></li></ul></li><li><a href="module-forecast-calendar.html">forecast-calendar</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#.initForecastCalendar">initForecastCalendar</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#.updateEventDiscount">updateEventDiscount</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#~createTableHTML">createTableHTML</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#~getBrowserTimezone">getBrowserTimezone</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#~getCo2Class">getCo2Class</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#~getCurrentVisibleDay">getCurrentVisibleDay</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#~getFuelClass">getFuelClass</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#~isEventActiveAtTime">isEventActiveAtTime</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#~isEventActiveOnDay">isEventActiveOnDay</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#~loadForecastData">loadForecastData</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#~preloadMonth">preloadMonth</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#~renderBook">renderBook</a></li><li data-type='method' style='display: none;'><a href="module-forecast-calendar.html#~updateEventBadge">updateEventBadge</a></li></ul></li><li><a href="module-harbor-map-aggregator.html">harbor-map-aggregator</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-harbor-map-aggregator.html#~aggregateReachablePorts">aggregateReachablePorts</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-aggregator.html#~aggregateVesselData">aggregateVesselData</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-aggregator.html#~categorizeVesselsByPort">categorizeVesselsByPort</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-aggregator.html#~extractPortsFromGameIndex">extractPortsFromGameIndex</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-aggregator.html#~extractVesselsFromGameIndex">extractVesselsFromGameIndex</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-aggregator.html#~filterAssignedPorts">filterAssignedPorts</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-aggregator.html#~formatPortAbbreviation">formatPortAbbreviation</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-aggregator.html#~groupVesselsByPortPair">groupVesselsByPortPair</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-aggregator.html#~hasOwnImage">hasOwnImage</a></li></ul></li><li><a href="module-harbor-map-calculator.html">harbor-map-calculator</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-harbor-map-calculator.html#~calculateCargoUtilization">calculateCargoUtilization</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-calculator.html#~calculateDemandLevel">calculateDemandLevel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-calculator.html#~calculateETA">calculateETA</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-calculator.html#~calculateVesselPosition">calculateVesselPosition</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-calculator.html#~formatCargoCapacity">formatCargoCapacity</a></li></ul></li><li><a href="module-harbor-map-init.html">harbor-map-init</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#.closeHarborMap">closeHarborMap</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#.forceRefreshMap">forceRefreshMap</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#.initHarborMap">initHarborMap</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#.openHarborMap">openHarborMap</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#.preloadHarborMapData">preloadHarborMapData</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#.refreshHarborMapIfOpen">refreshHarborMapIfOpen</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#.reloadMap">reloadMap</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#.startHarborMapAutoUpdate">startHarborMapAutoUpdate</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#.stopHarborMapAutoUpdate">stopHarborMapAutoUpdate</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#~departVesselWrapper">departVesselWrapper</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#~getVesselByIdWrapper">getVesselByIdWrapper</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#~selectVesselFromMap">selectVesselFromMap</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#~sellVesselFromPanelWrapper">sellVesselFromPanelWrapper</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map-init.html#~updateVesselMarkerWrapper">updateVesselMarkerWrapper</a></li></ul></li><li><a href="module-harbor-map_api-client.html">harbor-map/api-client</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-harbor-map_api-client.html#.clearHarborMapCache">clearHarborMapCache</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_api-client.html#.clearOverviewCache">clearOverviewCache</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_api-client.html#.exportVesselHistory">exportVesselHistory</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_api-client.html#.fetchHarborMapOverview">fetchHarborMapOverview</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_api-client.html#.fetchPortDetails">fetchPortDetails</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_api-client.html#.fetchVesselHistory">fetchVesselHistory</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_api-client.html#.fetchVesselReachablePorts">fetchVesselReachablePorts</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_api-client.html#.getCachedOverview">getCachedOverview</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_api-client.html#.invalidateOverviewCache">invalidateOverviewCache</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_api-client.html#.prefetchHarborMapData">prefetchHarborMapData</a></li></ul></li><li><a href="module-harbor-map_filters.html">harbor-map/filters</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.applyDemandFilter">applyDemandFilter</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.calculatePortCurrentCargoDemand">calculatePortCurrentCargoDemand</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.calculatePortCurrentOilDemand">calculatePortCurrentOilDemand</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.calculatePortMaxCargoDemand">calculatePortMaxCargoDemand</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.calculatePortMaxOilDemand">calculatePortMaxOilDemand</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.filterPorts">filterPorts</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.filterPortsByPortPair">filterPortsByPortPair</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.filterVessels">filterVessels</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.filterVesselsByPortPair">filterVesselsByPortPair</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.getDemandFilterOptions">getDemandFilterOptions</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.getPortFilterOptions">getPortFilterOptions</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#.getVesselFilterOptions">getVesselFilterOptions</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_filters.html#~calculateVesselUtilization">calculateVesselUtilization</a></li></ul></li><li><a href="module-harbor-map_map-controller.html">harbor-map/map-controller</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.clearRoute">clearRoute</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.closeAllPanels">closeAllPanels</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.deselectAll">deselectAll</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.drawRoute">drawRoute</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.getCurrentPorts">getCurrentPorts</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.getMap">getMap</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.getOverviewData">getOverviewData</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.getSelectedPortCode">getSelectedPortCode</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.getVesselById">getVesselById</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.highlightPorts">highlightPorts</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.initMap">initMap</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.loadOverview">loadOverview</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.renderPorts">renderPorts</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.renderVessels">renderVessels</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.resetPortDisplay">resetPortDisplay</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.selectPort">selectPort</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.selectVessel">selectVessel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.setPortFilter">setPortFilter</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.setRouteFilter">setRouteFilter</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.setVesselFilter">setVesselFilter</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.updateVesselMarker">updateVesselMarker</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#.updateWeatherDataSetting">updateWeatherDataSetting</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~addCustomControls">addCustomControls</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~applyFilterModalSelections">applyFilterModalSelections</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~applyFiltersAndRender">applyFiltersAndRender</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~applyMapTheme">applyMapTheme</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~calculateHeading">calculateHeading</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~categorizeVesselsByPortClientSide">categorizeVesselsByPortClientSide</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~changeTileLayer">changeTileLayer</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~closeFilterModal">closeFilterModal</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~createVesselIcon">createVesselIcon</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~getVesselType">getVesselType</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~hideRouteVesselsPanel">hideRouteVesselsPanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~initFilterModalDrag">initFilterModalDrag</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~onFilterModalDrag">onFilterModalDrag</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~onFilterModalDragEnd">onFilterModalDragEnd</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~openFilterModal">openFilterModal</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~populateFilterModalDropdowns">populateFilterModalDropdowns</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~resetAllFilters">resetAllFilters</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~showRouteVesselsPanel">showRouteVesselsPanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~showWeatherInfo">showWeatherInfo</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~toggleWeatherLayer">toggleWeatherLayer</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~updateDemandFilterDropdowns">updateDemandFilterDropdowns</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_map-controller.html#~updateRouteDropdown">updateRouteDropdown</a></li></ul></li><li><a href="module-harbor-map_panel-drag.html">harbor-map/panel-drag</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-harbor-map_panel-drag.html#.initializePanelDrag">initializePanelDrag</a></li></ul></li><li><a href="module-harbor-map_port-panel.html">harbor-map/port-panel</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#.closePortPanel">closePortPanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#.fetchAndUpdatePortDemand">fetchAndUpdatePortDemand</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#.hidePortPanel">hidePortPanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#.selectVesselFromPort">selectVesselFromPort</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#.showPortPanel">showPortPanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#~formatPortFullName">formatPortFullName</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#~loadPortAllianceData">loadPortAllianceData</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#~loadPortWeather">loadPortWeather</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#~openAllianceModal">openAllianceModal</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#~renderDemandSection">renderDemandSection</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#~renderTypicalDemandSection">renderTypicalDemandSection</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#~renderVesselList">renderVesselList</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_port-panel.html#~renderVesselsOverview">renderVesselsOverview</a></li></ul></li><li><a href="module-harbor-map_route-vessels-panel.html">harbor-map/route-vessels-panel</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-harbor-map_route-vessels-panel.html#.closeRoutePanel">closeRoutePanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_route-vessels-panel.html#.hideRoutePanel">hideRoutePanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_route-vessels-panel.html#.selectRouteVessel">selectRouteVessel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_route-vessels-panel.html#.showRoutePanel">showRoutePanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_route-vessels-panel.html#~storeVessels">storeVessels</a></li></ul></li><li><a href="module-harbor-map_vessel-panel.html">harbor-map/vessel-panel</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.closeVesselPanel">closeVesselPanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.departVessel">departVessel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.exportHistoryFormat">exportHistoryFormat</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.getCurrentVesselId">getCurrentVesselId</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.hideVesselPanel">hideVesselPanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.isLocalDepartInProgress">isLocalDepartInProgress</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.refreshOpenVesselPanel">refreshOpenVesselPanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.sellVesselFromPanel">sellVesselFromPanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.showVesselPanel">showVesselPanel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.startRenameVessel">startRenameVessel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.toggleExportMenu">toggleExportMenu</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#.updateVesselPanelDepartButtons">updateVesselPanelDepartButtons</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~cancelVesselRename">cancelVesselRename</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~closeExportMenuOnClickOutside">closeExportMenuOnClickOutside</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~formatLoadingStatusText">formatLoadingStatusText</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~formatTimeRemaining">formatTimeRemaining</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~formatVesselStatus">formatVesselStatus</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~getCountryFlag">getCountryFlag</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~getLoadingStatus">getLoadingStatus</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~getPortCountryCode">getPortCountryCode</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~loadRoutePortDemands">loadRoutePortDemands</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~loadVesselHistory">loadVesselHistory</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~loadVesselWeather">loadVesselWeather</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~openRepairDialog">openRepairDialog</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~openVesselAppearanceEditor">openVesselAppearanceEditor</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~processDepartureQueue">processDepartureQueue</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~renderHistoryPage">renderHistoryPage</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~saveVesselRename">saveVesselRename</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~setupInfiniteScroll">setupInfiniteScroll</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~toggleParkVessel">toggleParkVessel</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~updateVesselCardName">updateVesselCardName</a></li><li data-type='method' style='display: none;'><a href="module-harbor-map_vessel-panel.html#~updateVesselNameInShipsMenu">updateVesselNameInShipsMenu</a></li></ul></li><li><a href="module-logbook.html">logbook</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-logbook.html#.deleteAllLogsConfirmed">deleteAllLogsConfirmed</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#.getLogFileSize">getLogFileSize</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#.initLogbook">initLogbook</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#.prependLogEntry">prependLogEntry</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~applyFiltersToEntries">applyFiltersToEntries</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~convertActionFilterToBackend">convertActionFilterToBackend</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~createLogEntryHTML">createLogEntryHTML</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~ensureScrollable">ensureScrollable</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~exportLogs">exportLogs</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~formatDetails">formatDetails</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~formatTimestamp">formatTimestamp</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~getTransactionType">getTransactionType</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~loadLogs">loadLogs</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~renderLogPage">renderLogPage</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~renderLogTable">renderLogTable</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~setupEventListeners">setupEventListeners</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~updateActionFilter">updateActionFilter</a></li><li data-type='method' style='display: none;'><a href="module-logbook.html#~updateLogCount">updateLogCount</a></li></ul></li><li><a href="module-map-icon-bar.html">map-icon-bar</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-map-icon-bar.html#.closeAllModalOverlays">closeAllModalOverlays</a></li><li data-type='method' style='display: none;'><a href="module-map-icon-bar.html#.initializeMapIconBar">initializeMapIconBar</a></li><li data-type='method' style='display: none;'><a href="module-map-icon-bar.html#~handleIconAction">handleIconAction</a></li></ul></li><li><a href="module-messenger.html">messenger</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-messenger.html#.closeAllChats">closeAllChats</a></li><li data-type='method' style='display: none;'><a href="module-messenger.html#.closeChatSelection">closeChatSelection</a></li><li data-type='method' style='display: none;'><a href="module-messenger.html#.openMessenger">openMessenger</a></li><li data-type='method' style='display: none;'><a href="module-messenger.html#.openNewChat">openNewChat</a></li><li data-type='method' style='display: none;'><a href="module-messenger.html#.showAllChats">showAllChats</a></li><li data-type='method' style='display: none;'><a href="module-messenger.html#.updateUnreadBadge">updateUnreadBadge</a></li><li data-type='method' style='display: none;'><a href="module-messenger.html#~formatTimestamp">formatTimestamp</a></li><li data-type='method' style='display: none;'><a href="module-messenger.html#~loadPrivateMessages">loadPrivateMessages</a></li><li data-type='method' style='display: none;'><a href="module-messenger.html#~stopHijackingPolling">stopHijackingPolling</a></li></ul></li><li><a href="module-public_js_modules_hijacking.html">public/js/modules/hijacking</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-public_js_modules_hijacking.html#.closeHijackingInbox">closeHijackingInbox</a></li><li data-type='method' style='display: none;'><a href="module-public_js_modules_hijacking.html#.openHijackingInbox">openHijackingInbox</a></li><li data-type='method' style='display: none;'><a href="module-public_js_modules_hijacking.html#.updateHijackedVesselsDisplay">updateHijackedVesselsDisplay</a></li><li data-type='method' style='display: none;'><a href="module-public_js_modules_hijacking.html#.updateHijackingBadge">updateHijackingBadge</a></li><li data-type='method' style='display: none;'><a href="module-public_js_modules_hijacking.html#~deleteCase">deleteCase</a></li><li data-type='method' style='display: none;'><a href="module-public_js_modules_hijacking.html#~escapeHtml">escapeHtml</a></li><li data-type='method' style='display: none;'><a href="module-public_js_modules_hijacking.html#~formatTimestamp">formatTimestamp</a></li><li data-type='method' style='display: none;'><a href="module-public_js_modules_hijacking.html#~openCaseDetails">openCaseDetails</a></li><li data-type='method' style='display: none;'><a href="module-public_js_modules_hijacking.html#~refreshHijackingBadge">refreshHijackingBadge</a></li><li data-type='method' style='display: none;'><a href="module-public_js_modules_hijacking.html#~renderCaseList">renderCaseList</a></li></ul></li><li><a href="module-route-planner.html">route-planner</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-route-planner.html#.closeRoutePlanner">closeRoutePlanner</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#.getPlanningVesselId">getPlanningVesselId</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#.initializeRoutePlanner">initializeRoutePlanner</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#.isPlanningMode">isPlanningMode</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#.openRoutePlanner">openRoutePlanner</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#.restorePlanningState">restorePlanningState</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#.selectPortForRoute">selectPortForRoute</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~applyDemandPortFilter">applyDemandPortFilter</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~applyPortFilter">applyPortFilter</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~calculateFuelConsumption">calculateFuelConsumption</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~calculateGuardsCost">calculateGuardsCost</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~calculateHarborFeeRange">calculateHarborFeeRange</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~calculateRemainingDemand">calculateRemainingDemand</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~calculateRouteCreationFee">calculateRouteCreationFee</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~calculateTravelTime">calculateTravelTime</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~clearRouteSelection">clearRouteSelection</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~createRoute">createRoute</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~fetchAndDisplayDemand">fetchAndDisplayDemand</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~fetchAndSetAutoPrice">fetchAndSetAutoPrice</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~fetchRouteData">fetchRouteData</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~fetchRouteTabDemand">fetchRouteTabDemand</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~formatDemandCell">formatDemandCell</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~formatPortName">formatPortName</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~formatTravelTime">formatTravelTime</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~loadSuggestedRoute">loadSuggestedRoute</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~loadVesselPorts">loadVesselPorts</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~populateDemandDropdown">populateDemandDropdown</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~saveRouteChanges">saveRouteChanges</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~showError">showError</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~switchTab">switchTab</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~updateDemandDisplay">updateDemandDisplay</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~updatePortsGuardsDisplay">updatePortsGuardsDisplay</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~updatePortsSpeedDisplay">updatePortsSpeedDisplay</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~updateRouteTabDemandDisplay">updateRouteTabDemandDisplay</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~updateRouteTabVisibility">updateRouteTabVisibility</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~updateRouteTabWithCurrentRoute">updateRouteTabWithCurrentRoute</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~updateSelectedPortDisplay">updateSelectedPortDisplay</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~updateSliderDisplays">updateSliderDisplays</a></li><li data-type='method' style='display: none;'><a href="module-route-planner.html#~updateVesselCapacityDisplay">updateVesselCapacityDisplay</a></li></ul></li><li><a href="module-server_analytics_aggregator.html">server/analytics/aggregator</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~aggregateRansomPayments">aggregateRansomPayments</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~calculateRouteHijackCounts">calculateRouteHijackCounts</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~calculateWeightedAverage">calculateWeightedAverage</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~fetchGameHijackingRisks">fetchGameHijackingRisks</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~filterByDays">filterByDays</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~filterByType">filterByType</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~formatRouteDisplay">formatRouteDisplay</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getActionTypes">getActionTypes</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getContributionAnalysis">getContributionAnalysis</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getDailyRevenueTrend">getDailyRevenueTrend</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getDetailedExpenses">getDetailedExpenses</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getFilteredLogs">getFilteredLogs</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getHarborFeeAnalysis">getHarborFeeAnalysis</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getMergedDepartures">getMergedDepartures</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getMergedOperationsSummary">getMergedOperationsSummary</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getMergedSummary">getMergedSummary</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getPurchaseAnalysis">getPurchaseAnalysis</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getRouteContribution">getRouteContribution</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getRouteProfitability">getRouteProfitability</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getRouteProfitabilityMerged">getRouteProfitabilityMerged</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getRouteProfitabilityWithContribution">getRouteProfitabilityWithContribution</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getVesselNameFromHijackHistory">getVesselNameFromHijackHistory</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getVesselPerformance">getVesselPerformance</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getVesselPerformanceMerged">getVesselPerformanceMerged</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getVesselPerformanceWithContribution">getVesselPerformanceWithContribution</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getVesselsByRoute">getVesselsByRoute</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~getWeeklySummary">getWeeklySummary</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~isAutopilotTransaction">isAutopilotTransaction</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~loadAuditLog">loadAuditLog</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~loadVesselHistory">loadVesselHistory</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~mapContextToAutopilotType">mapContextToAutopilotType</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~mapContextToCategory">mapContextToCategory</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_aggregator.html#~normalizeRouteKey">normalizeRouteKey</a></li></ul></li><li><a href="module-server_analytics_api-stats-store.html">server/analytics/api-stats-store</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~cleanupOldStats">cleanupOldStats</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~closeDb">closeDb</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~flushBuffer">flushBuffer</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~getAvailableDates">getAvailableDates</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~getCurrentMinuteKey">getCurrentMinuteKey</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~getDb">getDb</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~getDbPath">getDbPath</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~getHourlyStats">getHourlyStats</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~getStats">getStats</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~migrateFromJson">migrateFromJson</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~recordCall">recordCall</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~startAutoFlush">startAutoFlush</a></li><li data-type='method' style='display: none;'><a href="module-server_analytics_api-stats-store.html#~stopAutoFlush">stopAutoFlush</a></li></ul></li><li><a href="module-server_automation.html">server/automation</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_automation.html#~getRandomInterval">getRandomInterval</a></li><li data-type='method' style='display: none;'><a href="module-server_automation.html#~initialize">initialize</a></li><li data-type='method' style='display: none;'><a href="module-server_automation.html#~loadSettings">loadSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_automation.html#~parseInterval">parseInterval</a></li><li data-type='method' style='display: none;'><a href="module-server_automation.html#~restartAutoRepair">restartAutoRepair</a></li><li data-type='method' style='display: none;'><a href="module-server_automation.html#~runAutoRepair">runAutoRepair</a></li><li data-type='method' style='display: none;'><a href="module-server_automation.html#~scheduleAutoRepair">scheduleAutoRepair</a></li></ul></li><li><a href="module-server_autopilot.html">server/autopilot</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~analyzeVesselDepartures">analyzeVesselDepartures</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~autoRebuyAll">autoRebuyAll</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~checkPriceAlerts">checkPriceAlerts</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~checkTelegramPriceAlerts">checkTelegramPriceAlerts</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~countActiveCampaignTypes">countActiveCampaignTypes</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~fastEventLoop">fastEventLoop</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~getGameIndexCached">getGameIndexCached</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~initializeAutopilotState">initializeAutopilotState</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~isAutopilotPaused">isAutopilotPaused</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~pauseAutopilot">pauseAutopilot</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~resumeAutopilot">resumeAutopilot</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~setBroadcastFunction">setBroadcastFunction</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~slowEventLoop">slowEventLoop</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~startMainEventLoop">startMainEventLoop</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~tryUpdateAllData">tryUpdateAllData</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~updateAllData">updateAllData</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~updateCampaigns">updateCampaigns</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~updateDrydockCount">updateDrydockCount</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~updatePrices">updatePrices</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~updateRepairCount">updateRepairCount</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~updateUnreadMessages">updateUnreadMessages</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot.html#~updateVesselCount">updateVesselCount</a></li></ul></li><li><a href="module-server_autopilot_pilot_atmosphere_broker.html">server/autopilot/pilot_atmosphere_broker</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_atmosphere_broker.html#~autoRebuyCO2">autoRebuyCO2</a></li></ul></li><li><a href="module-server_autopilot_pilot_barrel_boss.html">server/autopilot/pilot_barrel_boss</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_barrel_boss.html#~autoRebuyFuel">autoRebuyFuel</a></li></ul></li><li><a href="module-server_autopilot_pilot_captain_blackbeard.html">server/autopilot/pilot_captain_blackbeard</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_captain_blackbeard.html#~autoNegotiateHijacking">autoNegotiateHijacking</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_captain_blackbeard.html#~processHijackingCase">processHijackingCase</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_captain_blackbeard.html#~wait">wait</a></li></ul></li><li><a href="module-server_autopilot_pilot_cargo_marshal.html">server/autopilot/pilot_cargo_marshal</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_cargo_marshal.html#~autoDepartVessels">autoDepartVessels</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_cargo_marshal.html#~calculateRemainingDemand">calculateRemainingDemand</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_cargo_marshal.html#~departVessels">departVessels</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_cargo_marshal.html#~getTotalCapacity">getTotalCapacity</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_cargo_marshal.html#~resetFuelFailedCacheIfIncreased">resetFuelFailedCacheIfIncreased</a></li></ul></li><li><a href="module-server_autopilot_pilot_drydock_master.html">server/autopilot/pilot_drydock_master</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_drydock_master.html#~autoDrydockVessels">autoDrydockVessels</a></li></ul></li><li><a href="module-server_autopilot_pilot_fair_hand.html">server/autopilot/pilot_fair_hand</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_fair_hand.html#~autoCoop">autoCoop</a></li></ul></li><li><a href="module-server_autopilot_pilot_harbormaster.html">server/autopilot/pilot_harbormaster</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_harbormaster.html#~autoAnchorPointPurchase">autoAnchorPointPurchase</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_harbormaster.html#~setBroadcastFunction">setBroadcastFunction</a></li></ul></li><li><a href="module-server_autopilot_pilot_reputation_chief.html">server/autopilot/pilot_reputation_chief</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_reputation_chief.html#~autoCampaignRenewal">autoCampaignRenewal</a></li></ul></li><li><a href="module-server_autopilot_pilot_staff_captain.html">server/autopilot/pilot_staff_captain</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_staff_captain.html#~manageStaffMorale">manageStaffMorale</a></li></ul></li><li><a href="module-server_autopilot_pilot_the_purser.html">server/autopilot/pilot_the_purser</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_the_purser.html#~autoBuyStock">autoBuyStock</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_the_purser.html#~autoSellStock">autoSellStock</a></li><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_the_purser.html#~clearPurchasedCache">clearPurchasedCache</a></li></ul></li><li><a href="module-server_autopilot_pilot_yard_foreman.html">server/autopilot/pilot_yard_foreman</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_autopilot_pilot_yard_foreman.html#~autoRepairVessels">autoRepairVessels</a></li></ul></li><li><a href="module-server_cache.html">server/cache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_cache.html#~clearAllCaches">clearAllCaches</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~getAllianceCache">getAllianceCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~getCampaignCache">getCampaignCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~getCompanyCache">getCompanyCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~getCoopCache">getCoopCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~getGameIndexCache">getGameIndexCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~invalidateCampaignCache">invalidateCampaignCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~invalidateCoopCache">invalidateCoopCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~invalidateGameIndexCache">invalidateGameIndexCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~isCacheValid">isCacheValid</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~setAllianceCache">setAllianceCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~setCampaignCache">setCampaignCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~setCompanyCache">setCompanyCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~setCoopCache">setCoopCache</a></li><li data-type='method' style='display: none;'><a href="module-server_cache.html#~setGameIndexCache">setGameIndexCache</a></li></ul></li><li><a href="module-server_certificate.html">server/certificate</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_certificate.html#~createHttpsServer">createHttpsServer</a></li><li data-type='method' style='display: none;'><a href="module-server_certificate.html#~generateCA">generateCA</a></li><li data-type='method' style='display: none;'><a href="module-server_certificate.html#~generateCertificate">generateCertificate</a></li><li data-type='method' style='display: none;'><a href="module-server_certificate.html#~getNetworkIPs">getNetworkIPs</a></li><li data-type='method' style='display: none;'><a href="module-server_certificate.html#~isCertificateInstalled">isCertificateInstalled</a></li><li data-type='method' style='display: none;'><a href="module-server_certificate.html#~loadCertificate">loadCertificate</a></li></ul></li><li><a href="module-server_chatbot.html">server/chatbot</a></li><li><a href="module-server_chatbot_commands.html">server/chatbot/commands</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_chatbot_commands.html#~generateForecastText">generateForecastText</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_commands.html#~getBroadcastDir">getBroadcastDir</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_commands.html#~getEnabledBroadcastTemplates">getEnabledBroadcastTemplates</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_commands.html#~handleForecastCommand">handleForecastCommand</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_commands.html#~handleHelpCommand">handleHelpCommand</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_commands.html#~handleMsgCommand">handleMsgCommand</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_commands.html#~handleWelcomeCommand">handleWelcomeCommand</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_commands.html#~hasManagementRole">hasManagementRole</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_commands.html#~loadBroadcastTemplates">loadBroadcastTemplates</a></li></ul></li><li><a href="module-server_chatbot_executor.html">server/chatbot/executor</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_chatbot_executor.html#~executeCommand">executeCommand</a></li></ul></li><li><a href="module-server_chatbot_parser.html">server/chatbot/parser</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_chatbot_parser.html#~findCustomCommand">findCustomCommand</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_parser.html#~hasManagementRole">hasManagementRole</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_parser.html#~isCommandAllowedInChannel">isCommandAllowedInChannel</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_parser.html#~processAllianceMessage">processAllianceMessage</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_parser.html#~processPrivateMessage">processPrivateMessage</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_parser.html#~processQueue">processQueue</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_parser.html#~queueCommand">queueCommand</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_parser.html#~resolveCommandName">resolveCommandName</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_parser.html#~validateCommandArguments">validateCommandArguments</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_parser.html#~validateForecastArguments">validateForecastArguments</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_parser.html#~validateWelcomeArguments">validateWelcomeArguments</a></li></ul></li><li><a href="module-server_chatbot_scheduler.html">server/chatbot/scheduler</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_chatbot_scheduler.html#~scheduleDailyForecast">scheduleDailyForecast</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_scheduler.html#~sendDailyForecast">sendDailyForecast</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_scheduler.html#~setupScheduledTasks">setupScheduledTasks</a></li></ul></li><li><a href="module-server_chatbot_sender.html">server/chatbot/sender</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_chatbot_sender.html#~broadcastDmFailureNotification">broadcastDmFailureNotification</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_sender.html#~broadcastDmQueuedNotification">broadcastDmQueuedNotification</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_sender.html#~broadcastRateLimitNotification">broadcastRateLimitNotification</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_sender.html#~getDmQueueStatus">getDmQueueStatus</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_sender.html#~processDmQueue">processDmQueue</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_sender.html#~queuePrivateMessage">queuePrivateMessage</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_sender.html#~sendAllianceMessage">sendAllianceMessage</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_sender.html#~sendErrorMessage">sendErrorMessage</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_sender.html#~sendPrivateMessage">sendPrivateMessage</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_sender.html#~sendPrivateMessageDirect">sendPrivateMessageDirect</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_sender.html#~sendResponse">sendResponse</a></li></ul></li><li><a href="module-server_chatbot_settings.html">server/chatbot/settings</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_chatbot_settings.html#~getDefaultChatBotObject">getDefaultChatBotObject</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_settings.html#~hasManagementRole">hasManagementRole</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_settings.html#~loadSettings">loadSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_settings.html#~mapChatBotObjectToFlatSettings">mapChatBotObjectToFlatSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_settings.html#~mapSettingsToChatBotObject">mapSettingsToChatBotObject</a></li><li data-type='method' style='display: none;'><a href="module-server_chatbot_settings.html#~updateSettings">updateSettings</a></li></ul></li><li><a href="module-server_config.html">server/config</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_config.html#~getAppBaseDir">getAppBaseDir</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~getAppDataDir">getAppDataDir</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~getAppPlatformCookie">getAppPlatformCookie</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~getAppVersionCookie">getAppVersionCookie</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~getInternalBaseUrl">getInternalBaseUrl</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~getLocalAppDataDir">getLocalAppDataDir</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~getLogDir">getLogDir</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~getPortFromDatabase">getPortFromDatabase</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~getSessionCookie">getSessionCookie</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~getSettingsDir">getSettingsDir</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~isPackaged">isPackaged</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~loadStartupSettings">loadStartupSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_config.html#~setSessionCookie">setSessionCookie</a></li></ul></li><li><a href="module-server_database.html">server/database</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_database.html#~addToStockBlacklist">addToStockBlacklist</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~closeAccountsDb">closeAccountsDb</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~closeAll">closeAll</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~closeDb">closeDb</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~createAccountsSchema">createAccountsSchema</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~createSchema">createSchema</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~deleteAccount">deleteAccount</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~deleteRouteSettings">deleteRouteSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~ensureDbDir">ensureDbDir</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~findNextAvailablePort">findNextAvailablePort</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getAccount">getAccount</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getAccountsDb">getAccountsDb</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getAccountsDbPath">getAccountsDbPath</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getAllAccounts">getAllAccounts</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getAllRouteSettings">getAllRouteSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getDb">getDb</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getDbDir">getDbDir</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getDbPath">getDbPath</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getHijackHistoryDir">getHijackHistoryDir</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getMetadata">getMetadata</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getRouteSettings">getRouteSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~getStockBlacklist">getStockBlacklist</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~isMigrationComplete">isMigrationComplete</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~isStockBlacklisted">isStockBlacklisted</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~markMigrationComplete">markMigrationComplete</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~migrateAllHijackHistoryFromJson">migrateAllHijackHistoryFromJson</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~migrateHijackHistoryFromJson">migrateHijackHistoryFromJson</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~removeFromStockBlacklist">removeFromStockBlacklist</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~saveAccount">saveAccount</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~saveRouteSettings">saveRouteSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~setAccountAutostart">setAccountAutostart</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~setAccountPort">setAccountPort</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~setMetadata">setMetadata</a></li><li data-type='method' style='display: none;'><a href="module-server_database.html#~transaction">transaction</a></li></ul></li><li><a href="module-server_database_alliance-cache.html">server/database/alliance-cache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~bulkUpdate">bulkUpdate</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~clearCache">clearCache</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~closeDb">closeDb</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~deleteAlliance">deleteAlliance</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~getAll">getAll</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~getById">getById</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~getCount">getCount</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~getDb">getDb</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~getDbPath">getDbPath</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~getLastUpdate">getLastUpdate</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~getStats">getStats</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~getTopByContribution">getTopByContribution</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~importFromJson">importFromJson</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~search">search</a></li><li data-type='method' style='display: none;'><a href="module-server_database_alliance-cache.html#~upsertAlliance">upsertAlliance</a></li></ul></li><li><a href="module-server_database_init.html">server/database/init</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_database_init.html#~initAllUserDatabases">initAllUserDatabases</a></li><li data-type='method' style='display: none;'><a href="module-server_database_init.html#~initUserDatabase">initUserDatabase</a></li></ul></li><li><a href="module-server_database_json-repair.html">server/database/json-repair</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_database_json-repair.html#~findLastValidJsonEnd">findLastValidJsonEnd</a></li><li data-type='method' style='display: none;'><a href="module-server_database_json-repair.html#~removeBadControlChars">removeBadControlChars</a></li><li data-type='method' style='display: none;'><a href="module-server_database_json-repair.html#~repairAllUserFiles">repairAllUserFiles</a></li><li data-type='method' style='display: none;'><a href="module-server_database_json-repair.html#~repairJsonFile">repairJsonFile</a></li><li data-type='method' style='display: none;'><a href="module-server_database_json-repair.html#~repairJsonString">repairJsonString</a></li></ul></li><li><a href="module-server_database_migration.html">server/database/migration</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~findAllUsersWithData">findAllUsersWithData</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~findUserHijackFiles">findUserHijackFiles</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~findUserJsonFiles">findUserJsonFiles</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~findUserVesselAppearanceFiles">findUserVesselAppearanceFiles</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~getLegacyOlduserdataDirs">getLegacyOlduserdataDirs</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~getOlddataDir">getOlddataDir</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~getUserdataDir">getUserdataDir</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~importAutopilotLog">importAutopilotLog</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~importHijackCase">importHijackCase</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~importLookup">importLookup</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~importMessengerCache">importMessengerCache</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~importProcessedDmMessages">importProcessedDmMessages</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~importTransactions">importTransactions</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~importTripData">importTripData</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~importVesselAppearance">importVesselAppearance</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~importVesselHistory">importVesselHistory</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~migrateAll">migrateAll</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~migrateUser">migrateUser</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~moveToOldData">moveToOldData</a></li><li data-type='method' style='display: none;'><a href="module-server_database_migration.html#~safeParseJson">safeParseJson</a></li></ul></li><li><a href="module-server_database_store-adapter.html">server/database/store-adapter</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_database_store-adapter.html#~ensureUserInitialized">ensureUserInitialized</a></li><li data-type='method' style='display: none;'><a href="module-server_database_store-adapter.html#~wrapStore">wrapStore</a></li></ul></li><li><a href="module-server_database_stores.html">server/database/stores</a></li><li><a href="module-server_database_stores_lookup-store.html">server/database/stores/lookup-store</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~buildLookup">buildLookup</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~buildLookupAsync">buildLookupAsync</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~cancelBuild">cancelBuild</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~clearStore">clearStore</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~extractAllVesselsFromLog">extractAllVesselsFromLog</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~extractCashFromLog">extractCashFromLog</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~extractPerItemPriceFromLog">extractPerItemPriceFromLog</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~extractPriceFromLog">extractPriceFromLog</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~extractVesselFromLog">extractVesselFromLog</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~getBreakdownByDay">getBreakdownByDay</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~getBreakdownByType">getBreakdownByType</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~getBuildStatus">getBuildStatus</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~getContextsFromAutopilot">getContextsFromAutopilot</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~getEntries">getEntries</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~getEntriesByDays">getEntriesByDays</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~getEntryDetails">getEntryDetails</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~getStoreInfo">getStoreInfo</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~getTotals">getTotals</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~loadPaged">loadPaged</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_lookup-store.html#~rematchPOD3">rematchPOD3</a></li></ul></li><li><a href="module-server_database_stores_port-demand-store.html">server/database/stores/port-demand-store</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_database_stores_port-demand-store.html#~cleanupOldEntries">cleanupOldEntries</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_port-demand-store.html#~getLatestDemand">getLatestDemand</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_port-demand-store.html#~getPortHistory">getPortHistory</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_port-demand-store.html#~getPortTrends">getPortTrends</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_port-demand-store.html#~getStoreStats">getStoreStats</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_port-demand-store.html#~saveDemandSnapshot">saveDemandSnapshot</a></li></ul></li><li><a href="module-server_database_stores_transaction-store.html">server/database/stores/transaction-store</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_database_stores_transaction-store.html#~fetchFromAPI">fetchFromAPI</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_transaction-store.html#~generateTransactionId">generateTransactionId</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_transaction-store.html#~getDailyBreakdown">getDailyBreakdown</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_transaction-store.html#~getStoreInfo">getStoreInfo</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_transaction-store.html#~getTransactionSummary">getTransactionSummary</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_transaction-store.html#~getTransactionTypes">getTransactionTypes</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_transaction-store.html#~getTransactions">getTransactions</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_transaction-store.html#~getTransactionsByDays">getTransactionsByDays</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_transaction-store.html#~startAutoSync">startAutoSync</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_transaction-store.html#~stopAutoSync">stopAutoSync</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_transaction-store.html#~syncTransactions">syncTransactions</a></li></ul></li><li><a href="module-server_database_stores_vessel-history-store.html">server/database/stores/vessel-history-store</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~clearStore">clearStore</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~fetchAllVessels">fetchAllVessels</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~fetchVesselHistory">fetchVesselHistory</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~generateDepartureId">generateDepartureId</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~getDepartures">getDepartures</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~getDeparturesBefore">getDeparturesBefore</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~getDeparturesByDays">getDeparturesByDays</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~getRouteHijackingRisks">getRouteHijackingRisks</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~getStoreInfo">getStoreInfo</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~getSyncProgress">getSyncProgress</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~getVesselTrips">getVesselTrips</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~loadSyncProgress">loadSyncProgress</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~migrateTankerCargo">migrateTankerCargo</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~parseGameDate">parseGameDate</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~saveSyncProgress">saveSyncProgress</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~startAutoSync">startAutoSync</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~stopAutoSync">stopAutoSync</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~stopSync">stopSync</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~syncNextVesselInRotation">syncNextVesselInRotation</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~syncSpecificVessels">syncSpecificVessels</a></li><li data-type='method' style='display: none;'><a href="module-server_database_stores_vessel-history-store.html#~syncVesselHistory">syncVesselHistory</a></li></ul></li><li><a href="module-server_gameapi.html">server/gameapi</a></li><li><a href="module-server_gameapi_alliance.html">server/gameapi/alliance</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_gameapi_alliance.html#~fetchUserContribution">fetchUserContribution</a></li></ul></li><li><a href="module-server_gameapi_bunker.html">server/gameapi/bunker</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_gameapi_bunker.html#~fetchBunkerState">fetchBunkerState</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_bunker.html#~fetchPrices">fetchPrices</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_bunker.html#~purchaseCO2">purchaseCO2</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_bunker.html#~purchaseFuel">purchaseFuel</a></li></ul></li><li><a href="module-server_gameapi_campaign.html">server/gameapi/campaign</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_gameapi_campaign.html#~activateCampaign">activateCampaign</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_campaign.html#~fetchCampaigns">fetchCampaigns</a></li></ul></li><li><a href="module-server_gameapi_maintenance.html">server/gameapi/maintenance</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_gameapi_maintenance.html#~bulkRepairVessels">bulkRepairVessels</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_maintenance.html#~fetchRepairCount">fetchRepairCount</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_maintenance.html#~getMaintenanceCost">getMaintenanceCost</a></li></ul></li><li><a href="module-server_gameapi_port.html">server/gameapi/port</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_gameapi_port.html#~fetchAssignedPorts">fetchAssignedPorts</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_port.html#~fetchAutoPrice">fetchAutoPrice</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_port.html#~getAssignedPorts">getAssignedPorts</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_port.html#~getRoutesByPorts">getRoutesByPorts</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_port.html#~getVesselPorts">getVesselPorts</a></li></ul></li><li><a href="module-server_gameapi_util.html">server/gameapi/util</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_gameapi_util.html#~fetchEventData">fetchEventData</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_util.html#~fetchUnreadMessages">fetchUnreadMessages</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_util.html#~getGameIndex">getGameIndex</a></li></ul></li><li><a href="module-server_gameapi_vessel.html">server/gameapi/vessel</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_gameapi_vessel.html#~departVessel">departVessel</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_vessel.html#~fetchVessels">fetchVessels</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_vessel.html#~getAllUserVessels">getAllUserVessels</a></li><li data-type='method' style='display: none;'><a href="module-server_gameapi_vessel.html#~getVesselHistory">getVesselHistory</a></li></ul></li><li><a href="module-server_middleware_index.html">server/middleware/index</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_middleware_index.html#~setupMiddleware">setupMiddleware</a></li></ul></li><li><a href="module-server_routes_alliance.html">server/routes/alliance</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.GET/api/alliance-high-scores">GET /api/alliance-high-scores</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.GET/api/alliance-info">GET /api/alliance-info</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.GET/api/alliance-info/:id">GET /api/alliance-info/:id</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.GET/api/alliance-members">GET /api/alliance-members</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.GET/api/alliance-members/:id">GET /api/alliance-members/:id</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.GET/api/alliance-settings">GET /api/alliance-settings</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.GET/api/chat">GET /api/chat</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.GET/api/league-info">GET /api/league-info</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.POST/api/alliance-accept-user">POST /api/alliance-accept-user</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.POST/api/alliance-decline-user">POST /api/alliance-decline-user</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.POST/api/alliance-exclude-user">POST /api/alliance-exclude-user</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.POST/api/alliance-leave">POST /api/alliance-leave</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.POST/api/alliance-queue-pool">POST /api/alliance-queue-pool</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.POST/api/alliance-update-user-role">POST /api/alliance-update-user-role</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.POST/api/chat/mark-read">POST /api/chat/mark-read</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.POST/api/company-name">POST /api/company-name</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_alliance.html#.POST/api/send-message">POST /api/send-message</a></li></ul></li><li><a href="module-server_routes_alliance-logo.html">server/routes/alliance-logo</a></li><li><a href="module-server_routes_alliances.html">server/routes/alliances</a></li><li><a href="module-server_routes_analytics.html">server/routes/analytics</a></li><li><a href="module-server_routes_anchor.html">server/routes/anchor</a></li><li><a href="module-server_routes_broadcast.html">server/routes/broadcast</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_broadcast.html#~ensureDirectory">ensureDirectory</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_broadcast.html#~getTemplatesFilePath">getTemplatesFilePath</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_broadcast.html#~loadTemplates">loadTemplates</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_broadcast.html#~saveTemplates">saveTemplates</a></li></ul></li><li><a href="module-server_routes_coop.html">server/routes/coop</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_coop.html#.GET/api/coop/data">GET /api/coop/data</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_coop.html#.POST/api/coop/send-max">POST /api/coop/send-max</a></li></ul></li><li><a href="module-server_routes_forecast.html">server/routes/forecast</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~convertCESTToTimezone">convertCESTToTimezone</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~generateChatbotText">generateChatbotText</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~generateMetadata">generateMetadata</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~getDaysInMonth">getDaysInMonth</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~getForecastDataPath">getForecastDataPath</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~getMonthForDay">getMonthForDay</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~getNextDayData">getNextDayData</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~getPreviousDayData">getPreviousDayData</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~getServerLocalTimezone">getServerLocalTimezone</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~getTimezoneOffsetHours">getTimezoneOffsetHours</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~getValidTimezones">getValidTimezones</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_forecast.html#~parseNumericOffset">parseNumericOffset</a></li></ul></li><li><a href="module-server_routes_game.html">server/routes/game</a></li><li><a href="module-server_routes_game_autopilot.html">server/routes/game/autopilot</a></li><li><a href="module-server_routes_game_bunker.html">server/routes/game/bunker</a></li><li><a href="module-server_routes_game_depart.html">server/routes/game/depart</a></li><li><a href="module-server_routes_game_maintenance.html">server/routes/game/maintenance</a></li><li><a href="module-server_routes_game_marketing.html">server/routes/game/marketing</a></li><li><a href="module-server_routes_game_user.html">server/routes/game/user</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_game_user.html#~compareVersions">compareVersions</a></li></ul></li><li><a href="module-server_routes_game_vessel.html">server/routes/game/vessel</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_game_vessel.html#~refreshAndBroadcastHeader">refreshAndBroadcastHeader</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_game_vessel.html#~validateImageData">validateImageData</a></li></ul></li><li><a href="module-server_routes_harbor-map.html">server/routes/harbor-map</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_harbor-map.html#~escapeCSVFormula">escapeCSVFormula</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_harbor-map.html#~formatHistoryAsTXT">formatHistoryAsTXT</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_harbor-map.html#~getGameIndexCached">getGameIndexCached</a></li></ul></li><li><a href="module-server_routes_health.html">server/routes/health</a></li><li><a href="module-server_routes_messenger.html">server/routes/messenger</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_messenger.html#.GET/api/contact/get-contacts">GET /api/contact/get-contacts</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_messenger.html#.GET/api/hijacking/get-cases">GET /api/hijacking/get-cases</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_messenger.html#.GET/api/messenger/get-chats">GET /api/messenger/get-chats</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_messenger.html#.POST/api/messenger/delete-chat">POST /api/messenger/delete-chat</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_messenger.html#.POST/api/messenger/get-messages">POST /api/messenger/get-messages</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_messenger.html#.POST/api/messenger/send-private">POST /api/messenger/send-private</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_messenger.html#.POST/api/user/search">POST /api/user/search</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_messenger.html#~ensureHijackHistoryDir">ensureHijackHistoryDir</a></li></ul></li><li><a href="module-server_routes_poi.html">server/routes/poi</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_poi.html#~ensureCacheDir">ensureCacheDir</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_poi.html#~fetchAllMuseumsFromAPI">fetchAllMuseumsFromAPI</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_poi.html#~fetchAllWrecksFromAPI">fetchAllWrecksFromAPI</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_poi.html#~filterPOIsByBbox">filterPOIsByBbox</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_poi.html#~initializePOICache">initializePOICache</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_poi.html#~isCacheValid">isCacheValid</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_poi.html#~loadFromCache">loadFromCache</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_poi.html#~reduceWreckData">reduceWreckData</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_poi.html#~saveToCache">saveToCache</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_poi.html#~startAutomaticCacheRefresh">startAutomaticCacheRefresh</a></li></ul></li><li><a href="module-server_routes_route-planner.html">server/routes/route-planner</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_route-planner.html#~calculateRouteCreationFee">calculateRouteCreationFee</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_route-planner.html#~getRouteFeeDiscountMultiplier">getRouteFeeDiscountMultiplier</a></li></ul></li><li><a href="module-server_routes_server-config.html">server/routes/server-config</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_server-config.html#~getDirectoryStats">getDirectoryStats</a></li></ul></li><li><a href="module-server_routes_settings.html">server/routes/settings</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_settings.html#.GET/api/settings">GET /api/settings</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_settings.html#.POST/api/settings">POST /api/settings</a></li></ul></li><li><a href="module-server_routes_staff.html">server/routes/staff</a></li><li><a href="module-server_routes_stock.html">server/routes/stock</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_routes_stock.html#.GET/api/stock/check-company-age">GET /api/stock/check-company-age</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_stock.html#.GET/api/stock/finance-overview">GET /api/stock/finance-overview</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_stock.html#.GET/api/stock/market">GET /api/stock/market</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_stock.html#.GET/api/stock/purchase-times">GET /api/stock/purchase-times</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_stock.html#.GET/api/stock/recent-ipos">GET /api/stock/recent-ipos</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_stock.html#.POST/api/stock/increase-stock-for-sale">POST /api/stock/increase-stock-for-sale</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_stock.html#.POST/api/stock/purchase">POST /api/stock/purchase</a></li><li data-type='method' style='display: none;'><a href="module-server_routes_stock.html#.POST/api/stock/sell">POST /api/stock/sell</a></li></ul></li><li><a href="module-server_routes_transactions.html">server/routes/transactions</a></li><li><a href="module-server_routes_vessel-image.html">server/routes/vessel-image</a></li><li><a href="module-server_scheduler.html">server/scheduler</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_scheduler.html#~getInitError">getInitError</a></li><li data-type='method' style='display: none;'><a href="module-server_scheduler.html#~initScheduler">initScheduler</a></li><li data-type='method' style='display: none;'><a href="module-server_scheduler.html#~isServerReady">isServerReady</a></li></ul></li><li><a href="module-server_services_alliance-indexer.html">server/services/alliance-indexer</a></li><li><a href="module-server_services_port-demand-sync.html">server/services/port-demand-sync</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_services_port-demand-sync.html#~fetchAndSavePort">fetchAndSavePort</a></li><li data-type='method' style='display: none;'><a href="module-server_services_port-demand-sync.html#~getStatus">getStatus</a></li><li data-type='method' style='display: none;'><a href="module-server_services_port-demand-sync.html#~initPortCodes">initPortCodes</a></li><li data-type='method' style='display: none;'><a href="module-server_services_port-demand-sync.html#~processNextBatch">processNextBatch</a></li><li data-type='method' style='display: none;'><a href="module-server_services_port-demand-sync.html#~startSync">startSync</a></li><li data-type='method' style='display: none;'><a href="module-server_services_port-demand-sync.html#~stopSync">stopSync</a></li></ul></li><li><a href="module-server_settings-schema.html">server/settings-schema</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_settings-schema.html#~getDefault">getDefault</a></li><li data-type='method' style='display: none;'><a href="module-server_settings-schema.html#~getDefaults">getDefaults</a></li><li data-type='method' style='display: none;'><a href="module-server_settings-schema.html#~getRequiredKeys">getRequiredKeys</a></li><li data-type='method' style='display: none;'><a href="module-server_settings-schema.html#~getSettingsFilePath">getSettingsFilePath</a></li><li data-type='method' style='display: none;'><a href="module-server_settings-schema.html#~initializeSettings">initializeSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_settings-schema.html#~saveSettings">saveSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_settings-schema.html#~validateSettings">validateSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_settings-schema.html#~validateValue">validateValue</a></li></ul></li><li><a href="module-server_state.html">server/state</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_state.html#~getAllLocks">getAllLocks</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getAutopilotState">getAutopilotState</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getBunkerState">getBunkerState</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getCampaignStatus">getCampaignStatus</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getCoopData">getCoopData</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getDrydockCount">getDrydockCount</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getEventData">getEventData</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getHeaderData">getHeaderData</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getLastCO2Alert">getLastCO2Alert</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getLastFuelAlert">getLastFuelAlert</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getLockStatus">getLockStatus</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getPrices">getPrices</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getRepairCount">getRepairCount</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getSettings">getSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getStaffData">getStaffData</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getUserState">getUserState</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~getVesselCounts">getVesselCounts</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~isAutopilotPaused">isAutopilotPaused</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~setAutopilotPaused">setAutopilotPaused</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~setAutopilotState">setAutopilotState</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~setLastCO2Alert">setLastCO2Alert</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~setLastFuelAlert">setLastFuelAlert</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~setLockStatus">setLockStatus</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~updateBunkerState">updateBunkerState</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~updateCampaignStatus">updateCampaignStatus</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~updateCoopData">updateCoopData</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~updateDrydockCount">updateDrydockCount</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~updateEventData">updateEventData</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~updateHeaderData">updateHeaderData</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~updatePrices">updatePrices</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~updateRepairCount">updateRepairCount</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~updateSettings">updateSettings</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~updateStaffData">updateStaffData</a></li><li data-type='method' style='display: none;'><a href="module-server_state.html#~updateVesselCounts">updateVesselCounts</a></li></ul></li><li><a href="module-server_utils_api.html">server/utils/api</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~apiCall">apiCall</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~apiCallWithRetry">apiCallWithRetry</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~checkAndUpdateAllianceId">checkAndUpdateAllianceId</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~getAllianceId">getAllianceId</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~getAllianceName">getAllianceName</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~getChatFeed">getChatFeed</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~getCompanyName">getCompanyName</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~getUserCompanyName">getUserCompanyName</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~getUserId">getUserId</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~initializeAlliance">initializeAlliance</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~setAllianceId">setAllianceId</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_api.html#~sleep">sleep</a></li></ul></li><li><a href="module-server_utils_audit-logger.html">server/utils/audit-logger</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_utils_audit-logger.html#~auditLog">auditLog</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_audit-logger.html#~formatCurrency">formatCurrency</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_audit-logger.html#~formatNumber">formatNumber</a></li></ul></li><li><a href="module-server_utils_encryption.html">server/utils/encryption</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_utils_encryption.html#~cleanupOldCredentials">cleanupOldCredentials</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_encryption.html#~decryptData">decryptData</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_encryption.html#~deleteEncryptedData">deleteEncryptedData</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_encryption.html#~encryptData">encryptData</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_encryption.html#~getEncryptionInfo">getEncryptionInfo</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_encryption.html#~isEncrypted">isEncrypted</a></li></ul></li><li><a href="module-server_utils_fuel-calculator.html">server/utils/fuel-calculator</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_utils_fuel-calculator.html#~calculateCO2Consumption">calculateCO2Consumption</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_fuel-calculator.html#~calculateFuelConsumption">calculateFuelConsumption</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_fuel-calculator.html#~calculateFuelFromFormula">calculateFuelFromFormula</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_fuel-calculator.html#~getFuelConsumptionDisplay">getFuelConsumptionDisplay</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_fuel-calculator.html#~getVesselCapacityForFormula">getVesselCapacityForFormula</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_fuel-calculator.html#~getVesselFuelData">getVesselFuelData</a></li></ul></li><li><a href="module-server_utils_ipo-tracker.html">server/utils/ipo-tracker</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_utils_ipo-tracker.html#~getHighestSeenUserId">getHighestSeenUserId</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_ipo-tracker.html#~getLegacyJsonPath">getLegacyJsonPath</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_ipo-tracker.html#~getSeenIpoUserIds">getSeenIpoUserIds</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_ipo-tracker.html#~hasSeenIpo">hasSeenIpo</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_ipo-tracker.html#~initializeWithIpos">initializeWithIpos</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_ipo-tracker.html#~isFirstCheck">isFirstCheck</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_ipo-tracker.html#~loadIpoTracking">loadIpoTracking</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_ipo-tracker.html#~markIpoAsSeen">markIpoAsSeen</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_ipo-tracker.html#~migrateFromJson">migrateFromJson</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_ipo-tracker.html#~saveIpoTracking">saveIpoTracking</a></li></ul></li><li><a href="module-server_utils_logger.html">server/utils/logger</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_utils_logger.html#~debug">debug</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_logger.html#~error">error</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_logger.html#~getUserIdPrefix">getUserIdPrefix</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_logger.html#~info">info</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_logger.html#~isDebugMode">isDebugMode</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_logger.html#~loadLogLevel">loadLogLevel</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_logger.html#~warn">warn</a></li></ul></li><li><a href="module-server_utils_migrate-harbor-fees.html">server/utils/migrate-harbor-fees</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_utils_migrate-harbor-fees.html#~migrateAllHarborFees">migrateAllHarborFees</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_migrate-harbor-fees.html#~migrateHarborFeesForUser">migrateHarborFeesForUser</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_migrate-harbor-fees.html#~resolveVesselNameToId">resolveVesselNameToId</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_migrate-harbor-fees.html#~timestampToMySQLDatetime">timestampToMySQLDatetime</a></li></ul></li><li><a href="module-server_utils_read-tracker.html">server/utils/read-tracker</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_utils_read-tracker.html#~getLastReadTimestamp">getLastReadTimestamp</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_read-tracker.html#~getLegacyJsonPath">getLegacyJsonPath</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_read-tracker.html#~migrateFromJson">migrateFromJson</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_read-tracker.html#~updateLastReadTimestamp">updateLastReadTimestamp</a></li></ul></li><li><a href="module-server_utils_session-manager.html">server/utils/session-manager</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~deleteSession">deleteSession</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~findAvailablePort">findAvailablePort</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~getAllUserIds">getAllUserIds</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~getAvailableSessions">getAvailableSessions</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~getFirstValidSession">getFirstValidSession</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~getSession">getSession</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~hasSession">hasSession</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~isPortAvailable">isPortAvailable</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~migrateToEncrypted">migrateToEncrypted</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~migrateToNormalizedCookies">migrateToNormalizedCookies</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~normalizeCookie">normalizeCookie</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~saveSession">saveSession</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~setAutostart">setAutostart</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~setPort">setPort</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_session-manager.html#~validateSessionCookie">validateSessionCookie</a></li></ul></li><li><a href="module-server_utils_telegram.html">server/utils/telegram</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_utils_telegram.html#~checkGreenPrices">checkGreenPrices</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_telegram.html#~sendPriceAlert">sendPriceAlert</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_telegram.html#~sendTelegramMessage">sendTelegramMessage</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_telegram.html#~testTelegramConnection">testTelegramConnection</a></li></ul></li><li><a href="module-server_utils_trip-data-store.html">server/utils/trip-data-store</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_utils_trip-data-store.html#~enrichHistoryWithTripData">enrichHistoryWithTripData</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_trip-data-store.html#~findLookupDataFuzzy">findLookupDataFuzzy</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_trip-data-store.html#~findTripDataFuzzy">findTripDataFuzzy</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_trip-data-store.html#~getTripData">getTripData</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_trip-data-store.html#~migrateFromOldStores">migrateFromOldStores</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_trip-data-store.html#~saveHarborFee">saveHarborFee</a></li><li data-type='method' style='display: none;'><a href="module-server_utils_trip-data-store.html#~saveTripData">saveTripData</a></li></ul></li><li><a href="module-server_websocket.html">server/websocket</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_websocket.html#~initWebSocket">initWebSocket</a></li></ul></li><li><a href="module-server_websocket_broadcaster.html">server/websocket/broadcaster</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_websocket_broadcaster.html#~broadcast">broadcast</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_broadcaster.html#~broadcastBunkerUpdate">broadcastBunkerUpdate</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_broadcaster.html#~broadcastHarborMapRefresh">broadcastHarborMapRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_broadcaster.html#~broadcastToUser">broadcastToUser</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_broadcaster.html#~getWebSocketServer">getWebSocketServer</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_broadcaster.html#~setWebSocketServer">setWebSocketServer</a></li></ul></li><li><a href="module-server_websocket_chat-refresh.html">server/websocket/chat-refresh</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_websocket_chat-refresh.html#~performChatRefresh">performChatRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_chat-refresh.html#~setMessengerRefreshFn">setMessengerRefreshFn</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_chat-refresh.html#~startChatAutoRefresh">startChatAutoRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_chat-refresh.html#~stopChatAutoRefresh">stopChatAutoRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_chat-refresh.html#~triggerImmediateChatRefresh">triggerImmediateChatRefresh</a></li></ul></li><li><a href="module-server_websocket_hijacking-cache.html">server/websocket/hijacking-cache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_websocket_hijacking-cache.html#~getCachedHijackingCase">getCachedHijackingCase</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_hijacking-cache.html#~invalidateHijackingCase">invalidateHijackingCase</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_hijacking-cache.html#~markCaseResolved">markCaseResolved</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_hijacking-cache.html#~readLocalCaseFromDb">readLocalCaseFromDb</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_hijacking-cache.html#~saveLocalCaseToDb">saveLocalCaseToDb</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_hijacking-cache.html#~saveNegotiationEvent">saveNegotiationEvent</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_hijacking-cache.html#~updateCaseVesselInfo">updateCaseVesselInfo</a></li></ul></li><li><a href="module-server_websocket_hijacking-refresh.html">server/websocket/hijacking-refresh</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_websocket_hijacking-refresh.html#~performHijackingRefresh">performHijackingRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_hijacking-refresh.html#~startHijackingAutoRefresh">startHijackingAutoRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_hijacking-refresh.html#~stopHijackingAutoRefresh">stopHijackingAutoRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_hijacking-refresh.html#~triggerImmediateHijackingRefresh">triggerImmediateHijackingRefresh</a></li></ul></li><li><a href="module-server_websocket_ipo-refresh.html">server/websocket/ipo-refresh</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_websocket_ipo-refresh.html#~getFreshIpos">getFreshIpos</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_ipo-refresh.html#~performIpoRefresh">performIpoRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_ipo-refresh.html#~resetIpoCache">resetIpoCache</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_ipo-refresh.html#~sendToAllianceChat">sendToAllianceChat</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_ipo-refresh.html#~startIpoAutoRefresh">startIpoAutoRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_ipo-refresh.html#~stopIpoAutoRefresh">stopIpoAutoRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_ipo-refresh.html#~triggerImmediateIpoRefresh">triggerImmediateIpoRefresh</a></li></ul></li><li><a href="module-server_websocket_message-cache.html">server/websocket/message-cache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_websocket_message-cache.html#~addProcessedMessageId">addProcessedMessageId</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_message-cache.html#~getLegacyJsonPath">getLegacyJsonPath</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_message-cache.html#~getProcessedMessageIds">getProcessedMessageIds</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_message-cache.html#~isMessageProcessed">isMessageProcessed</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_message-cache.html#~loadProcessedMessageCache">loadProcessedMessageCache</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_message-cache.html#~migrateFromJson">migrateFromJson</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_message-cache.html#~saveProcessedMessageCache">saveProcessedMessageCache</a></li></ul></li><li><a href="module-server_websocket_messenger-cache.html">server/websocket/messenger-cache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-cache.html#~getCachedMessengerChats">getCachedMessengerChats</a></li></ul></li><li><a href="module-server_websocket_messenger-content-cache.html">server/websocket/messenger-content-cache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-content-cache.html#~deleteChatFromCache">deleteChatFromCache</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-content-cache.html#~getCacheStats">getCacheStats</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-content-cache.html#~getCachedChatList">getCachedChatList</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-content-cache.html#~getCachedChatMessages">getCachedChatMessages</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-content-cache.html#~hasNewMessages">hasNewMessages</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-content-cache.html#~loadChatListFromDb">loadChatListFromDb</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-content-cache.html#~loadMessengerCache">loadMessengerCache</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-content-cache.html#~markChatAsReadInCache">markChatAsReadInCache</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-content-cache.html#~updateChatList">updateChatList</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-content-cache.html#~updateChatMessages">updateChatMessages</a></li></ul></li><li><a href="module-server_websocket_messenger-refresh.html">server/websocket/messenger-refresh</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-refresh.html#~performMessengerRefresh">performMessengerRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-refresh.html#~startMessengerAutoRefresh">startMessengerAutoRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-refresh.html#~stopMessengerAutoRefresh">stopMessengerAutoRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_messenger-refresh.html#~triggerImmediateMessengerRefresh">triggerImmediateMessengerRefresh</a></li></ul></li><li><a href="module-server_websocket_staff-refresh.html">server/websocket/staff-refresh</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-server_websocket_staff-refresh.html#~performStaffRefresh">performStaffRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_staff-refresh.html#~startStaffAutoRefresh">startStaffAutoRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_staff-refresh.html#~stopStaffAutoRefresh">stopStaffAutoRefresh</a></li><li data-type='method' style='display: none;'><a href="module-server_websocket_staff-refresh.html#~triggerImmediateStaffRefresh">triggerImmediateStaffRefresh</a></li></ul></li><li><a href="module-stock-manager.html">stock-manager</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-stock-manager.html#.calculatePriceStats">calculatePriceStats</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#.closeStockManager">closeStockManager</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#.initStockManager">initStockManager</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#.initializeChart">initializeChart</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#.openCompanyDetail">openCompanyDetail</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#.renderChartSection">renderChartSection</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#.showBuyDialog">showBuyDialog</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#.showSellDialog">showSellDialog</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#.showStockManager">showStockManager</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#.showStockManagerIpoAlerts">showStockManagerIpoAlerts</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~calculateMA">calculateMA</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~calculateSharePriceTier">calculateSharePriceTier</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~closeCompanyDetail">closeCompanyDetail</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~createEnhancedChart">createEnhancedChart</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~createMASeries">createMASeries</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~createMarketRow">createMarketRow</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~createTierRow">createTierRow</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~destroyChart">destroyChart</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~escapeHtml">escapeHtml</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~estimatePurchaseDateFromPrice">estimatePurchaseDateFromPrice</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~filterDataByTimeframe">filterDataByTimeframe</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~formatPurchaseDate">formatPurchaseDate</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~generateMarketRowHtml">generateMarketRowHtml</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~handleIncreaseSharesClick">handleIncreaseSharesClick</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~initTooltipSystem">initTooltipSystem</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~loadInvestments">loadInvestments</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~loadInvestors">loadInvestors</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~loadIpoAlerts">loadIpoAlerts</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~loadMarket">loadMarket</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~loadMarketList">loadMarketList</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~loadMoreMarketItems">loadMoreMarketItems</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~loadPortfolio">loadPortfolio</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~refreshIpoAlertTab">refreshIpoAlertTab</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~renderIpoAlertsTable">renderIpoAlertsTable</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~resetMarketState">resetMarketState</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~setupChartToolbar">setupChartToolbar</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~setupCompanyNameClickHandlers">setupCompanyNameClickHandlers</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~setupInvestmentSellButtons">setupInvestmentSellButtons</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~setupMarketRowClickHandlers">setupMarketRowClickHandlers</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~setupMarketScrollHandler">setupMarketScrollHandler</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~setupTooltips">setupTooltips</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~showIncreaseSharesModal">showIncreaseSharesModal</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~switchTab">switchTab</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~updateChart">updateChart</a></li><li data-type='method' style='display: none;'><a href="module-stock-manager.html#~updateMovingAverages">updateMovingAverages</a></li></ul></li><li><a href="module-ui-dialogs.html">ui-dialogs</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-ui-dialogs.html#.buyCampaign">buyCampaign</a></li><li data-type='method' style='display: none;'><a href="module-ui-dialogs.html#.closeCampaignsOverlay">closeCampaignsOverlay</a></li><li data-type='method' style='display: none;'><a href="module-ui-dialogs.html#.closeSettings">closeSettings</a></li><li data-type='method' style='display: none;'><a href="module-ui-dialogs.html#.showCampaignsOverlay">showCampaignsOverlay</a></li><li data-type='method' style='display: none;'><a href="module-ui-dialogs.html#.showConfirmDialog">showConfirmDialog</a></li><li data-type='method' style='display: none;'><a href="module-ui-dialogs.html#.showContactList">showContactList</a></li><li data-type='method' style='display: none;'><a href="module-ui-dialogs.html#.showPurchaseDialog">showPurchaseDialog</a></li><li data-type='method' style='display: none;'><a href="module-ui-dialogs.html#.showSettings">showSettings</a></li></ul></li><li><a href="module-utils.html">utils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-utils.html#.escapeHtml">escapeHtml</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.formatCompactNumber">formatCompactNumber</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.formatNumber">formatNumber</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.getCO2PriceClass">getCO2PriceClass</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.getFuelPriceClass">getFuelPriceClass</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.isMobileDevice">isMobileDevice</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.loadBackupInfo">loadBackupInfo</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.loadServerConfig">loadServerConfig</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.registerServiceWorker">registerServiceWorker</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.renderStars">renderStars</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.requestNotificationPermission">requestNotificationPermission</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.showNotification">showNotification</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.showSideNotification">showSideNotification</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#.toGameCode">toGameCode</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~formatFileSize">formatFileSize</a></li><li data-type='method' style='display: none;'><a href="module-utils.html#~updateHostInfo">updateHostInfo</a></li></ul></li><li><a href="module-vessel-appearance-editor.html">vessel-appearance-editor</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#.getVesselImageOnerror">getVesselImageOnerror</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#.handleVesselImageError">handleVesselImageError</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#.initVesselAppearanceEditor">initVesselAppearanceEditor</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#.openAppearanceEditor">openAppearanceEditor</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#~buildSvgUrl">buildSvgUrl</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#~closeAppearanceEditor">closeAppearanceEditor</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#~getFormData">getFormData</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#~handleImageSelection">handleImageSelection</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#~handleRemoveCustomImage">handleRemoveCustomImage</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#~resetColorValues">resetColorValues</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#~resizeImage">resizeImage</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#~saveAppearance">saveAppearance</a></li><li data-type='method' style='display: none;'><a href="module-vessel-appearance-editor.html#~updateSvgPreview">updateSvgPreview</a></li></ul></li><li><a href="module-vessel-building.html">vessel-building</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-vessel-building.html#.initBuildShipModal">initBuildShipModal</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#.openBuildShipModal">openBuildShipModal</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~applyPerkEffects">applyPerkEffects</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~buildPreviewUrl">buildPreviewUrl</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~calculateBaseRangeFromCapacity">calculateBaseRangeFromCapacity</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~calculateBaseStats">calculateBaseStats</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~calculateGameBaseSpeed">calculateGameBaseSpeed</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~calculatePrice">calculatePrice</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~calculateSpeedForEngine">calculateSpeedForEngine</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~closeBuildShipModal">closeBuildShipModal</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~formatBuildTime">formatBuildTime</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~interpolate">interpolate</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~nextStep">nextStep</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~prevStep">prevStep</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~renderCurrentStep">renderCurrentStep</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~renderStep1">renderStep1</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~renderStep3">renderStep3</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~renderStep4">renderStep4</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~renderStep5">renderStep5</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~submitBuild">submitBuild</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~updateStatsPreview">updateStatsPreview</a></li><li data-type='method' style='display: none;'><a href="module-vessel-building.html#~updateSvgPreview">updateSvgPreview</a></li></ul></li><li><a href="module-vessel-management.html">vessel-management</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-vessel-management.html#.departAllVessels">departAllVessels</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#.openRepairAndDrydockDialog">openRepairAndDrydockDialog</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#.purchaseSingleVessel">purchaseSingleVessel</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#.updateLockStateFromServer">updateLockStateFromServer</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#.updateVesselCount">updateVesselCount</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~createVesselCard">createVesselCard</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~displayFilteredVessels">displayFilteredVessels</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~executeDrydock">executeDrydock</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~getAvailableAnchorSlots">getAvailableAnchorSlots</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~getCO2EfficiencyClass">getCO2EfficiencyClass</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~getCapacityDisplay">getCapacityDisplay</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~getFuelEfficiencyClass">getFuelEfficiencyClass</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~loadCartFromStorage">loadCartFromStorage</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~loadMorePendingVessels">loadMorePendingVessels</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~loadMoreVessels">loadMoreVessels</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~populateDynamicFilters">populateDynamicFilters</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~renderDrydockTab">renderDrydockTab</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~renderRepairTab">renderRepairTab</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~saveCartToStorage">saveCartToStorage</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~showRepairAndDrydockDialog">showRepairAndDrydockDialog</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~updateCapacityDropdowns">updateCapacityDropdowns</a></li><li data-type='method' style='display: none;'><a href="module-vessel-management.html#~vesselPassesFilters">vesselPassesFilters</a></li></ul></li><li><a href="module-vessel-selling.html">vessel-selling</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#.bulkSellVessels">bulkSellVessels</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#.closeSellVesselsOverlay">closeSellVesselsOverlay</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#.openSellVesselsOverlay">openSellVesselsOverlay</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#.refreshVesselsForSale">refreshVesselsForSale</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#.setSellFilter">setSellFilter</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#.showSellCart">showSellCart</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~clearSellCartCache">clearSellCartCache</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~displaySellVessels">displaySellVessels</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~fetchAllSellPrices">fetchAllSellPrices</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~getCO2EfficiencyClass">getCO2EfficiencyClass</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~getCapacityDisplay">getCapacityDisplay</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~getFuelEfficiencyClass">getFuelEfficiencyClass</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~groupVesselsByModel">groupVesselsByModel</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~loadSellCartFromCache">loadSellCartFromCache</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~loadUserVesselsForSale">loadUserVesselsForSale</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~removeVesselSelectionFromCart">removeVesselSelectionFromCart</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~saveSellCartToCache">saveSellCartToCache</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~updateBulkSellButton">updateBulkSellButton</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~updateSelectButtonState">updateSelectButtonState</a></li><li data-type='method' style='display: none;'><a href="module-vessel-selling.html#~updateVesselSelectionInCart">updateVesselSelectionInCart</a></li></ul></li></ul></li><li class="nav-list-toggle"><a>Global</a><ul style="display: none;"><li><a href="global.html#buildNav">buildNav</a></li><li><a href="global.html#crypto">crypto</a></li><li><a href="global.html#deleteAllLogs">deleteAllLogs</a></li><li><a href="global.html#escapeCSVFormula">escapeCSVFormula</a></li><li><a href="global.html#express">express</a></li><li><a href="global.html#extractAllVesselsFromLog">extractAllVesselsFromLog</a></li><li><a href="global.html#extractCashFromLog">extractCashFromLog</a></li><li><a href="global.html#extractPerItemPriceFromLog">extractPerItemPriceFromLog</a></li><li><a href="global.html#extractPriceFromLog">extractPriceFromLog</a></li><li><a href="global.html#extractVesselFromLog">extractVesselFromLog</a></li><li><a href="global.html#flushAllToDisk">flushAllToDisk</a></li><li><a href="global.html#formatDetailsAsTXT">formatDetailsAsTXT</a></li><li><a href="global.html#formatFileSize">formatFileSize</a></li><li><a href="global.html#formatLogsAsCSV">formatLogsAsCSV</a></li><li><a href="global.html#formatLogsAsTXT">formatLogsAsTXT</a></li><li><a href="global.html#fs">fs</a></li><li><a href="global.html#generateContainerSvg">generateContainerSvg</a></li><li><a href="global.html#generateTankerSvg">generateTankerSvg</a></li><li><a href="global.html#generateVesselSvg">generateVesselSvg</a></li><li><a href="global.html#getCategoryFromAction">getCategoryFromAction</a></li><li><a href="global.html#getContextsFromAutopilot">getContextsFromAutopilot</a></li><li><a href="global.html#getLogCount">getLogCount</a></li><li><a href="global.html#getLogEntries">getLogEntries</a></li><li><a href="global.html#getLogFileSize">getLogFileSize</a></li><li><a href="global.html#getPublicBaseDir">getPublicBaseDir</a></li><li><a href="global.html#getSourceFromAction">getSourceFromAction</a></li><li><a href="global.html#getTransactionType">getTransactionType</a></li><li><a href="global.html#isContainerVessel">isContainerVessel</a></li><li><a href="global.html#isDepartInProgress">isDepartInProgress</a></li><li><a href="global.html#loadBaseContainerSvg">loadBaseContainerSvg</a></li><li><a href="global.html#loadBaseTankerSvg">loadBaseTankerSvg</a></li><li><a href="global.html#lockBulkBuyButton">lockBulkBuyButton</a></li><li><a href="global.html#lockCo2Button">lockCo2Button</a></li><li><a href="global.html#lockCoopButtons">lockCoopButtons</a></li><li><a href="global.html#lockDepartButton">lockDepartButton</a></li><li><a href="global.html#lockDrydockButton">lockDrydockButton</a></li><li><a href="global.html#lockFuelButton">lockFuelButton</a></li><li><a href="global.html#lockRepairButton">lockRepairButton</a></li><li><a href="global.html#logAutopilotAction">logAutopilotAction</a></li><li><a href="global.html#publish">publish</a></li><li><a href="global.html#searchInObject">searchInObject</a></li><li><a href="global.html#showAnchorTimer">showAnchorTimer</a></li><li><a href="global.html#shutdown">shutdown</a></li><li><a href="global.html#unlockBulkBuyButton">unlockBulkBuyButton</a></li><li><a href="global.html#unlockCo2Button">unlockCo2Button</a></li><li><a href="global.html#unlockCoopButtons">unlockCoopButtons</a></li><li><a href="global.html#unlockDepartButton">unlockDepartButton</a></li><li><a href="global.html#unlockDrydockButton">unlockDrydockButton</a></li><li><a href="global.html#unlockFuelButton">unlockFuelButton</a></li><li><a href="global.html#unlockRepairButton">unlockRepairButton</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">public/js/modules/harbor-map/map-controller.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Harbor Map Controller
 * Handles Leaflet.js map initialization, rendering, and user interactions
 * ONLY renders data - NO data processing (all logic in backend)
 *
 * @module harbor-map/map-controller
 */

import { fetchHarborMapOverview, fetchVesselReachablePorts, getCachedOverview } from './api-client.js';
import { showVesselPanel, hideVesselPanel } from './vessel-panel.js';
import logger from '../core/logger.js';
import { showPortPanel, hidePortPanel } from './port-panel.js';
import { hideRoutePanel } from './route-vessels-panel.js';
import { initializePanelDrag } from './panel-drag.js';
import {
  filterVessels,
  filterPorts,
  getVesselFilterOptions,
  getDemandFilterOptions,
  applyDemandFilter
} from './filters.js';
import { showSideNotification, isMobileDevice, escapeHtml, toGameCode } from '../utils.js';
import { initForecastCalendar, updateEventDiscount } from '../forecast-calendar.js';

// Map instance
let map = null;

/**
 * Returns the map instance for use in other modules
 * @returns {L.Map|null} The Leaflet map instance
 */
export function getMap() {
  return map;
}

// Layer groups
let vesselLayer = null;
let portLayer = null;
let routeLayer = null;
let weatherLayer = null;

// Marker cluster groups
let vesselClusterGroup = null; // For vessels enroute
let portLocationClusterGroup = null; // For ports + vessels in port (combined to prevent overlap)

// Current state
let currentPortFilter = localStorage.getItem('harborMapPortFilter') || 'my_ports'; // Port filter
let currentVesselFilter = localStorage.getItem('harborMapVesselFilter') || 'all_vessels'; // Vessel filter
let selectedVesselId = null;
let selectedPortCode = null;
let currentMapStyle = localStorage.getItem('harborMapStyle') || 'dark'; // 'standard', 'dark', or 'satellite'
let weatherEnabled = localStorage.getItem('harborMapWeather') === 'true' || false;
let weatherType = localStorage.getItem('harborMapWeatherType') || 'off'; // 'off', 'rain', 'cloud'

// Raw data (unfiltered - loaded once from API)
let rawVessels = [];
let rawPorts = [];

// Port demand cache - persists across rawPorts refresh
// Key: port code, Value: { demand } object
const portDemandCache = new Map();

// Weather control reference
let weatherControl = null;

// Environmental Layer - Rotating button (off -> wind -> clouds -> temperature -> off)
let currentEnvLayer = localStorage.getItem('harborMapEnvLayer') || 'off'; // 'off', 'wind', 'clouds', 'temperature'
let envLayer = null;
let envLayerControl = null;

// POI Layer - Rotating button (off -> museums -> wrecks -> off)
// Note: POI layer planned but not implemented yet

// Current data (for route filtering)
let currentVessels = [];
let currentPorts = [];
let currentRouteFilter = localStorage.getItem('harborMapRouteFilter') || null; // null = show all, string = port pair key (e.g., "hamburg&lt;>new_york")
let currentPortPairGroups = null; // Port-pair groups from API (for route filter dropdown)

// Port scope and demand filter states (from filter modal)
let currentPortScope = localStorage.getItem('harborMapPortScope') || 'my_ports'; // 'my_ports' or 'all_ports'
let currentDemandMaxFilter = localStorage.getItem('harborMapDemandMax') || '';
let currentDemandCurrentFilter = localStorage.getItem('harborMapDemandCurrent') || '';

// Filter modal state
let filterModalDragging = false;
let filterModalDragOffset = { x: 0, y: 0 };

/**
 * Gets current ports data
 * @returns {Array&lt;Object>} Current ports array
 */
export function getCurrentPorts() {
  return currentPorts;
}

/**
 * Gets overview data for external modules (route-planner)
 * @returns {Object} Object with vessels, ports, and portPairGroups
 */
export function getOverviewData() {
  return {
    vessels: currentVessels,
    ports: currentPorts,
    portPairGroups: currentPortPairGroups
  };
}

// Previous state (for restoration when panel closes)
let previousMapState = {
  vessels: [],
  ports: [],
  zoom: null,
  center: null
};

// Tile layers
let currentTileLayer = null;
const tileLayers = {
  standard: {
    name: 'Standard',
    url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    attribution: ' OpenStreetMap contributors'
  },
  dark: {
    name: 'Dark Mode',
    url: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
    attribution: ' OpenStreetMap contributors  CARTO'
  },
  satellite: {
    name: 'Satellite',
    url: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
    attribution: 'Tiles  Esri'
  }
};

/**
 * Gets vessel type from capacity_type field
 *
 * @param {string} capacityType - Capacity type ('container' or 'tanker')
 * @returns {string} - 'container', 'tanker', or 'unknown'
 */
function getVesselType(capacityType) {
  if (!capacityType) return 'unknown';
  const lower = capacityType.toLowerCase();
  if (lower === 'container') return 'container';
  if (lower === 'tanker') return 'tanker';
  return 'unknown';
}

/**
 * Creates vessel icon with type and status classes
 *
 * @param {string} status - Vessel status ('enroute', 'port', 'anchor')
 * @param {string} vesselType - Vessel type ('container', 'tanker', 'unknown')
 * @param {number} heading - Vessel heading in degrees (0-360), optional
 * @returns {L.DivIcon} Leaflet icon
 */
function createVesselIcon(status, vesselType, heading = 0) {
  const statusClass = status === 'enroute' ? 'sailing' : status;
  const typeClass = vesselType !== 'unknown' ? vesselType : '';
  const className = `vessel-marker ${statusClass} ${typeClass}`.trim();

  // Apply rotation to triangle
  const rotation = heading ? `transform: rotate(${heading}deg);` : '';

  return L.divIcon({
    className,
    html: `&lt;div class="vessel-icon" style="${rotation}">&lt;/div>`,
    iconSize: [12, 16],
    iconAnchor: [6, 8]
  });
}

/**
 * Calculates heading from two coordinates
 *
 * @param {Object} from - {lat, lon}
 * @param {Object} to - {lat, lon}
 * @returns {number} Heading in degrees
 */
function calculateHeading(from, to) {
  const lat1 = from.lat * Math.PI / 180;
  const lat2 = to.lat * Math.PI / 180;
  const dLon = (to.lon - from.lon) * Math.PI / 180;

  const y = Math.sin(dLon) * Math.cos(lat2);
  const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);

  let heading = Math.atan2(y, x) * 180 / Math.PI;
  heading = (heading + 360) % 360; // Normalize to 0-360

  return heading;
}

const portIcons = {
  default: L.divIcon({ className: 'port-marker', html: '&lt;div class="port-icon">&lt;/div>', iconSize: [14, 14], iconAnchor: [7, 7] }),
  origin: L.divIcon({ className: 'port-marker origin', html: '&lt;div class="port-icon">&lt;/div>', iconSize: [12, 12], iconAnchor: [6, 6] }),
  destination: L.divIcon({ className: 'port-marker destination', html: '&lt;div class="port-icon">&lt;/div>', iconSize: [12, 12], iconAnchor: [6, 6] })
};

/**
 * Initializes Leaflet map with OpenStreetMap tiles
 * Sets up layer groups and marker clusters
 *
 * @param {string} containerId - HTML element ID for map container
 * @returns {void}
 * @example
 * initMap('harbor-map-container');
 */
export function initMap(containerId) {
  // Initialize map centered on northern hemisphere
  map = L.map(containerId, {
    center: [20, 0], // Center on northern hemisphere (20 North, 0 longitude)
    zoom: 1.80,
    minZoom: 1.80, // Minimum zoom = initial zoom (can't zoom out further)
    maxZoom: 18,
    zoomDelta: 0.1, // Zoom in 0.1 steps instead of 1.0
    zoomSnap: 0.1, // Allow fractional zoom levels (0.1 precision)
    wheelPxPerZoomLevel: 120, // Mouse wheel sensitivity (higher = slower zooming)
    scrollWheelZoom: true, // Enable scroll wheel zoom
    attributionControl: false, // Disable attribution control
    worldCopyJump: true // Enable world wrapping (jump to copy when panning)
  });

  // Set maxBounds AFTER initialization to avoid Leaflet warning
  map.setMaxBounds([[-90, -180], [90, 180]]);
  map.options.maxBoundsViscosity = 0.8; // Allow some dragging beyond bounds when panel is open

  // Add saved tile layer (or default to dark)
  currentTileLayer = L.tileLayer(tileLayers[currentMapStyle].url, {
    maxZoom: 19
  }).addTo(map);

  console.log(`[Harbor Map] Initialized with saved style: ${currentMapStyle}`);

  // Set map container background color based on theme
  const mapContainer = map.getContainer();
  const backgroundColor = currentMapStyle === 'standard' ? '#e0e0e0' : '#1f1f1f';
  mapContainer.style.backgroundColor = backgroundColor;

  // Add mobile class to overlay for mobile-specific styling
  const isMobile = isMobileDevice();
  if (isMobile) {
    const overlay = document.querySelector('.harbor-map-overlay');
    if (overlay) {
      overlay.classList.add('mobile-view');
      logger.debug('[Harbor Map] Mobile view detected - applying mobile layout');
    }
  }

  // Initialize layer groups
  vesselLayer = L.layerGroup().addTo(map);
  portLayer = L.layerGroup().addTo(map);
  routeLayer = L.layerGroup().addTo(map);

  // Initialize marker cluster groups with custom icons
  vesselClusterGroup = L.markerClusterGroup({
    maxClusterRadius: 15,
    spiderfyOnMaxZoom: true,
    showCoverageOnHover: false,
    zoomToBoundsOnClick: true,
    iconCreateFunction: function(cluster) {
      const markers = cluster.getAllChildMarkers();
      let containerCount = 0;
      let tankerCount = 0;

      // Count vessel types in cluster
      markers.forEach(marker => {
        const className = marker.options.icon.options.className;
        if (className.includes('container')) {
          containerCount++;
        } else if (className.includes('tanker')) {
          tankerCount++;
        }
      });

      const total = markers.length;

      // Calculate mixed color based on composition (pastel colors)
      let bgColor;
      if (containerCount === total) {
        bgColor = '#fde68a'; // Pastel yellow (all containers)
      } else if (tankerCount === total) {
        bgColor = '#fdba74'; // Pastel orange (all tankers)
      } else {
        // Mixed cluster - blend colors
        const containerRatio = containerCount / total;
        const tankerRatio = tankerCount / total;

        if (containerRatio > tankerRatio) {
          bgColor = '#fcd34d'; // Light yellow-orange (more containers)
        } else if (tankerRatio > containerRatio) {
          bgColor = '#fda874'; // Light orange-yellow (more tankers)
        } else {
          bgColor = '#fbbf72'; // Balanced pastel mix
        }
      }

      return L.divIcon({
        html: `&lt;div style="background-color: ${bgColor}; opacity: 0.85; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #78350f; font-weight: 600; font-size: 10px; border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 2px 8px rgba(0,0,0,0.15);">${total}&lt;/div>`,
        className: 'vessel-cluster-icon',
        iconSize: L.point(20, 20)
      });
    }
  });

  // Combined cluster group for ports + vessels in port (to prevent overlap)
  portLocationClusterGroup = L.markerClusterGroup({
    maxClusterRadius: 30, // Larger radius to catch overlapping port + vessel markers
    spiderfyOnMaxZoom: true,
    showCoverageOnHover: false,
    zoomToBoundsOnClick: true,
    iconCreateFunction: function(cluster) {
      // Show combined count - blue color like normal port clusters
      const count = cluster.getChildCount();
      return L.divIcon({
        html: `&lt;div style="background-color: #bfdbfe; opacity: 0.85; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #1e3a8a; font-weight: 600; font-size: 10px; border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 2px 8px rgba(0,0,0,0.15);">${count}&lt;/div>`,
        className: 'port-location-cluster-icon',
        iconSize: L.point(20, 20)
      });
    }
  });

  vesselLayer.addLayer(vesselClusterGroup);
  portLayer.addLayer(portLocationClusterGroup); // Use combined cluster instead of portClusterGroup

  // Add custom controls
  addCustomControls();

  // Initialize weather layer and dblclick handler only if enableWeatherData is enabled
  const settings = window.getSettings ? window.getSettings() : {};
  if (settings.enableWeatherData === true) {
    // Initialize weather layer with saved type
    if (weatherType !== 'off') {
      toggleWeatherLayer(weatherType);
    }

    // Add long-press handler for weather info
    let longPressTimer = null;
    let longPressLatlng = null;
    const LONG_PRESS_DELAY = 700; // milliseconds

    const handleMouseDown = (e) => {
      longPressLatlng = e.latlng;
      longPressTimer = setTimeout(async () => {
        await showWeatherInfo(longPressLatlng);
        longPressTimer = null;
      }, LONG_PRESS_DELAY);
    };

    const handleMouseUp = () => {
      if (longPressTimer) {
        clearTimeout(longPressTimer);
        longPressTimer = null;
      }
    };

    const handleMouseMove = () => {
      if (longPressTimer) {
        clearTimeout(longPressTimer);
        longPressTimer = null;
      }
    };

    map.on('mousedown', handleMouseDown);
    map.on('mouseup', handleMouseUp);
    map.on('mousemove', handleMouseMove);
  }

  // Initialize panel dragging
  initializePanelDrag();
  logger.debug('[Harbor Map] Panel drag initialized');
}

/**
 * Shows weather info popup for a location
 *
 * @param {L.LatLng} latlng - Location coordinates
 * @param {string} tooltipContent - Optional tooltip content to show above weather
 * @returns {Promise&lt;void>}
 */
async function showWeatherInfo(latlng, tooltipContent = null) {
  try {
    // Check if weather data is enabled in settings
    const settings = window.getSettings ? window.getSettings() : {};
    if (settings.enableWeatherData === false) {
      return; // Weather data disabled, do nothing
    }

    // Show loading popup
    const loadingPopup = L.popup()
      .setLatLng(latlng)
      .setContent('&lt;div style="padding: 8px; text-align: center;"> Loading weather...&lt;/div>')
      .openOn(map);

    // Fetch location name and weather data in parallel
    const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latlng.lat.toFixed(4)}&amp;longitude=${latlng.lng.toFixed(4)}&amp;current_weather=true`;
    const geocodeUrl = `https://nominatim.openstreetmap.org/reverse?format=json&amp;lat=${latlng.lat.toFixed(4)}&amp;lon=${latlng.lng.toFixed(4)}&amp;zoom=10`;

    const [weatherResponse, geocodeResponse] = await Promise.all([
      fetch(weatherUrl),
      fetch(geocodeUrl, { headers: { 'User-Agent': 'ShippingManager' } })
    ]);

    const data = await weatherResponse.json();

    if (!data.current_weather) {
      throw new Error('No weather data available');
    }

    const weather = data.current_weather;

    // Try to get location name from geocoding
    let locationName = null;
    try {
      const geocodeData = await geocodeResponse.json();
      // Try to get city, town, village, or fallback
      locationName = geocodeData.address?.city ||
                    geocodeData.address?.town ||
                    geocodeData.address?.village ||
                    geocodeData.address?.county ||
                    null;
    } catch {
      // Geocoding failed, will show coordinates instead
    }

    // Weather code to emoji mapping
    const weatherEmoji = {
      0: '',    // Clear sky
      1: '',   // Mainly clear
      2: '',    // Partly cloudy
      3: '',    // Overcast
      45: '',  // Fog
      48: '',  // Depositing rime fog
      51: '',  // Drizzle light
      53: '',  // Drizzle moderate
      55: '',  // Drizzle dense
      61: '',  // Rain slight
      63: '',  // Rain moderate
      65: '',  // Rain heavy
      71: '',  // Snow fall slight
      73: '',  // Snow fall moderate
      75: '',  // Snow fall heavy
      77: '',   // Snow grains
      80: '',  // Rain showers slight
      81: '',  // Rain showers moderate
      82: '',  // Rain showers violent
      85: '',  // Snow showers slight
      86: '',  // Snow showers heavy
      95: '',   // Thunderstorm
      96: '',   // Thunderstorm with hail
      99: ''    // Thunderstorm with heavy hail
    };

    const icon = weatherEmoji[weather.weathercode] || '';
    const temp = weather.temperature.toFixed(1);
    const wind = weather.windspeed.toFixed(0);

    // Theme-based colors - more transparency for better map visibility
    const isDark = currentMapStyle === 'dark' || currentMapStyle === 'satellite';
    const bgColor = isDark ? 'rgba(31, 31, 31, 0.7)' : 'rgba(255, 255, 255, 0.75)';
    const borderColor = isDark ? 'rgba(255, 255, 255, 0.2)' : 'rgba(0, 0, 0, 0.2)';
    const boxShadow = isDark ? '0 2px 8px rgba(0, 0, 0, 0.3)' : '0 2px 8px rgba(0, 0, 0, 0.15)';
    const textColor = isDark ? '#e5e7eb' : '#1f2937';
    const tempColor = isDark ? '#60a5fa' : '#2563eb';

    // Display location name if available, otherwise coordinates
    const locationText = locationName
      ? ` ${locationName}`
      : ` ${latlng.lat.toFixed(2)}, ${latlng.lng.toFixed(2)}`;

    // Create combined popup with tooltip content and weather
    const tooltipSection = tooltipContent ? `
      &lt;div style="padding: 6px 8px; font-size: 11px; line-height: 1.4; background: ${bgColor}; color: ${textColor}; border: 1px solid ${borderColor}; border-radius: 4px; box-shadow: ${boxShadow}; margin-bottom: 4px;">
        ${tooltipContent}
      &lt;/div>
    ` : '';

    const content = `
      &lt;div>
        ${tooltipSection}
        &lt;div style="padding: 4px 8px; font-size: 11px; line-height: 1.4; background: ${bgColor}; color: ${textColor}; border: 1px solid ${borderColor}; border-radius: 4px; box-shadow: ${boxShadow};">
          &lt;div style="display: flex; align-items: center; gap: 6px;">
            &lt;span style="font-size: 18px;">${icon}&lt;/span>
            &lt;div>
              &lt;div style="font-size: 14px; font-weight: 600; color: ${tempColor};">${temp}C&lt;/div>
              &lt;div style="font-size: 9px; opacity: 0.7;"> ${wind} km/h&lt;/div>
              &lt;div style="font-size: 8px; opacity: 0.6; margin-top: 2px;">${locationText}&lt;/div>
            &lt;/div>
          &lt;/div>
        &lt;/div>
      &lt;/div>
    `;

    // Update popup with weather data
    loadingPopup.setContent(content);
  } catch (error) {
    console.error('[Harbor Map] Failed to fetch weather:', error);
    L.popup()
      .setLatLng(latlng)
      .setContent('&lt;div style="padding: 8px; text-align: center; color: #ef4444;"> Weather unavailable&lt;/div>')
      .openOn(map);
  }
}

/**
 * Toggles weather overlay (Rain Radar or Cloud Cover)
 *
 * @param {string} type - Weather layer type: 'off', 'rain', 'cloud'
 * @returns {void}
 */
function toggleWeatherLayer(type) {
  // Remove existing weather layer
  if (weatherLayer) {
    map.removeLayer(weatherLayer);
    weatherLayer = null;
  }

  weatherType = type;
  localStorage.setItem('harborMapWeatherType', type);

  if (type === 'rain') {
    // Rain Radar (RainViewer)
    const now = new Date();
    const timestamp = Math.floor(now.getTime() / 1000 / 600) * 600;

    weatherLayer = L.tileLayer(
      `https://tilecache.rainviewer.com/v2/radar/${timestamp}/512/{z}/{x}/{y}/2/1_1.png`,
      {
        opacity: 0.6,
        attribution: ' RainViewer',
        maxZoom: 18
      }
    );

    weatherLayer.addTo(map);
    weatherEnabled = true;
    localStorage.setItem('harborMapWeather', 'true');
    logger.debug('[Harbor Map] Rain radar enabled');
  } else {
    // Off
    weatherEnabled = false;
    localStorage.setItem('harborMapWeather', 'false');
    logger.debug('[Harbor Map] Weather overlay disabled');
  }
}

/**
 * Adds custom Leaflet controls (filter, refresh)
 * Positioned in top-right corner below zoom controls
 */
function addCustomControls() {
  // Filter Button Control - Opens filter modal
  const FilterButtonControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom leaflet-control-filter-buttons');

      container.innerHTML = `
        &lt;button class="map-filter-btn" title="Open Filter Panel">Filter&lt;/button>
        &lt;button class="map-reset-btn" title="Reset All Filters">Reset&lt;/button>
      `;

      // Prevent map click propagation
      L.DomEvent.disableClickPropagation(container);

      // Filter button opens modal
      container.querySelector('.map-filter-btn').addEventListener('click', () => {
        openFilterModal();
      });

      // Reset button clears all filters
      container.querySelector('.map-reset-btn').addEventListener('click', async () => {
        await resetAllFilters();
      });

      return container;
    }
  });

  // Refresh Control
  const RefreshControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom leaflet-control-refresh');
      container.innerHTML = '&lt;button title="Refresh">&lt;/button>';

      // Prevent map click propagation
      L.DomEvent.disableClickPropagation(container);

      // Add click listener
      container.querySelector('button').addEventListener('click', async () => {
        const { clearHarborMapCache } = await import('./api-client.js');
        await clearHarborMapCache();
        await loadOverview();
      });

      return container;
    }
  });

  // Map Style Toggle Control (cycles through: standard -> dark -> satellite -> standard)
  const MapStyleControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom map-style-toggle');

      // Emoji map for each style
      const styleEmojis = {
        'standard': '',
        'dark': '',
        'satellite': ''
      };

      container.innerHTML = styleEmojis[currentMapStyle];
      container.title = 'Map Style';

      // Prevent map click propagation
      L.DomEvent.disableClickPropagation(container);

      // Add click listener - cycle through styles
      container.addEventListener('click', () => {
        const styles = ['standard', 'dark', 'satellite'];
        const currentIndex = styles.indexOf(currentMapStyle);
        const nextIndex = (currentIndex + 1) % styles.length;
        const nextStyle = styles[nextIndex];

        changeTileLayer(nextStyle);
        container.innerHTML = styleEmojis[nextStyle];

        // Reset tooltip
        container.removeAttribute('title');
        setTimeout(() => {
          container.title = 'Map Style';
        }, 100);
      });

      return container;
    }
  });

  // Fullscreen Control
  const FullscreenControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom leaflet-control-fullscreen');
      container.innerHTML = '&lt;button title="Fullscreen">&lt;/button>';

      // Prevent map click propagation
      L.DomEvent.disableClickPropagation(container);

      // Add click listener
      container.querySelector('button').addEventListener('click', () => {
        const mapWrapper = document.querySelector('.chat-area-wrapper');
        const button = container.querySelector('button');

        if (!mapWrapper) {
          console.error('[Harbor Map] Cannot find map wrapper for fullscreen');
          return;
        }

        if (mapWrapper.classList.contains('fullscreen')) {
          // Exit fullscreen
          mapWrapper.classList.remove('fullscreen');
          button.innerHTML = '';
          button.title = 'Fullscreen';
        } else {
          // Enter fullscreen
          mapWrapper.classList.add('fullscreen');
          button.innerHTML = '';
          button.title = 'Exit Fullscreen';
        }

        // Invalidate map size after transition
        setTimeout(() => {
          map.invalidateSize();
        }, 300);
      });

      return container;
    }
  });

  // Weather Control (Rain Radar Toggle)
  const WeatherControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom weather-toggle');

      const updateWeatherButton = () => {
        container.style.position = 'relative';

        if (weatherEnabled) {
          container.innerHTML = '';
        } else {
          container.innerHTML = '';
        }

        // Add or update strike-through line
        let strikeLine = container.querySelector('.weather-strike');
        if (!strikeLine) {
          strikeLine = document.createElement('div');
          strikeLine.className = 'weather-strike';
          strikeLine.style.cssText = `
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #ef4444;
            transform: translateY(-50%) rotate(-45deg);
            pointer-events: none;
          `;
          container.appendChild(strikeLine);
        }
        strikeLine.style.display = weatherEnabled ? 'none' : 'block';
      };

      updateWeatherButton();
      container.title = 'Rain Radar';

      // Prevent map click propagation
      L.DomEvent.disableClickPropagation(container);

      // Add click listener
      container.addEventListener('click', () => {
        weatherEnabled = !weatherEnabled;

        if (weatherEnabled) {
          toggleWeatherLayer('rain');
        } else {
          toggleWeatherLayer('off');
        }

        updateWeatherButton();

        // Reset tooltip
        container.removeAttribute('title');
        setTimeout(() => {
          container.title = 'Rain Radar';
        }, 100);
      });

      return container;
    }
  });

  // Environmental Layer Control - Rotating button (off -> wind -> clouds -> temperature -> off)
  const EnvironmentalLayerControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom env-layer-toggle');

      // Function to update button appearance
      const updateButton = (resetTooltip = false) => {
        let tooltipText = '';

        switch(currentEnvLayer) {
          case 'wind':
            container.innerHTML = '';
            container.style.opacity = '1';
            break;
          case 'clouds':
            container.innerHTML = '';
            container.style.opacity = '1';
            break;
          case 'temperature':
            container.innerHTML = '';
            container.style.opacity = '1';
            break;
          default: // 'off'
            container.innerHTML = '';
            container.style.opacity = '0.5';
            tooltipText = 'Environmental Layers';
            break;
        }

        // Update tooltip: remove old one, then set new one after delay
        if (resetTooltip) {
          container.removeAttribute('title');
          setTimeout(() => {
            if (tooltipText) {
              container.title = tooltipText;
            }
          }, 100);
        } else {
          if (tooltipText) {
            container.title = tooltipText;
          } else {
            container.removeAttribute('title');
          }
        }
      };

      // Function to start cloud layer (static for now)
      const startCloudAnimation = () => {
        stopCloudAnimation(); // Clean up any existing animation

        logger.debug('[Environmental] Adding cloud layer...');

        // Use single OWM clouds layer with higher opacity for better visibility
        const opacity = currentMapStyle === 'standard' ? 0.7 : 0.5;
        envLayer = L.OWM.clouds({showLegend: false, opacity: opacity});
        envLayer.addTo(map);
      };

      // Function to stop cloud layer
      const stopCloudAnimation = () => {
        if (envLayer &amp;&amp; map.hasLayer(envLayer)) {
          map.removeLayer(envLayer);
          envLayer = null;
        }

        logger.debug('[Environmental] Removed cloud layer');
      };

      // Function to switch to next layer
      const switchEnvLayer = (newLayer) => {
        // Stop cloud animation if switching away from clouds
        if (currentEnvLayer === 'clouds') {
          stopCloudAnimation();
        }

        // Remove old layer (non-animated)
        if (envLayer) {
          map.removeLayer(envLayer);
          envLayer = null;
        }

        // Add new layer
        if (newLayer !== 'off') {
          console.log(`[Environmental] Switching to ${newLayer} layer...`);
          switch(newLayer) {
            case 'wind':
              // Higher opacity in standard mode for better visibility
              const windOpacity = currentMapStyle === 'standard' ? 0.6 : 0.4;
              envLayer = L.OWM.wind({
                opacity: windOpacity,
                showLegend: false
              });
              envLayer.addTo(map);
              break;
            case 'clouds':
              // Use animated clouds
              startCloudAnimation();
              break;
            case 'temperature':
              // Higher opacity in standard mode for better visibility
              const tempOpacity = currentMapStyle === 'standard' ? 0.6 : 0.4;
              envLayer = L.OWM.temperature({showLegend: false, opacity: tempOpacity});
              envLayer.addTo(map);
              break;
          }
        }

        currentEnvLayer = newLayer;
        localStorage.setItem('harborMapEnvLayer', newLayer);
        updateButton(true); // Reset tooltip after click
      };

      L.DomEvent.disableClickPropagation(container);

      container.addEventListener('click', () => {
        // Rotate through: off -> wind -> clouds -> temperature -> off
        const nextLayer = {
          'off': 'wind',
          'wind': 'clouds',
          'clouds': 'temperature',
          'temperature': 'off'
        }[currentEnvLayer] || 'wind';

        switchEnvLayer(nextLayer);
      });

      updateButton();
      return container;
    }
  });

  // Zoom Level Display Control
  const ZoomDisplayControl = L.Control.extend({
    options: { position: 'bottomleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom zoom-display');
      container.style.cssText = `
        background: rgba(0, 0, 0, 0.7);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        pointer-events: none;
      `;

      const updateZoom = () => {
        const zoom = map.getZoom();
        container.innerHTML = `Zoom: ${zoom.toFixed(1)}`;
      };

      updateZoom();
      map.on('zoomend', updateZoom);

      return container;
    }
  });

  // Museums Layer Control - Simple toggle button (no zoom limit - not many museums)
  let museumsEnabled = localStorage.getItem('harborMapMuseumsEnabled') === 'true';
  let museumsMarkerLayer = null;

  const MuseumsLayerControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom museums-toggle');

      const updateButton = () => {
        container.style.position = 'relative';
        container.innerHTML = '';

        let strikeLine = container.querySelector('.museums-strike');
        if (!strikeLine) {
          strikeLine = document.createElement('div');
          strikeLine.className = 'museums-strike';
          strikeLine.style.cssText = `
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #ef4444;
            transform: translateY(-50%) rotate(-45deg);
            pointer-events: none;
          `;
          container.appendChild(strikeLine);
        }
        strikeLine.style.display = museumsEnabled ? 'none' : 'block';
      };

      updateButton();
      container.title = 'Maritime Museums';

      L.DomEvent.disableClickPropagation(container);

      container.addEventListener('click', async () => {
        museumsEnabled = !museumsEnabled;
        localStorage.setItem('harborMapMuseumsEnabled', museumsEnabled);

        if (museumsEnabled) {
          try {
            // Load all museums (no bbox - there aren't many)
            const response = await fetch(window.apiUrl(`/api/poi/museums`));
            if (!response.ok) return;

            const data = await response.json();
            const museums = data.museums || [];

            if (museums.length > 0) {
              museumsMarkerLayer = L.layerGroup();

              museums.forEach(poi => {
                if (!poi.lat || !poi.lon) return;

                const name = poi.tags?.name || 'Unknown Museum';
                const openingHours = poi.tags?.opening_hours || '';
                const website = poi.tags?.website || '';
                const wikipedia = poi.tags?.wikipedia || '';

                const icon = L.divIcon({
                  className: 'poi-marker',
                  html: `&lt;div style="font-size: 20px;">&lt;/div>`,
                  iconSize: [30, 30],
                  iconAnchor: [15, 15]
                });

                const marker = L.marker([poi.lat, poi.lon], { icon });

                let tooltipContent = `&lt;strong>${name}&lt;/strong>`;
                if (openingHours) tooltipContent += `&lt;br> ${openingHours}`;

                marker.bindTooltip(tooltipContent, {
                  direction: 'auto',
                  offset: [0, -10]
                });

                marker.on('click', async (e) => {
                  marker.closeTooltip();
                  let popupContent = `&lt;strong>${name}&lt;/strong>&lt;br>Museum`;
                  if (openingHours) popupContent += `&lt;br> ${openingHours}`;
                  if (website) popupContent += `&lt;br> &lt;a href="${website}" target="_blank" style="color: #4a9eff;">Website&lt;/a>`;
                  if (wikipedia) {
                    const wikiUrl = wikipedia.startsWith('http') ? wikipedia : `https://en.wikipedia.org/wiki/${wikipedia}`;
                    popupContent += `&lt;br> &lt;a href="${wikiUrl}" target="_blank" style="color: #4a9eff;">Wikipedia&lt;/a>`;
                  }
                  await showWeatherInfo(e.latlng, popupContent);
                });

                museumsMarkerLayer.addLayer(marker);
              });

              museumsMarkerLayer.addTo(map);
            }
          } catch (error) {
            console.error('[Museums] Load error:', error);
          }
        } else {
          if (museumsMarkerLayer &amp;&amp; map.hasLayer(museumsMarkerLayer)) {
            map.removeLayer(museumsMarkerLayer);
            museumsMarkerLayer = null;
          }
        }

        updateButton();

        // Reset tooltip
        container.removeAttribute('title');
        setTimeout(() => {
          container.title = 'Maritime Museums';
        }, 100);
      });

      if (museumsEnabled) {
        container.click();
      }

      return container;
    }
  });

  // Wrecks Layer Control - Simple toggle button
  let wrecksEnabled = localStorage.getItem('harborMapWrecksEnabled') === 'true';
  let wrecksMarkerLayer = null;
  let wrecksLoadTimeout = null; // Debounce timer for loading wrecks
  let lastWrecksBounds = null; // Track last loaded bounds to avoid duplicate loads

  // Function to load wrecks for current map view
  const loadWrecksForCurrentView = async () => {
    const currentZoom = map.getZoom();

    // Only load if enabled and zoom >= 5
    if (!wrecksEnabled || currentZoom &lt; 5) {
      return;
    }

    try {
      // Get current map bounds
      const bounds = map.getBounds();

      // Check if bounds changed significantly (more than 10% movement)
      if (lastWrecksBounds) {
        const lastSouth = lastWrecksBounds.getSouth();
        const lastWest = lastWrecksBounds.getWest();
        const lastNorth = lastWrecksBounds.getNorth();
        const lastEast = lastWrecksBounds.getEast();

        const currentSouth = bounds.getSouth();
        const currentWest = bounds.getWest();
        const currentNorth = bounds.getNorth();
        const currentEast = bounds.getEast();

        // Calculate how much the view has moved (as percentage of view size)
        const latDiff = lastNorth - lastSouth;
        const lngDiff = lastEast - lastWest;

        const southMove = Math.abs(currentSouth - lastSouth) / latDiff;
        const westMove = Math.abs(currentWest - lastWest) / lngDiff;
        const northMove = Math.abs(currentNorth - lastNorth) / latDiff;
        const eastMove = Math.abs(currentEast - lastEast) / lngDiff;

        const maxMove = Math.max(southMove, westMove, northMove, eastMove);

        // If view moved less than 10%, skip reload
        if (maxMove &lt; 0.1) {
          console.log(`[Wrecks] Skipping reload - view moved only ${(maxMove * 100).toFixed(1)}%`);
          return;
        }
      }

      // Remove old markers
      if (wrecksMarkerLayer &amp;&amp; map.hasLayer(wrecksMarkerLayer)) {
        map.removeLayer(wrecksMarkerLayer);
        wrecksMarkerLayer = null;
      }

      const bbox = `${bounds.getSouth()},${bounds.getWest()},${bounds.getNorth()},${bounds.getEast()}`;
      console.log(`[Wrecks] Loading with bbox: ${bbox}`);

      const response = await fetch(window.apiUrl(`/api/poi/wrecks?bbox=${encodeURIComponent(bbox)}`));
      if (!response.ok) return;

      const data = await response.json();
      const wrecks = data.wrecks || [];
      console.log(`[Wrecks] API returned ${wrecks.length} wrecks for bbox`);

      if (wrecks.length > 0) {
        wrecksMarkerLayer = L.layerGroup();

        wrecks.forEach(poi => {
          if (!poi.lat || !poi.lon) return;

          const name = poi.tags?.name || 'Unknown Wreck';
          const dateSunk = poi.tags?.['wreck:date_sunk'] || poi.tags?.['wreck:year_sunk'] || '';
          const depthMetres = poi.tags?.['wreck:depth_metres'] || '';
          const cargo = poi.tags?.['wreck:cargo'] || '';
          const wreckType = poi.tags?.['wreck:type'] || '';
          const visibleAtLowTide = poi.tags?.['wreck:visible_at_low_tide'] || '';
          const description = poi.tags?.description || '';
          const website = poi.tags?.website || '';
          const wikipedia = poi.tags?.wikipedia || '';

          const icon = L.divIcon({
            className: 'poi-marker',
            html: `&lt;div style="font-size: 20px;">&lt;/div>`,
            iconSize: [30, 30],
            iconAnchor: [15, 15]
          });

          const marker = L.marker([poi.lat, poi.lon], { icon });

          let tooltipContent = `&lt;strong>${name}&lt;/strong>&lt;br>Shipwreck`;
          if (dateSunk) tooltipContent += `&lt;br> Sunk: ${dateSunk}`;
          if (depthMetres) tooltipContent += `&lt;br> Depth: ${depthMetres}m`;

          marker.bindTooltip(tooltipContent, {
            direction: 'auto',
            offset: [0, -10]
          });

          marker.on('click', async (e) => {
            marker.closeTooltip();
            let popupContent = `&lt;strong>${name}&lt;/strong>`;
            if (wreckType) popupContent += ` (${wreckType})`;
            if (!wreckType) popupContent += `&lt;br>Shipwreck`;

            if (description) popupContent += `&lt;br>&lt;br>${description}`;
            if (dateSunk) popupContent += `&lt;br>&lt;br> Sunk: ${dateSunk}`;
            if (cargo) popupContent += `&lt;br> Cargo: ${cargo}`;
            if (depthMetres) popupContent += `&lt;br> Depth: ${depthMetres} metres`;
            if (visibleAtLowTide) popupContent += `&lt;br> Visible at low tide: ${visibleAtLowTide}`;

            if (website) popupContent += `&lt;br>&lt;br> &lt;a href="${website}" target="_blank" style="color: #4a9eff;">Website&lt;/a>`;
            if (wikipedia) {
              const wikiUrl = wikipedia.startsWith('http') ? wikipedia : `https://en.wikipedia.org/wiki/${wikipedia}`;
              popupContent += `&lt;br> &lt;a href="${wikiUrl}" target="_blank" style="color: #4a9eff;">Wikipedia&lt;/a>`;
            }
            await showWeatherInfo(e.latlng, popupContent);
          });

          wrecksMarkerLayer.addLayer(marker);
        });

        wrecksMarkerLayer.addTo(map);
        console.log(`[Wrecks] Loaded ${wrecks.length} wrecks for current view`);
      }

      // Store the bounds we just loaded to prevent duplicate loads
      lastWrecksBounds = bounds;
    } catch (error) {
      console.error('[Wrecks] Load error:', error);
    }
  };

  const WrecksLayerControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom wrecks-toggle');

      const updateButton = () => {
        container.style.position = 'relative';
        container.innerHTML = '';

        let strikeLine = container.querySelector('.wrecks-strike');
        if (!strikeLine) {
          strikeLine = document.createElement('div');
          strikeLine.className = 'wrecks-strike';
          strikeLine.style.cssText = `
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #ef4444;
            transform: translateY(-50%) rotate(-45deg);
            pointer-events: none;
          `;
          container.appendChild(strikeLine);
        }
        strikeLine.style.display = wrecksEnabled ? 'none' : 'block';
      };

      updateButton();
      container.title = 'Shipwrecks';

      L.DomEvent.disableClickPropagation(container);

      container.addEventListener('click', async () => {
        const currentZoom = map.getZoom();

        // If trying to enable but zoom is too low, show warning and don't enable
        if (!wrecksEnabled &amp;&amp; currentZoom &lt; 5) {
          showSideNotification(
            ` &lt;strong>Zoom in to see Wrecks&lt;/strong>&lt;br>&lt;br>Wrecks are only visible at zoom level 5 or higher. They will appear when you zoom in.`,
            'warning',
            4000
          );
          return; // Don't toggle the state
        }

        wrecksEnabled = !wrecksEnabled;
        localStorage.setItem('harborMapWrecksEnabled', wrecksEnabled);

        if (wrecksEnabled) {
          // Zoom is OK, load wrecks immediately
          await loadWrecksForCurrentView();
        } else {
          // Disabled - remove markers and reset bbox tracking
          if (wrecksMarkerLayer &amp;&amp; map.hasLayer(wrecksMarkerLayer)) {
            map.removeLayer(wrecksMarkerLayer);
            wrecksMarkerLayer = null;
          }
          lastWrecksBounds = null; // Reset bounds tracking when disabled
        }

        updateButton();

        // Reset tooltip
        container.removeAttribute('title');
        setTimeout(() => {
          container.title = 'Shipwrecks';
        }, 100);
      });

      if (wrecksEnabled) {
        container.click();
      }

      return container;
    }
  });

  // Add controls to map (order matters - top to bottom for topleft, top to bottom for topright)

  // Top left controls (icon buttons - after +/- zoom which Leaflet adds automatically)
  map.addControl(new FullscreenControl());
  map.addControl(new MapStyleControl());

  // Only add Weather Control if enableWeatherData is enabled
  const settings = window.getSettings ? window.getSettings() : {};
  if (settings.enableWeatherData === true) {
    weatherControl = new WeatherControl();
    map.addControl(weatherControl);
  }

  // Add Environmental Layer Control (rotating button: off -> wind -> clouds -> temperature)
  envLayerControl = new EnvironmentalLayerControl();
  map.addControl(envLayerControl);

  // Add Museums and Wrecks Layer Controls (two separate toggle buttons)
  map.addControl(new MuseumsLayerControl());
  map.addControl(new WrecksLayerControl());

  // Add Refresh Control
  map.addControl(new RefreshControl());

  // Forecast Calendar Control - same structure as Refresh
  const ForecastControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom leaflet-control-forecast');
      container.innerHTML = '&lt;button title="Forecast Calendar">&lt;/button>';
      const btn = container.querySelector('button');
      L.DomEvent.disableClickPropagation(container);
      L.DomEvent.on(btn, 'click', function(e) {
        L.DomEvent.stopPropagation(e);
        if (window.closeAllModalOverlays) window.closeAllModalOverlays();
        if (window.showForecastOverlay) {
          window.showForecastOverlay();
        } else {
          // Fallback: directly open forecast overlay and init calendar
          const overlay = document.getElementById('forecastOverlay');
          if (overlay) {
            overlay.classList.remove('hidden');
            // Apply cached event data if available
            const cachedData = window.lastUpdateData;
            if (cachedData &amp;&amp; cachedData.prices) {
              const eventDiscount = cachedData.prices.eventDiscount;
              const eventData = cachedData.prices.eventData;
              if (eventDiscount &amp;&amp; eventData) {
                updateEventDiscount(eventDiscount, eventData);
              }
            }
            initForecastCalendar();
          }
        }
      });
      return container;
    }
  });

  map.addControl(new ForecastControl());

  // Logbook Control - same structure as Refresh
  const LogbookControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom leaflet-control-logbook');
      container.innerHTML = '&lt;button title="Captain\'s Logbook">&lt;/button>';
      const btn = container.querySelector('button');
      L.DomEvent.disableClickPropagation(container);
      L.DomEvent.on(btn, 'click', function(e) {
        L.DomEvent.stopPropagation(e);
        if (window.closeAllModalOverlays) window.closeAllModalOverlays();
        if (window.showLogbookOverlay) {
          window.showLogbookOverlay();
        } else if (window.openLogbook) {
          // Fallback: use window.openLogbook set by initLogbook()
          window.openLogbook();
        } else {
          // Last resort: just show overlay
          const overlay = document.getElementById('logbookOverlay');
          if (overlay) overlay.classList.remove('hidden');
        }
      });
      return container;
    }
  });

  // Settings Control - same structure as Refresh
  const SettingsControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom leaflet-control-settings-btn');
      container.style.position = 'relative';
      container.innerHTML = '&lt;button title="Settings">&lt;/button>';
      container.innerHTML += '&lt;span class="update-indicator hidden" id="settingsUpdateIndicator">&lt;/span>';
      L.DomEvent.disableClickPropagation(container);
      container.querySelector('button').addEventListener('click', () => {
        if (window.closeAllModalOverlays) window.closeAllModalOverlays();
        if (window.showSettings) window.showSettings();
      });
      return container;
    }
  });

  // Docs Control - same structure as Refresh
  const DocsControl = L.Control.extend({
    options: { position: 'topleft' },
    onAdd: function() {
      const container = L.DomUtil.create('div', 'leaflet-control-custom leaflet-control-docs');
      container.innerHTML = '&lt;button title="Documentation">&lt;/button>';
      L.DomEvent.disableClickPropagation(container);
      container.querySelector('button').addEventListener('click', () => {
        if (window.closeAllModalOverlays) window.closeAllModalOverlays();
        if (window.showDocsOverlay) window.showDocsOverlay();
      });
      return container;
    }
  });

  map.addControl(new LogbookControl());
  map.addControl(new SettingsControl());
  map.addControl(new DocsControl());

  // Filter Button Control - Opens filter modal (replaces 3 dropdown controls)
  map.addControl(new FilterButtonControl());

  // Add Zoom Display Control (bottom left) - add AFTER filters
  map.addControl(new ZoomDisplayControl());

  // Auto-reload wrecks when zooming or moving map (with debouncing)
  map.on('zoomend', () => {
    const currentZoom = map.getZoom();

    // Clear any pending load timeout
    if (wrecksLoadTimeout) {
      clearTimeout(wrecksLoadTimeout);
      wrecksLoadTimeout = null;
    }

    if (wrecksEnabled) {
      if (currentZoom &lt; 5) {
        // Hide wrecks if zoom too low
        if (wrecksMarkerLayer &amp;&amp; map.hasLayer(wrecksMarkerLayer)) {
          map.removeLayer(wrecksMarkerLayer);
          wrecksMarkerLayer = null;
          lastWrecksBounds = null; // Reset bounds tracking
          console.log(`[Wrecks] Auto-hidden at zoom level ${currentZoom}`);
        }
      } else {
        // Zoom is OK, reload wrecks after 500ms delay (debounce)
        wrecksLoadTimeout = setTimeout(() => {
          loadWrecksForCurrentView();
        }, 500);
      }
    }
  });

  // Reload wrecks when map is moved (panned/dragged) with debouncing
  map.on('moveend', () => {
    // Clear any pending load timeout
    if (wrecksLoadTimeout) {
      clearTimeout(wrecksLoadTimeout);
      wrecksLoadTimeout = null;
    }

    if (wrecksEnabled &amp;&amp; map.getZoom() >= 5) {
      // Wait 500ms after movement stops before loading (debounce)
      wrecksLoadTimeout = setTimeout(() => {
        loadWrecksForCurrentView();
      }, 500);
    }
  });

  // Set saved values in dropdowns
  const vesselFilterSelect = document.getElementById('vesselFilterSelect');
  const portFilterSelect = document.getElementById('portFilterSelect');

  if (vesselFilterSelect) {
    vesselFilterSelect.value = currentVesselFilter;
  }

  if (portFilterSelect) {
    portFilterSelect.value = currentPortFilter;
  }

  console.log(`[Harbor Map] Restored saved settings - Style: ${currentMapStyle}, Vessel Filter: ${currentVesselFilter}, Port Filter: ${currentPortFilter}, Route Filter: ${currentRouteFilter || 'All Routes'}`);

  // Initialize Environmental Layer if enabled (restore from localStorage)
  if (currentEnvLayer &amp;&amp; currentEnvLayer !== 'off') {
    console.log(`[Environmental] Restoring ${currentEnvLayer} layer from saved state...`);
    switch(currentEnvLayer) {
      case 'wind':
        // Higher opacity in standard mode for better visibility
        const windOpacity = currentMapStyle === 'standard' ? 0.6 : 0.4;
        envLayer = L.OWM.wind({
          opacity: windOpacity,
          showLegend: false
        });
        if (envLayer) {
          envLayer.addTo(map);
        }
        break;
      case 'clouds':
        // Add cloud layer (static) with higher opacity in standard mode
        const cloudsOpacity = currentMapStyle === 'standard' ? 0.7 : 0.5;
        envLayer = L.OWM.clouds({showLegend: false, opacity: cloudsOpacity});
        envLayer.addTo(map);
        break;
      case 'temperature':
        // Higher opacity in standard mode for better visibility
        const tempOpacity = currentMapStyle === 'standard' ? 0.6 : 0.4;
        envLayer = L.OWM.temperature({showLegend: false, opacity: tempOpacity});
        if (envLayer) {
          envLayer.addTo(map);
        }
        break;
    }
  }

  // Apply theme class for control styling
  applyMapTheme(currentMapStyle);
}

/**
 * Applies theme class to map container for control styling
 *
 * @param {string} style - Map style key ('standard', 'dark', 'satellite')
 * @returns {void}
 */
function applyMapTheme(style) {
  const mapCanvas = document.getElementById('harborMapCanvas');
  if (!mapCanvas) return;

  // Remove all theme classes
  mapCanvas.classList.remove('theme-light', 'theme-dark', 'theme-satellite');

  // Add appropriate theme class
  if (style === 'standard') {
    mapCanvas.classList.add('theme-light');
  } else if (style === 'satellite') {
    mapCanvas.classList.add('theme-satellite');
  } else {
    // dark uses dark controls
    mapCanvas.classList.add('theme-dark');
  }

  console.log(`[Harbor Map] Applied theme class for style: ${style}`);
}

/**
 * Changes the map tile layer (theme)
 *
 * @param {string} layerKey - Key from tileLayers object
 * @returns {void}
 */
function changeTileLayer(layerKey) {
  if (!tileLayers[layerKey]) return;

  // Remove current layer
  if (currentTileLayer) {
    map.removeLayer(currentTileLayer);
  }

  // Add new layer
  currentTileLayer = L.tileLayer(tileLayers[layerKey].url, {
    maxZoom: 19
  }).addTo(map);

  // Save to localStorage
  currentMapStyle = layerKey;
  localStorage.setItem('harborMapStyle', layerKey);

  // Apply theme class for control styling
  applyMapTheme(layerKey);

  // Update map container background color
  const mapContainer = map.getContainer();
  const backgroundColor = layerKey === 'standard' ? '#e0e0e0' : '#1f1f1f';
  mapContainer.style.backgroundColor = backgroundColor;

  // Re-add environmental layer if active (to keep it on top of the new tile layer)
  if (envLayer &amp;&amp; currentEnvLayer !== 'off') {
    envLayer.bringToFront();
  }

  console.log(`[Harbor Map] Changed map style to: ${tileLayers[layerKey].name} (saved)`);
}

/**
 * Renders vessels as markers on the map
 * Uses color-coded icons based on vessel status
 *
 * @param {Array&lt;Object>} vessels - Vessels with position data from backend
 * @returns {void}
 * @example
 * renderVessels([{ id: 1234, position: { lat: -27.38, lon: 153.12 }, status: 'enroute', ... }]);
 */
export function renderVessels(vessels) {
  // Don't clear portLocationClusterGroup here - it will be cleared before both
  // renderVessels() and renderPorts() are called, and ports need to be added after vessels
  vesselClusterGroup.clearLayers();

  console.log(`[Harbor Map] Rendering ${vessels.length} vessels`);

  let skipped = 0;
  vessels.forEach(vessel => {
    if (!vessel.position) {
      skipped++;
      return;
    }

    // Get vessel type from capacity_type field
    const vesselType = getVesselType(vessel.capacity_type);

    // Calculate heading if vessel has route
    let heading = 0;
    if (vessel.routes &amp;&amp; vessel.routes.length > 0 &amp;&amp; vessel.routes[0].path &amp;&amp; vessel.routes[0].path.length >= 2) {
      const isReversed = vessel.routes[0].reversed === true;
      const path = isReversed
        ? vessel.routes[0].path.slice().reverse()
        : vessel.routes[0].path;

      // Find current position in path - use closest point approach
      let bestIndex = -1;
      let bestDist = Infinity;
      for (let i = 0; i &lt; path.length - 1; i++) {
        const point = path[i];
        const dist = Math.abs(point.lat - vessel.position.lat) + Math.abs(point.lon - vessel.position.lon);
        if (dist &lt; bestDist) {
          bestDist = dist;
          bestIndex = i;
        }
      }

      if (bestIndex >= 0 &amp;&amp; bestIndex &lt; path.length - 1) {
        // Find next significantly different point (skip duplicates)
        let nextIndex = bestIndex + 1;
        while (nextIndex &lt; path.length - 1) {
          const nextPoint = path[nextIndex];
          const dist = Math.abs(nextPoint.lat - path[bestIndex].lat) + Math.abs(nextPoint.lon - path[bestIndex].lon);
          if (dist > 0.001) break;
          nextIndex++;
        }
        heading = calculateHeading(path[bestIndex], path[nextIndex]);
      }
    }

    // Create icon with type, status, and heading
    const icon = createVesselIcon(vessel.status, vesselType, heading);

    // Use exact coordinates (no offset for vessels in port)
    // Vessels in port will have same coordinates as port and will be clustered together
    const vesselLat = vessel.position.lat;
    const vesselLon = vessel.position.lon;

    // Create marker
    const marker = L.marker([vesselLat, vesselLon], { icon });

    // Prepare tooltip content with detailed cargo info
    let cargoDisplay = 'N/A';
    if (vessel.capacity &amp;&amp; vessel.capacity_max) {
      if (vessel.capacity_type === 'container') {
        const dry = vessel.capacity.dry;
        const ref = vessel.capacity.refrigerated;
        const dryMax = vessel.capacity_max.dry;
        const refMax = vessel.capacity_max.refrigerated;
        cargoDisplay = `Dry: ${dry}/${dryMax} TEU, Ref: ${ref}/${refMax} TEU`;
      } else if (vessel.capacity_type === 'tanker') {
        const fuel = vessel.capacity.fuel;
        const crude = vessel.capacity.crude_oil;
        const fuelMax = vessel.capacity_max.fuel;
        const crudeMax = vessel.capacity_max.crude_oil;
        cargoDisplay = `Fuel: ${fuel}/${fuelMax} bbl, Crude: ${crude}/${crudeMax} bbl`;
      }
    }

    const vesselTooltipContent = `
      &lt;strong>${escapeHtml(vessel.name)}&lt;/strong>&lt;br>
      Status: ${vessel.status}${vessel.status === 'enroute' &amp;&amp; vessel.route_speed ? ` | Speed: ${vessel.route_speed} kn` : ''}${vessel.eta !== 'N/A' ? ` | ETA: ${vessel.eta}` : ''}&lt;br>
      Cargo: ${cargoDisplay}
    `;

    // Always bind tooltip for mouseover (NOT for click)
    marker.bindTooltip(vesselTooltipContent, {
      direction: 'auto',
      offset: [0, -10]
    });

    // Click handler - show vessel detail panel
    marker.on('click', () => {
      marker.closeTooltip();
      selectVessel(vessel.id);
    });

    // Add to appropriate cluster group
    // Vessels in port/anchor -> portLocationClusterGroup (clustered with port)
    // Vessels enroute -> vesselClusterGroup (separate)
    if (vessel.status === 'port' || vessel.status === 'anchor') {
      portLocationClusterGroup.addLayer(marker);
    } else {
      vesselClusterGroup.addLayer(marker);
    }
  });

  console.log(`[Harbor Map] Rendered ${vessels.length - skipped} vessels, skipped ${skipped} without position`);
}

/**
 * Renders ports as markers on the map
 * Uses color-coded markers for demand levels
 *
 * @param {Array&lt;Object>} ports - Ports with demand data from backend
 * @returns {void}
 * @example
 * renderPorts([{ code: 'AUBNE', lat: -27.38, lon: 153.12, demandLevel: 'high', ... }]);
 */
export function renderPorts(ports) {
  // Don't clear portLocationClusterGroup here - vessels in port have already been added
  // by renderVessels(), and we want to add ports to the same cluster group
  // portLocationClusterGroup.clearLayers();  // DON'T DO THIS!

  console.log(`[Harbor Map] Rendering ${ports.length} ports`);
  if (ports.length > 0) {
    logger.debug('[Harbor Map] First port sample:', {
      code: ports[0].code,
      hasDemand: !!ports[0].demand,
      demand: ports[0].demand
    });
  }

  // Helper to check if demand has actual data (not empty array or object)
  const hasValidDemand = (d) => {
    if (!d) return false;
    if (Array.isArray(d)) return d.length > 0;
    if (typeof d === 'object') return d.container || d.tanker;
    return false;
  };

  ports.forEach(port => {
    if (!port.lat || !port.lon) return;

    // Check port demand cache first, then port.demand, then fallback
    const cachedData = portDemandCache.get(port.code);
    const demand = cachedData?.demand || port.demand;
    const consumed = cachedData?.consumed || port.consumed || {};
    const hasDemand = hasValidDemand(demand);

    // Format REMAINING demand for tooltip (demand - consumed)
    // More readable format with line breaks
    let demandText = 'Loading...';
    if (hasDemand) {
      const lines = [];

      if (demand.container) {
        const dryDemand = demand.container.dry || 0;
        const dryConsumed = consumed.container?.dry || 0;
        const dryRemaining = Math.max(0, dryDemand - dryConsumed);

        const refDemand = demand.container.refrigerated || 0;
        const refConsumed = consumed.container?.refrigerated || 0;
        const refRemaining = Math.max(0, refDemand - refConsumed);

        lines.push('&lt;b>Container:&lt;/b>');
        lines.push(`Dry: ${dryRemaining.toLocaleString()} / ${dryDemand.toLocaleString()} TEU`);
        lines.push(`Ref: ${refRemaining.toLocaleString()} / ${refDemand.toLocaleString()} TEU`);
      }

      if (demand.tanker) {
        const fuelDemand = demand.tanker.fuel || 0;
        const fuelConsumed = consumed.tanker?.fuel || 0;
        const fuelRemaining = Math.max(0, fuelDemand - fuelConsumed);

        const crudeDemand = demand.tanker.crude_oil || 0;
        const crudeConsumed = consumed.tanker?.crude_oil || 0;
        const crudeRemaining = Math.max(0, crudeDemand - crudeConsumed);

        lines.push('&lt;b>Tanker:&lt;/b>');
        lines.push(`Fuel: ${fuelRemaining.toLocaleString()} / ${fuelDemand.toLocaleString()} bbl`);
        lines.push(`Crude: ${crudeRemaining.toLocaleString()} / ${crudeDemand.toLocaleString()} bbl`);
      }

      if (lines.length > 0) {
        demandText = lines.join('&lt;br>');
      }
    }

    // Format port name
    const portName = toGameCode(port.code, port.country);

    // Prepare tooltip content
    const portTooltipContent = `
      &lt;strong>${portName}&lt;/strong>&lt;br>
      &lt;small>Remaining / Total&lt;/small>&lt;br>
      ${demandText}
    `;

    // Create marker
    const marker = L.marker([parseFloat(port.lat), parseFloat(port.lon)], {
      icon: portIcons.default
    });

    // Always bind tooltip for mouseover (NOT for click)
    marker.bindTooltip(portTooltipContent, {
      direction: 'auto',
      offset: [0, -10]
    });

    // Lazy load demand on first hover (skip if already cached or has valid demand)
    let demandLoaded = hasDemand;
    marker.on('mouseover', async () => {
      if (demandLoaded) {
        return;
      }
      demandLoaded = true; // Prevent multiple fetches

      try {
        const response = await fetch('/api/route/get-port-demand', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ port_code: port.code })
        });

        if (!response.ok) {
          console.warn(`[Harbor Map] Demand fetch failed for ${port.code}: ${response.status}`);
          return;
        }

        const data = await response.json();
        if (!data.port?.demand) {
          console.warn(`[Harbor Map] No demand in response for ${port.code}`);
          return;
        }

        // Cache port demand persistently
        portDemandCache.set(port.code, {
          demand: data.port.demand,
          consumed: data.port.consumed
        });

        // Also update rawPorts for current session
        const rawPort = rawPorts.find(p => p.code === port.code);
        if (rawPort) {
          rawPort.demand = data.port.demand;
          rawPort.consumed = data.port.consumed;
        }

        // Update tooltip with REMAINING demand (demand - consumed)
        // More readable format with line breaks
        const fetchedDemand = data.port.demand;
        const fetchedConsumed = data.port.consumed || {};
        const lines = [];

        if (fetchedDemand.container) {
          const dryDemand = fetchedDemand.container.dry || 0;
          const dryConsumed = fetchedConsumed.container?.dry || 0;
          const dryRemaining = Math.max(0, dryDemand - dryConsumed);

          const refDemand = fetchedDemand.container.refrigerated || 0;
          const refConsumed = fetchedConsumed.container?.refrigerated || 0;
          const refRemaining = Math.max(0, refDemand - refConsumed);

          lines.push('&lt;b>Container:&lt;/b>');
          lines.push(`Dry: ${dryRemaining.toLocaleString()} / ${dryDemand.toLocaleString()} TEU`);
          lines.push(`Ref: ${refRemaining.toLocaleString()} / ${refDemand.toLocaleString()} TEU`);
        }
        if (fetchedDemand.tanker) {
          const fuelDemand = fetchedDemand.tanker.fuel || 0;
          const fuelConsumed = fetchedConsumed.tanker?.fuel || 0;
          const fuelRemaining = Math.max(0, fuelDemand - fuelConsumed);

          const crudeDemand = fetchedDemand.tanker.crude_oil || 0;
          const crudeConsumed = fetchedConsumed.tanker?.crude_oil || 0;
          const crudeRemaining = Math.max(0, crudeDemand - crudeConsumed);

          lines.push('&lt;b>Tanker:&lt;/b>');
          lines.push(`Fuel: ${fuelRemaining.toLocaleString()} / ${fuelDemand.toLocaleString()} bbl`);
          lines.push(`Crude: ${crudeRemaining.toLocaleString()} / ${crudeDemand.toLocaleString()} bbl`);
        }

        const demandText = lines.length > 0 ? lines.join('&lt;br>') : 'No demand';
        const newTooltip = `&lt;strong>${portName}&lt;/strong>&lt;br>&lt;small>Remaining / Total&lt;/small>&lt;br>${demandText}`;
        marker.setTooltipContent(newTooltip);
      } catch (err) {
        console.warn(`[Harbor Map] Failed to fetch demand for ${port.code}:`, err.message);
      }
    });

    // Click handler - show port detail panel
    marker.on('click', () => {
      marker.closeTooltip();
      selectPort(port.code);
    });

    portLocationClusterGroup.addLayer(marker);
  });
}

/**
 * Draws route path on map with blue polyline
 * Highlights origin (red) and destination (green) ports
 *
 * @param {Object} route - Route data from backend
 * @param {Array&lt;Object>} ports - Array of port objects with demand data
 * @param {boolean} autoZoom - Whether to auto-zoom to route bounds (default: true)
 * @returns {void}
 * @example
 * drawRoute({ path: [{lat: -27.38, lon: 153.12}, ...], origin: 'AUBNE', destination: 'NZAKL' }, ports);
 */
export function drawRoute(route, ports = [], autoZoom = true) {
  routeLayer.clearLayers();

  if (!route) {
    logger.debug('[Harbor Map] No route to draw');
    return;
  }

  // Support both field names for backwards compatibility
  const originPort = route.origin || route.origin_port_code;
  const destinationPort = route.destination || route.destination_port_code;

  if (!originPort || !destinationPort) {
    logger.debug('[Harbor Map] No origin or destination for route');
    return;
  }

  logger.debug('[Harbor Map] Drawing route:', {
    origin: originPort,
    destination: destinationPort,
    pathLength: route.path ? route.path.length : 0
  });

  // Build path - use provided path or create straight line from port coordinates
  let latLngs = [];

  if (route.path &amp;&amp; route.path.length > 0) {
    // Use the detailed path from API
    latLngs = route.path.map(p => [p.lat, p.lon]);
  } else {
    // No detailed path - create straight line between origin and destination ports
    const originPortData = ports.find(p => p.code === originPort);
    const destPortData = ports.find(p => p.code === destinationPort);

    if (originPortData &amp;&amp; destPortData) {
      logger.debug('[Harbor Map] Creating straight line route between ports:', originPort, '', destinationPort);
      latLngs = [
        [parseFloat(originPortData.lat), parseFloat(originPortData.lon)],
        [parseFloat(destPortData.lat), parseFloat(destPortData.lon)]
      ];
    } else {
      console.warn('[Harbor Map] Cannot draw route - port coordinates not found');
      return;
    }
  }

  // Draw route path as blue polyline
  const polyline = L.polyline(latLngs, {
    color: '#3388ff',
    weight: 3,
    opacity: 0.7,
    className: 'route-polyline-clickable'
  });

  // Add click handler to open route vessels panel
  polyline.on('click', async () => {
    logger.debug('[Harbor Map] Route line clicked:', originPort, '', destinationPort);

    // Close any open panels first to prevent overlap
    await closeAllPanels();

    // Filter vessels that are on this route (or reverse)
    const vesselsOnRoute = currentVessels.filter(v => {
      if (!v.active_route) return false;

      const vesselOrigin = v.active_route.origin_port_code || v.active_route.origin;
      const vesselDestination = v.active_route.destination_port_code || v.active_route.destination;

      // Check both directions (forward and reverse)
      return (vesselOrigin === originPort &amp;&amp; vesselDestination === destinationPort) ||
             (vesselOrigin === destinationPort &amp;&amp; vesselDestination === originPort);
    });

    // Create route name for panel title
    const originName = originPort ? toGameCode(originPort) : 'Unknown';
    const destName = destinationPort ? toGameCode(destinationPort) : 'Unknown';
    const routeName = `${originName} - ${destName}`;

    console.log(`[Harbor Map] Opening route panel: ${routeName}, ${vesselsOnRoute.length} vessels`);
    showRouteVesselsPanel(routeName, vesselsOnRoute);
  });

  routeLayer.addLayer(polyline);

  // Highlight origin port (red)
  if (originPort) {
    const originName = toGameCode(originPort);
    const originMarker = L.marker(latLngs[0], { icon: portIcons.origin });

    // Find port data for demand info
    const originPortData = ports.find(p => p.code === originPort);
    let demandText = 'N/A';

    if (originPortData &amp;&amp; originPortData.demand) {
      const consumed = originPortData.consumed || {};
      const lines = [];
      if (originPortData.demand.container) {
        const dryDemand = originPortData.demand.container.dry || 0;
        const dryConsumed = consumed.container?.dry || 0;
        const dryRemaining = Math.max(0, dryDemand - dryConsumed);

        const refDemand = originPortData.demand.container.refrigerated || 0;
        const refConsumed = consumed.container?.refrigerated || 0;
        const refRemaining = Math.max(0, refDemand - refConsumed);

        lines.push('&lt;b>Container:&lt;/b>');
        lines.push(`Dry: ${dryRemaining.toLocaleString()} / ${dryDemand.toLocaleString()} TEU`);
        lines.push(`Ref: ${refRemaining.toLocaleString()} / ${refDemand.toLocaleString()} TEU`);
      }
      if (originPortData.demand.tanker) {
        const fuelDemand = originPortData.demand.tanker.fuel || 0;
        const fuelConsumed = consumed.tanker?.fuel || 0;
        const fuelRemaining = Math.max(0, fuelDemand - fuelConsumed);

        const crudeDemand = originPortData.demand.tanker.crude_oil || 0;
        const crudeConsumed = consumed.tanker?.crude_oil || 0;
        const crudeRemaining = Math.max(0, crudeDemand - crudeConsumed);

        lines.push('&lt;b>Tanker:&lt;/b>');
        lines.push(`Fuel: ${fuelRemaining.toLocaleString()} / ${fuelDemand.toLocaleString()} bbl`);
        lines.push(`Crude: ${crudeRemaining.toLocaleString()} / ${crudeDemand.toLocaleString()} bbl`);
      }
      if (lines.length > 0) {
        demandText = lines.join('&lt;br>');
      }
    }

    // Bind tooltip - same format as normal ports (mouseover only)
    originMarker.bindTooltip(`
      &lt;strong>${originName}&lt;/strong>&lt;br>
      &lt;small>Remaining / Total&lt;/small>&lt;br>
      ${demandText}
    `, {
      direction: 'auto',
      offset: [0, -10],
      className: 'route-port-tooltip'
    });

    // Click handler - open port panel
    originMarker.on('click', () => selectPort(originPort));

    routeLayer.addLayer(originMarker);
    logger.debug('[Harbor Map] Added origin port marker:', originName, latLngs[0]);
  } else {
    console.warn('[Harbor Map] No origin port in route data');
  }

  // Highlight destination port (green)
  if (destinationPort) {
    const destName = toGameCode(destinationPort);
    const destMarker = L.marker(latLngs[latLngs.length - 1], { icon: portIcons.destination });

    // Find port data for demand info
    const destPortData = ports.find(p => p.code === destinationPort);
    let demandText = 'N/A';

    if (destPortData &amp;&amp; destPortData.demand) {
      const consumed = destPortData.consumed || {};
      const lines = [];
      if (destPortData.demand.container) {
        const dryDemand = destPortData.demand.container.dry || 0;
        const dryConsumed = consumed.container?.dry || 0;
        const dryRemaining = Math.max(0, dryDemand - dryConsumed);

        const refDemand = destPortData.demand.container.refrigerated || 0;
        const refConsumed = consumed.container?.refrigerated || 0;
        const refRemaining = Math.max(0, refDemand - refConsumed);

        lines.push('&lt;b>Container:&lt;/b>');
        lines.push(`Dry: ${dryRemaining.toLocaleString()} / ${dryDemand.toLocaleString()} TEU`);
        lines.push(`Ref: ${refRemaining.toLocaleString()} / ${refDemand.toLocaleString()} TEU`);
      }
      if (destPortData.demand.tanker) {
        const fuelDemand = destPortData.demand.tanker.fuel || 0;
        const fuelConsumed = consumed.tanker?.fuel || 0;
        const fuelRemaining = Math.max(0, fuelDemand - fuelConsumed);

        const crudeDemand = destPortData.demand.tanker.crude_oil || 0;
        const crudeConsumed = consumed.tanker?.crude_oil || 0;
        const crudeRemaining = Math.max(0, crudeDemand - crudeConsumed);

        lines.push('&lt;b>Tanker:&lt;/b>');
        lines.push(`Fuel: ${fuelRemaining.toLocaleString()} / ${fuelDemand.toLocaleString()} bbl`);
        lines.push(`Crude: ${crudeRemaining.toLocaleString()} / ${crudeDemand.toLocaleString()} bbl`);
      }
      if (lines.length > 0) {
        demandText = lines.join('&lt;br>');
      }
    }

    // Bind tooltip - same format as normal ports (mouseover only)
    destMarker.bindTooltip(`
      &lt;strong>${destName}&lt;/strong>&lt;br>
      &lt;small>Remaining / Total&lt;/small>&lt;br>
      ${demandText}
    `, {
      direction: 'auto',
      offset: [0, -10],
      className: 'route-port-tooltip'
    });

    // Click handler - open port panel
    destMarker.on('click', () => selectPort(destinationPort));

    routeLayer.addLayer(destMarker);
    logger.debug('[Harbor Map] Added destination port marker:', destName, latLngs[latLngs.length - 1]);
  } else {
    console.warn('[Harbor Map] No destination port in route data');
  }

  // Fit map to route bounds (only if autoZoom is true)
  if (autoZoom) {
    const polylineBounds = polyline.getBounds();

    // Only zoom if bounds are valid
    if (polylineBounds &amp;&amp; polylineBounds.isValid()) {
      const isMobile = isMobileDevice();

      if (isMobile) {
        // Mobile: More padding and maxZoom to see full route
        map.fitBounds(polylineBounds, {
          paddingTopLeft: [20, 80],
          paddingBottomRight: [20, 450],
          maxZoom: 2 // Allow very wide zoom out for intercontinental routes
        });
      } else {
        // Desktop: Right panel padding (175px panel + 50px extra + more space)
        map.fitBounds(polylineBounds, {
          paddingTopLeft: [50, 50],
          paddingBottomRight: [300, 50]
        });
      }
    } else {
      console.warn('[Harbor Map] Polyline bounds are not valid, skipping auto-zoom');
    }
  }
}

/**
 * Clears route layer (removes blue line and port highlights)
 *
 * @returns {void}
 * @example
 * clearRoute();
 */
export function clearRoute() {
  routeLayer.clearLayers();
}

/**
 * Sets port filter to specific value (client-side only - no API calls)
 *
 * @param {string} filter - Port filter type
 * @returns {Promise&lt;void>}
 * @example
 * await setPortFilter('my_ports');
 */
export async function setPortFilter(filter) {
  currentPortFilter = filter;
  localStorage.setItem('harborMapPortFilter', filter);
  console.log(`[Harbor Map] Port filter changed to: ${filter} (client-side)`);

  // Close all panels and reset selection when manually changing filter
  await closeAllPanels();
  selectedVesselId = null;
  selectedPortCode = null;

  // Remove fullscreen when manually changing filters
  if (isMobileDevice()) {
    document.body.classList.remove('map-fullscreen');
  }

  // Apply filter client-side (no API call)
  await applyFiltersAndRender();
}

/**
 * Sets vessel filter to specific value (client-side only - no API calls)
 *
 * @param {string} filter - Vessel filter type
 * @returns {Promise&lt;void>}
 * @example
 * await setVesselFilter('tanker_only');
 */
export async function setVesselFilter(filter) {
  currentVesselFilter = filter;
  localStorage.setItem('harborMapVesselFilter', filter);
  console.log(`[Harbor Map] Vessel filter changed to: ${filter} (client-side)`);

  // Close all panels and reset selection when manually changing filter
  await closeAllPanels();
  selectedVesselId = null;
  selectedPortCode = null;

  // Remove fullscreen when manually changing filters
  if (isMobileDevice()) {
    document.body.classList.remove('map-fullscreen');
  }

  // Apply filter client-side (no API call)
  await applyFiltersAndRender();
}

/**
 * Opens the filter modal panel.
 * Populates dropdowns with current filter values and initializes drag behavior.
 */
function openFilterModal() {
  const modal = document.getElementById('harborFilterModal');
  if (!modal) return;

  // Populate dropdowns
  populateFilterModalDropdowns();

  // Show modal
  modal.classList.remove('hidden');

  // Initialize drag behavior if not already done
  initFilterModalDrag();

  // Update filter button state
  const filterBtn = document.querySelector('.map-filter-btn');
  if (filterBtn) {
    filterBtn.classList.add('active');
  }

  logger.debug('[Harbor Map] Filter modal opened');
}

/**
 * Closes the filter modal panel.
 */
function closeFilterModal() {
  const modal = document.getElementById('harborFilterModal');
  if (!modal) return;

  modal.classList.add('hidden');

  // Update filter button state
  const filterBtn = document.querySelector('.map-filter-btn');
  if (filterBtn) {
    filterBtn.classList.remove('active');
  }

  logger.debug('[Harbor Map] Filter modal closed');
}

/**
 * Populates the filter modal dropdowns with current values and options.
 * Called when modal opens to ensure data is fresh.
 */
function populateFilterModalDropdowns() {
  // Route filter
  const routeSelect = document.getElementById('harborFilterRoute');
  if (routeSelect &amp;&amp; currentPortPairGroups &amp;&amp; currentPortPairGroups.groups) {
    routeSelect.innerHTML = '&lt;option value="">All Routes&lt;/option>' +
      currentPortPairGroups.groups.map(g =>
        `&lt;option value="${g.pairKey}" ${g.pairKey === currentRouteFilter ? 'selected' : ''}>${g.displayName} (${g.vessels.length})&lt;/option>`
      ).join('');
  }

  // Vessel filter
  const vesselSelect = document.getElementById('harborFilterVessel');
  if (vesselSelect) {
    const options = getVesselFilterOptions();
    vesselSelect.innerHTML = options.map(opt =>
      `&lt;option value="${opt.value}" ${opt.value === currentVesselFilter ? 'selected' : ''}>${opt.label}&lt;/option>`
    ).join('');
  }

  // Port scope selector
  const portScopeSelect = document.getElementById('harborFilterPortScope');
  if (portScopeSelect) {
    portScopeSelect.value = currentPortScope;
  }

  // Demand filters (dynamic based on current port scope)
  updateDemandFilterDropdowns();
}

/**
 * Updates demand filter dropdowns based on current port scope.
 * Populates the Max and Current demand dropdowns with options for the selected scope.
 */
function updateDemandFilterDropdowns() {
  const demandType = currentPortScope.startsWith('my_ports') ? 'my' : 'all';

  // Update Max Demand dropdown
  const maxSelect = document.getElementById('harborFilterDemandMax');
  if (maxSelect) {
    const maxOptions = getDemandFilterOptions(`max_${demandType}`);
    maxSelect.innerHTML = maxOptions.map(opt =>
      `&lt;option value="${opt.value}" ${opt.value === currentDemandMaxFilter ? 'selected' : ''}>${opt.label}&lt;/option>`
    ).join('');
  }

  // Update Current Demand dropdown
  const currentSelect = document.getElementById('harborFilterDemandCurrent');
  if (currentSelect) {
    const currentOptions = getDemandFilterOptions(`current_${demandType}`);
    currentSelect.innerHTML = currentOptions.map(opt =>
      `&lt;option value="${opt.value}" ${opt.value === currentDemandCurrentFilter ? 'selected' : ''}>${opt.label}&lt;/option>`
    ).join('');
  }
}

/**
 * Initializes drag behavior for the filter modal.
 */
function initFilterModalDrag() {
  const modal = document.getElementById('harborFilterModal');
  const header = modal?.querySelector('.harbor-filter-header');
  if (!modal || !header) return;

  // Already initialized
  if (header.dataset.dragInit === 'true') return;
  header.dataset.dragInit = 'true';

  header.addEventListener('mousedown', (e) => {
    if (e.target.closest('.close-btn')) return;

    filterModalDragging = true;
    modal.classList.add('dragging');

    const rect = modal.getBoundingClientRect();
    filterModalDragOffset = {
      x: e.clientX - rect.left,
      y: e.clientY - rect.top
    };

    document.addEventListener('mousemove', onFilterModalDrag);
    document.addEventListener('mouseup', onFilterModalDragEnd);
  });

  // Close button
  const closeBtn = modal.querySelector('.harbor-filter-close');
  if (closeBtn) {
    closeBtn.addEventListener('click', closeFilterModal);
  }

  // Clear button
  const clearBtn = modal.querySelector('.harbor-filter-clear-btn');
  if (clearBtn) {
    clearBtn.addEventListener('click', async () => {
      await resetAllFilters();
      populateFilterModalDropdowns();
    });
  }

  // Immediate filter application on dropdown change with mutual exclusivity
  // When one filter type is selected, all others are reset
  const routeSelect = document.getElementById('harborFilterRoute');
  const vesselSelect = document.getElementById('harborFilterVessel');
  const portScopeSelect = document.getElementById('harborFilterPortScope');
  const demandMaxSelect = document.getElementById('harborFilterDemandMax');
  const demandCurrentSelect = document.getElementById('harborFilterDemandCurrent');

  // Port scope selector - updates demand dropdowns and applies filter
  if (portScopeSelect) {
    portScopeSelect.addEventListener('change', async () => {
      currentPortScope = portScopeSelect.value;

      // Clear demand filters when switching scope
      currentDemandMaxFilter = '';
      currentDemandCurrentFilter = '';

      // Update demand dropdowns with new scope
      updateDemandFilterDropdowns();

      await applyFilterModalSelections();
    });
  }

  // Route filter - resets vessel and demand filters
  if (routeSelect) {
    routeSelect.addEventListener('change', async () => {
      if (routeSelect.value) {
        // Reset other filters
        if (vesselSelect) vesselSelect.value = 'all_vessels';
        if (demandMaxSelect) demandMaxSelect.value = '';
        if (demandCurrentSelect) demandCurrentSelect.value = '';
      }
      // Use setRouteFilter to properly open the route vessels panel
      await setRouteFilter(routeSelect.value);
    });
  }

  // Vessel filter - resets route and demand filters
  if (vesselSelect) {
    vesselSelect.addEventListener('change', async () => {
      if (vesselSelect.value &amp;&amp; vesselSelect.value !== 'all_vessels') {
        // Reset other filters
        if (routeSelect) routeSelect.value = '';
        if (demandMaxSelect) demandMaxSelect.value = '';
        if (demandCurrentSelect) demandCurrentSelect.value = '';
      }
      await applyFilterModalSelections();
    });
  }

  // Demand Max filter - resets route, vessel, and other demand filter
  if (demandMaxSelect) {
    demandMaxSelect.addEventListener('change', async () => {
      if (demandMaxSelect.value) {
        // Reset other filters
        if (routeSelect) routeSelect.value = '';
        if (vesselSelect) vesselSelect.value = 'all_vessels';
        if (demandCurrentSelect) demandCurrentSelect.value = '';
      }
      await applyFilterModalSelections();
    });
  }

  // Demand Current filter - resets route, vessel, and other demand filter
  if (demandCurrentSelect) {
    demandCurrentSelect.addEventListener('change', async () => {
      if (demandCurrentSelect.value) {
        // Reset other filters
        if (routeSelect) routeSelect.value = '';
        if (vesselSelect) vesselSelect.value = 'all_vessels';
        if (demandMaxSelect) demandMaxSelect.value = '';
      }
      await applyFilterModalSelections();
    });
  }
}

/**
 * Handles filter modal drag movement.
 *
 * @param {MouseEvent} e - Mouse event
 */
function onFilterModalDrag(e) {
  if (!filterModalDragging) return;

  const modal = document.getElementById('harborFilterModal');
  if (!modal) return;

  const x = e.clientX - filterModalDragOffset.x;
  const y = e.clientY - filterModalDragOffset.y;

  modal.style.left = x + 'px';
  modal.style.top = y + 'px';
  modal.style.transform = 'none';
}

/**
 * Handles filter modal drag end.
 */
function onFilterModalDragEnd() {
  filterModalDragging = false;

  const modal = document.getElementById('harborFilterModal');
  if (modal) {
    modal.classList.remove('dragging');
  }

  document.removeEventListener('mousemove', onFilterModalDrag);
  document.removeEventListener('mouseup', onFilterModalDragEnd);
}

/**
 * Applies the current filter modal selections and updates the map.
 *
 * @returns {Promise&lt;void>}
 */
async function applyFilterModalSelections() {
  // Read values from modal dropdowns
  const routeValue = document.getElementById('harborFilterRoute')?.value || '';
  const vesselValue = document.getElementById('harborFilterVessel')?.value || 'all_vessels';
  const portScopeValue = document.getElementById('harborFilterPortScope')?.value || 'my_ports';
  const demandMaxValue = document.getElementById('harborFilterDemandMax')?.value || '';
  const demandCurrentValue = document.getElementById('harborFilterDemandCurrent')?.value || '';

  // Update state and localStorage
  currentRouteFilter = routeValue || null;
  currentVesselFilter = vesselValue;
  currentPortScope = portScopeValue;
  currentPortFilter = portScopeValue; // Keep currentPortFilter in sync with currentPortScope
  currentDemandMaxFilter = demandMaxValue;
  currentDemandCurrentFilter = demandCurrentValue;

  if (currentRouteFilter) {
    localStorage.setItem('harborMapRouteFilter', currentRouteFilter);
  } else {
    localStorage.removeItem('harborMapRouteFilter');
  }
  localStorage.setItem('harborMapVesselFilter', currentVesselFilter);
  localStorage.setItem('harborMapPortScope', currentPortScope);
  localStorage.setItem('harborMapPortFilter', currentPortFilter);
  localStorage.setItem('harborMapDemandMax', currentDemandMaxFilter);
  localStorage.setItem('harborMapDemandCurrent', currentDemandCurrentFilter);

  logger.debug('[Harbor Map] Filter modal applied - Route:', currentRouteFilter, 'Vessel:', currentVesselFilter);
  logger.debug('[Harbor Map] Port Scope:', currentPortScope, 'Demand Max:', currentDemandMaxFilter, 'Demand Current:', currentDemandCurrentFilter);

  // Close panels and apply filters
  await closeAllPanels();
  selectedVesselId = null;
  selectedPortCode = null;
  await applyFiltersAndRender();
}

/**
 * Resets all filters to default values.
 *
 * @returns {Promise&lt;void>}
 */
async function resetAllFilters() {
  // Reset all filter states
  currentRouteFilter = null;
  currentVesselFilter = 'all_vessels';
  currentPortScope = 'my_ports';
  currentPortFilter = 'my_ports';
  currentDemandMaxFilter = '';
  currentDemandCurrentFilter = '';

  // Update localStorage
  localStorage.removeItem('harborMapRouteFilter');
  localStorage.setItem('harborMapVesselFilter', currentVesselFilter);
  localStorage.setItem('harborMapPortScope', currentPortScope);
  localStorage.setItem('harborMapPortFilter', currentPortFilter);
  localStorage.setItem('harborMapDemandMax', '');
  localStorage.setItem('harborMapDemandCurrent', '');

  logger.debug('[Harbor Map] All filters reset to defaults');

  // Close panels and apply filters
  await closeAllPanels();
  selectedVesselId = null;
  selectedPortCode = null;
  await applyFiltersAndRender();
}

/**
 * Applies current filters to raw data and renders the result
 * NO API calls - pure client-side filtering
 *
 * @returns {Promise&lt;void>}
 */
async function applyFiltersAndRender(forceRender = false) {
  // IMPORTANT: Re-read filter values from localStorage to ensure they're up to date
  // This prevents filter state loss during automatic refreshes
  currentVesselFilter = localStorage.getItem('harborMapVesselFilter') || 'all_vessels';
  currentPortScope = localStorage.getItem('harborMapPortScope') || 'my_ports';
  currentPortFilter = localStorage.getItem('harborMapPortFilter') || 'my_ports';
  currentDemandMaxFilter = localStorage.getItem('harborMapDemandMax') || '';
  currentDemandCurrentFilter = localStorage.getItem('harborMapDemandCurrent') || '';

  // Sync modal dropdown values with current filter state (if modal is open)
  const harborFilterVessel = document.getElementById('harborFilterVessel');
  if (harborFilterVessel &amp;&amp; harborFilterVessel.value !== currentVesselFilter) {
    harborFilterVessel.value = currentVesselFilter;
  }

  const harborFilterPortScope = document.getElementById('harborFilterPortScope');
  if (harborFilterPortScope &amp;&amp; harborFilterPortScope.value !== currentPortScope) {
    harborFilterPortScope.value = currentPortScope;
  }

  // Debug: Check raw data
  const assignedPortsCount = rawPorts.filter(p => p.isAssigned === true).length;
  console.log(`[Harbor Map] Raw data - Total Ports: ${rawPorts.length}, Assigned Ports: ${assignedPortsCount}, Total Vessels: ${rawVessels.length}`);

  // Debug: Show first port structure
  if (rawPorts.length > 0) {
    console.log(`[Harbor Map] Sample port:`, rawPorts[0]);
  }

  // Apply vessel filter
  let filteredVessels = filterVessels(rawVessels, currentVesselFilter);

  // Determine active demand filter (only one can be active at a time)
  const activeDemandFilter = currentDemandMaxFilter || currentDemandCurrentFilter;

  // Apply port filter FIRST, then demand filter on top
  // Both filters are combined (AND logic) - port filter narrows down, demand filter narrows further
  let filteredPorts = filterPorts(rawPorts, rawVessels, currentPortFilter);
  console.log(`[Harbor Map] Applied port filter: ${currentPortFilter} -> ${filteredPorts.length} ports`);

  if (activeDemandFilter) {
    // Apply demand filter on already-filtered ports
    filteredPorts = applyDemandFilter(filteredPorts, activeDemandFilter);
    console.log(`[Harbor Map] Applied demand filter: ${activeDemandFilter} -> ${filteredPorts.length} ports`);
  }

  console.log(`[Harbor Map] Applied filters - Vessel Filter: ${currentVesselFilter}, Port Filter: ${currentPortFilter}`);
  console.log(`[Harbor Map] Filtered results - Vessels: ${filteredVessels.length}/${rawVessels.length}, Ports: ${filteredPorts.length}/${rawPorts.length}`);

  // Store filtered data for route filtering
  currentVessels = filteredVessels;
  currentPorts = filteredPorts;

  // Update route dropdown
  updateRouteDropdown();

  // Check if there's an active selection (any panel open on the map)
  const vesselPanelOpen = document.getElementById('vessel-detail-panel')?.classList.contains('active');
  const portPanelOpen = document.getElementById('port-detail-panel')?.classList.contains('active');
  const routePanelOpen = document.getElementById('route-vessels-panel')?.classList.contains('active');
  const routePlannerOpen = document.getElementById('routePlannerPanel') &amp;&amp;
                           !document.getElementById('routePlannerPanel').classList.contains('hidden');
  const departManagerOpen = document.getElementById('departManagerPanel') &amp;&amp;
                            !document.getElementById('departManagerPanel').classList.contains('hidden');
  const hasActiveSelection = selectedVesselId !== null || selectedPortCode !== null ||
                             vesselPanelOpen || portPanelOpen || routePanelOpen ||
                             routePlannerOpen || departManagerOpen;

  if (hasActiveSelection &amp;&amp; !forceRender) {
    logger.debug('[Harbor Map] Active selection detected - skipping render to preserve current view');

    // IMPORTANT: Update previousMapState with filtered data
    // This ensures when user closes panel, it shows the CURRENT filter, not the old one
    previousMapState.vessels = [...filteredVessels];
    previousMapState.ports = [...filteredPorts];

    // Raw data and filters are updated in background, but DON'T re-render map or reset selection
    // This allows background data refresh without disrupting user's current view
    return;
  }

  // Apply route filter if active (using port-pair groups)
  let vesselsToRender = currentVessels;
  let portPairGroup = null;

  if (currentRouteFilter &amp;&amp; currentPortPairGroups &amp;&amp; currentPortPairGroups.groups) {
    portPairGroup = currentPortPairGroups.groups.find(g => g.pairKey === currentRouteFilter);
    if (portPairGroup) {
      const vesselIds = new Set(portPairGroup.vessels.map(v => v.id));
      vesselsToRender = rawVessels.filter(v => vesselIds.has(v.id));
    }
  }

  // Clear all cluster groups before rendering
  vesselClusterGroup.clearLayers();
  portLocationClusterGroup.clearLayers();

  // If route filter is active, restore full route visualization
  if (currentRouteFilter &amp;&amp; portPairGroup &amp;&amp; vesselsToRender.length > 0) {
    const portA = portPairGroup.portA;
    const portB = portPairGroup.portB;

    // Filter ports to show only origin and destination
    const routePorts = rawPorts.filter(p => p.code === portA || p.code === portB);

    // Render vessels and route ports
    renderVessels(vesselsToRender);
    renderPorts(routePorts);

    // Try to draw route from first enroute vessel
    const enrouteVessel = vesselsToRender.find(v => v.status === 'enroute' &amp;&amp; v.active_route?.path);
    if (enrouteVessel) {
      const isReversed = enrouteVessel.active_route.reversed === true;
      const route = {
        path: isReversed
          ? enrouteVessel.active_route.path.slice().reverse()
          : enrouteVessel.active_route.path,
        origin: portA,
        destination: portB
      };
      // Draw route path (WITHOUT auto-zoom during refresh)
      drawRoute(route, currentPorts, false);
      console.log(`[Harbor Map] Route filter restored during refresh: ${portA} &lt;> ${portB}`);
    } else {
      clearRoute();
    }
  } else if (currentRouteFilter &amp;&amp; !portPairGroup) {
    // Route filter set but group not found - clear filter
    currentRouteFilter = null;
    localStorage.removeItem('harborMapRouteFilter');
    renderVessels(vesselsToRender);
    renderPorts(filteredPorts);
    clearRoute();
  } else {
    // No route filter active

    // Logic: Only show BOTH when default filters are selected
    // Whitelist for showing both vessels AND ports
    const showBothVesselFilters = ['all_vessels', 'all_my_vessels'];
    const showBothPortFilters = ['all_ports', 'my_ports'];

    const showBothVessels = showBothVesselFilters.includes(currentVesselFilter);
    const showBothPorts = showBothPortFilters.includes(currentPortFilter);

    if (!showBothVessels) {
      // Any specific vessel filter (tanker, arrived, etc.)  hide ports
      renderVessels(vesselsToRender);
      renderPorts([]);
      if (window.DEBUG_MODE) console.log(`[Harbor Map] Vessel filter "${currentVesselFilter}" active - hiding ports`);
    } else if (!showBothPorts) {
      // Any specific port filter  hide vessels
      renderVessels([]);
      renderPorts(filteredPorts);
      if (window.DEBUG_MODE) console.log(`[Harbor Map] Port filter "${currentPortFilter}" active - hiding vessels`);
    } else {
      // Both on default (all_vessels/all_my_vessels + all_ports/my_ports)  show both
      renderVessels(vesselsToRender);
      renderPorts(filteredPorts);
    }

    clearRoute();
  }

  // Reset selection state
  selectedVesselId = null;
  selectedPortCode = null;

  hideVesselPanel();
  hidePortPanel();
}

/**
 * Loads and renders harbor map overview
 * Fetches ALL data once, then applies filters client-side
 *
 * @returns {Promise&lt;void>}
 * @example
 * await loadOverview();
 */
export async function loadOverview() {
  try {
    // Always use cached data only
    const cachedData = getCachedOverview();

    if (cachedData) {
      logger.debug('[Harbor Map] Loading from cache (no API call)');

      // Store RAW data (unfiltered)
      rawVessels = cachedData.vessels;
      rawPorts = cachedData.ports;
      currentPortPairGroups = cachedData.portPairGroups;

      // Apply filters client-side
      await applyFiltersAndRender();
      return;
    }

    // No cache available - fetch ALL data once (no filter parameter)
    logger.debug('[Harbor Map] No cache available, fetching ALL data...');
    const data = await fetchHarborMapOverview('all_ports');

    logger.debug('[Harbor Map] Overview data:', {
      vessels: data.vessels.length,
      ports: data.ports.length,
      sampleVessel: data.vessels[0]
    });

    // Store RAW data (unfiltered)
    rawVessels = data.vessels;
    rawPorts = data.ports;
    currentPortPairGroups = data.portPairGroups;

    // Apply filters client-side
    await applyFiltersAndRender();
  } catch (error) {
    console.error('Error loading harbor map overview:', error);
  }
}

/**
 * Closes all open panels (vessel, port, route)
 * Ensures only one panel is open at a time
 * Only hides panels, does NOT remove fullscreen or deselect
 * This allows seamless panel transitions without fullscreen flicker
 * @returns {Promise&lt;void>}
 */
export async function closeAllPanels() {
  // Close weather popup
  if (map) {
    map.closePopup();
  }

  // Only HIDE panels (don't remove fullscreen or call deselectAll)
  // This keeps fullscreen active during panel transitions
  hideVesselPanel();
  hidePortPanel();
  hideRoutePanel();
}

/**
 * Selects a vessel and shows reachable ports
 * Hides other vessels, draws route, shows vessel panel
 *
 * @param {number} vesselId - Vessel ID to select
 * @returns {Promise&lt;void>}
 * @example
 * await selectVessel(1234);
 */
export async function selectVessel(vesselId) {
  try {
    // Save current state BEFORE making changes
    previousMapState = {
      vessels: [...currentVessels],
      ports: [...currentPorts],
      zoom: map.getZoom(),
      center: map.getCenter()
    };

    selectedVesselId = vesselId;
    selectedPortCode = null;

    // PROGRESSIVE LOADING: Show vessel immediately with cached data
    const vessel = rawVessels.find(v => v.id === vesselId);
    if (!vessel) {
      console.error(`[Harbor Map] Vessel ${vesselId} not found in rawVessels`);
      return;
    }

    console.log(`[Harbor Map] Vessel ${vesselId} selected - showing immediately from cache`, {
      vesselName: vessel.name,
      status: vessel.status,
      hasActiveRoute: !!vessel.active_route,
      hasRoutesArray: !!(vessel.routes &amp;&amp; vessel.routes.length > 0),
      activeRoutePathLength: vessel.active_route?.path?.length || 0,
      routesArrayPathLength: vessel.routes?.[0]?.path?.length || 0,
      routeOrigin: vessel.active_route?.origin || vessel.routes?.[0]?.origin || vessel.route_origin,
      routeDestination: vessel.active_route?.destination || vessel.routes?.[0]?.destination || vessel.route_destination,
      routeName: vessel.route_name,
      shouldShowRoute: vessel.status === 'enroute'
    });

    // Close all panels first to avoid conflicts
    await closeAllPanels();

    // Clear ALL markers (vessels and ports)
    vesselClusterGroup.clearLayers();
    portLocationClusterGroup.clearLayers();
    clearRoute();

    // If vessel has any route data in cache, draw it immediately
    let cachedRoute = null;

    // Check for route in different possible locations
    if (vessel.active_route &amp;&amp; vessel.active_route.path &amp;&amp; vessel.active_route.path.length > 0) {
      cachedRoute = vessel.active_route;
    } else if (vessel.routes &amp;&amp; vessel.routes[0] &amp;&amp; vessel.routes[0].path &amp;&amp; vessel.routes[0].path.length > 0) {
      cachedRoute = vessel.routes[0];
    }

    // If we found a route, draw it immediately (regardless of status - let the data decide)
    if (cachedRoute) {
      console.log(`[Harbor Map] Drawing cached route immediately for vessel ${vesselId}:`, {
        vesselStatus: vessel.status,
        pathPoints: cachedRoute.path.length,
        origin: cachedRoute.origin || vessel.route_origin,
        destination: cachedRoute.destination || vessel.route_destination
      });
      drawRoute(cachedRoute, currentPorts, false);
    }

    // Render ONLY the selected vessel on the map (from cache)
    if (vessel &amp;&amp; vessel.position) {
      const vesselType = getVesselType(vessel.capacity_type);
      let heading = 0;

      // Calculate heading from active_route if available
      if (vessel.active_route &amp;&amp; vessel.active_route.path &amp;&amp; vessel.active_route.path.length >= 2) {
        const isReversed = vessel.active_route.reversed === true;
        const path = isReversed
          ? vessel.active_route.path.slice().reverse()
          : vessel.active_route.path;

        // Find current position in path - use closest point approach (same as initial rendering)
        let bestIndex = -1;
        let bestDist = Infinity;
        for (let i = 0; i &lt; path.length - 1; i++) {
          const point = path[i];
          const dist = Math.abs(point.lat - vessel.position.lat) + Math.abs(point.lon - vessel.position.lon);
          if (dist &lt; bestDist) {
            bestDist = dist;
            bestIndex = i;
          }
        }

        if (bestIndex >= 0 &amp;&amp; bestIndex &lt; path.length - 1) {
          // Find next significantly different point (skip duplicates)
          let nextIndex = bestIndex + 1;
          while (nextIndex &lt; path.length - 1) {
            const nextPoint = path[nextIndex];
            const dist = Math.abs(nextPoint.lat - path[bestIndex].lat) + Math.abs(nextPoint.lon - path[bestIndex].lon);
            if (dist > 0.001) break;
            nextIndex++;
          }
          heading = calculateHeading(path[bestIndex], path[nextIndex]);
        }
      }

      const icon = createVesselIcon(vessel.status, vesselType, heading);
      const vesselMarker = L.marker([vessel.position.lat, vessel.position.lon], { icon });

      if (vessel.status === 'port' || vessel.status === 'anchor') {
        portLocationClusterGroup.addLayer(vesselMarker);
      } else {
        vesselClusterGroup.addLayer(vesselMarker);
      }
    }

    // Show vessel panel IMMEDIATELY with cached data
    showVesselPanel(vessel);

    // If we already drew a cached route, just zoom to it without waiting for API
    if (cachedRoute) {
      console.log(`[Harbor Map] Route already drawn from cache, zooming immediately`);

      // Zoom to cached route bounds
      const isMobile = isMobileDevice();
      const bounds = L.latLngBounds();
      cachedRoute.path.forEach(p => {
        if (p &amp;&amp; p.lat &amp;&amp; p.lon) {
          bounds.extend([p.lat, p.lon]);
        }
      });

      if (bounds.isValid()) {
        if (isMobile) {
          map.fitBounds(bounds, {
            paddingTopLeft: [20, 80],
            paddingBottomRight: [20, 450],
            maxZoom: 2
          });
        } else {
          map.fitBounds(bounds, {
            paddingTopLeft: [20, 20],
            paddingBottomRight: [420, 20],
            maxZoom: 6
          });
        }
      }

      // Fire-and-forget: fetch reachable ports in background for future use (don't await)
      fetchVesselReachablePorts(vesselId).then(() => {
        console.log(`[Harbor Map] Background fetch completed for vessel ${vesselId}`);
      }).catch(err => {
        console.warn(`[Harbor Map] Background fetch failed for vessel ${vesselId}:`, err.message);
      });

      return; // Done - route already shown from cache
    }

    // No cached route - need to fetch from API
    console.log(`[Harbor Map] No cached route, fetching from API for vessel ${vesselId}...`);
    let data = null;
    try {
      data = await fetchVesselReachablePorts(vesselId);
      console.log(`[Harbor Map] Reachable ports loaded:`, {
        vesselId,
        vesselStatus: vessel.status,
        reachablePorts: data.reachablePorts ? data.reachablePorts.length : 0,
        hasRoute: !!data.route
      });
    } catch (error) {
      console.error(`[Harbor Map] Failed to fetch reachable ports for vessel ${vesselId}:`, error);
      if (vessel.status !== 'enroute') {
        // No route needed for vessels not enroute
        data = {
          vessel,
          reachablePorts: [],
          route: null
        };
      } else {
        console.warn(`[Harbor Map] No route data available for enroute vessel ${vesselId}`);
        return;
      }
    }

    // Draw route if vessel has one
    if (data &amp;&amp; data.route &amp;&amp; data.route.path &amp;&amp; data.route.path.length > 0) {
      const portsForDemand = data.assignedPorts || data.allPorts || currentPorts;
      drawRoute(data.route, portsForDemand, false);
    } else if (data &amp;&amp; (data.vessel.status === 'port' || data.vessel.status === 'anchor')) {
      // Vessel in port - try to show assigned route if available
      if (data.route &amp;&amp; (data.route.origin || data.route.origin_port_code) &amp;&amp; (data.route.destination || data.route.destination_port_code)) {
        const routeOrigin = data.route.origin || data.route.origin_port_code;
        const routeDestination = data.route.destination || data.route.destination_port_code;
        const portsForRoute = data.assignedPorts || data.allPorts || currentPorts || rawPorts;
        drawRoute(data.route, portsForRoute, false);

        const originPortData = portsForRoute.find(p => p.code === routeOrigin);
        const destPortData = portsForRoute.find(p => p.code === routeDestination);
        const routePorts = [originPortData, destPortData].filter(Boolean);
        if (routePorts.length > 0) {
          renderPorts(routePorts);
        }
      } else if (data.reachablePorts &amp;&amp; data.reachablePorts.length >= 2 &amp;&amp; data.vessel.port_code) {
        const currentPortCode = data.vessel.port_code;
        const otherPort = data.reachablePorts.find(p => p.code !== currentPortCode);
        if (otherPort) {
          const routeToShow = {
            origin: currentPortCode,
            destination: otherPort.code,
            path: []
          };
          drawRoute(routeToShow, data.reachablePorts, false);
          renderPorts(data.reachablePorts);
        }
      } else if (data.vessel.port_code) {
        const currentPort = data.reachablePorts?.find(p => p.code === data.vessel.port_code) ||
                           currentPorts.find(p => p.code === data.vessel.port_code);
        if (currentPort) {
          renderPorts([currentPort]);
        }
      }
    }

    // Zoom to show route
    const isMobile = isMobileDevice();

    if (data.route &amp;&amp; data.route.path &amp;&amp; data.route.path.length > 0) {
      const bounds = L.latLngBounds();
      data.route.path.forEach(p => {
        if (p &amp;&amp; p.lat &amp;&amp; p.lon) {
          bounds.extend([p.lat, p.lon]);
        }
      });

      // Only fit bounds if they are valid (have at least one point)
      if (bounds.isValid()) {
        if (isMobile) {
          map.fitBounds(bounds, {
            paddingTopLeft: [20, 80],
            paddingBottomRight: [20, 450],
            maxZoom: 2 // Allow very wide zoom out for intercontinental routes
          });
        } else {
          map.fitBounds(bounds, {
            paddingTopLeft: [50, 50],
            paddingBottomRight: [300, 50] // More padding for panel + dragging space
          });
        }
      } else {
        console.warn('[Harbor Map] Route bounds are not valid, skipping zoom');
      }
    } else if (data.reachablePorts &amp;&amp; data.reachablePorts.length > 0) {
      // Fallback: fit all reachable ports if no route
      const bounds = L.latLngBounds();
      data.reachablePorts.forEach(port => {
        if (port &amp;&amp; port.lat &amp;&amp; port.lon) {
          bounds.extend([parseFloat(port.lat), parseFloat(port.lon)]);
        }
      });

      // Only fit bounds if they are valid (have at least one point)
      if (bounds.isValid()) {
        if (isMobile) {
          map.fitBounds(bounds, {
            paddingTopLeft: [20, 80],
            paddingBottomRight: [20, 450],
            maxZoom: 2 // Allow very wide zoom out for intercontinental routes
          });
        } else {
          map.fitBounds(bounds, {
            paddingTopLeft: [50, 50],
            paddingBottomRight: [300, 50] // More padding for panel + dragging space
          });
        }
      } else {
        console.warn('[Harbor Map] Reachable ports bounds are not valid, skipping zoom');
      }
    } else if (data.vessel &amp;&amp; data.vessel.position) {
      // Fallback: center on vessel if no route or ports
      map.setView([data.vessel.position.lat, data.vessel.position.lon], map.getZoom(), {
        animate: true,
        duration: 0.5,
        paddingTopLeft: [50, 50],
        paddingBottomRight: [325, 50] // 275px panel + 50px padding
      });
    }

    // Vessel panel already shown with cached data - update with reachable ports if needed
    // (Panel might need reachable ports data for some features)
  } catch (error) {
    console.error(`Error selecting vessel ${vesselId}:`, error);
  }
}

/**
 * Categorizes all vessels by their relationship to a specific port (CLIENT-SIDE)
 * Replicates backend logic from harbor-map-aggregator.js
 * Splits vessels into four categories: in port, heading to, coming from, pending
 *
 * @param {string} portCode - Port code to categorize vessels for
 * @param {Array&lt;Object>} allVessels - All user vessels from rawVessels
 * @returns {Object} { inPort: [], toPort: [], fromPort: [], pending: [] }
 * @example
 * const categorized = categorizeVesselsByPortClientSide('boston_us', rawVessels);
 * // Returns: { inPort: [v1, v2], toPort: [v3], fromPort: [v4, v5], pending: [v6] }
 */
function categorizeVesselsByPortClientSide(portCode, allVessels) {
  const inPort = [];
  const toPort = [];
  const fromPort = [];
  const pending = [];

  allVessels.forEach(vessel => {
    // Vessels being built/delivered (pending status)
    if ((vessel.status === 'pending' || vessel.status === 'delivery') &amp;&amp; vessel.current_port_code === portCode) {
      pending.push(vessel);
    }
    // Vessels currently in port
    else if (vessel.current_port_code === portCode &amp;&amp; vessel.status !== 'enroute') {
      inPort.push(vessel);
    }
    // Vessels heading to port (check both field names for compatibility)
    else if (vessel.status === 'enroute' &amp;&amp;
             (vessel.active_route?.destination === portCode || vessel.active_route?.destination_port_code === portCode)) {
      toPort.push(vessel);
    }
    // Vessels coming from port (check both field names for compatibility)
    else if (vessel.status === 'enroute' &amp;&amp;
             (vessel.active_route?.origin === portCode || vessel.active_route?.origin_port_code === portCode)) {
      fromPort.push(vessel);
    }
  });

  console.log(`[Harbor Map] Client-side categorization for port ${portCode}:`, {
    inPort: inPort.length,
    toPort: toPort.length,
    fromPort: fromPort.length,
    pending: pending.length
  });

  return { inPort, toPort, fromPort, pending };
}

/**
 * Selects a port and shows categorized vessels
 * Shows port panel with vessels in/to/from port
 *
 * @param {string} portCode - Port code to select
 * @returns {Promise&lt;void>}
 * @example
 * await selectPort('AUBNE');
 */
export async function selectPort(portCode) {
  try {
    // Save current state BEFORE making changes
    previousMapState = {
      vessels: [...currentVessels],
      ports: [...currentPorts],
      zoom: map.getZoom(),
      center: map.getCenter()
    };

    console.log(`[Harbor Map] Port ${portCode} clicked`);
    selectedPortCode = portCode;
    selectedVesselId = null;

    // If planning mode is active, select port for route AND show port panel (but don't change zoom/markers)
    if (window.harborMap &amp;&amp; window.harborMap.isPlanningMode &amp;&amp; window.harborMap.isPlanningMode()) {
      console.log(`[Harbor Map] Planning mode active, selecting port for route: ${portCode}`);
      window.harborMap.selectPortForRoute(portCode);

      // Also show port panel so user can see port details
      const port = rawPorts.find(p => p.code === portCode);
      if (port) {
        const vessels = categorizeVesselsByPortClientSide(portCode, rawVessels);
        showPortPanel(port, vessels);
      }
      return;
    }

    // CLIENT-SIDE DATA LOADING (no API call needed!)
    // Find port in rawPorts
    const port = rawPorts.find(p => p.code === portCode);
    if (!port) {
      console.error(`[Harbor Map] Port ${portCode} not found in rawPorts`);
      return;
    }

    // Categorize vessels using client-side function
    const vessels = categorizeVesselsByPortClientSide(portCode, rawVessels);

    console.log(`[Harbor Map] Port data loaded from cache (0ms):`, {
      port: port.code,
      hasDemand: !!port.demand,
      vessels: {
        inPort: vessels.inPort.length,
        toPort: vessels.toPort.length,
        fromPort: vessels.fromPort.length,
        pending: vessels.pending.length
      }
    });

    // Close all panels first
    await closeAllPanels();

    // Clear ALL markers
    vesselClusterGroup.clearLayers();
    portLocationClusterGroup.clearLayers();
    clearRoute();

    // Render ONLY the selected port
    renderPorts([port]);

    // Collect ALL vessels related to this port (in, to, from)
    const allRelatedVessels = [
      ...vessels.inPort,
      ...vessels.toPort,
      ...vessels.fromPort
    ];

    // Render ONLY the related vessels
    renderVessels(allRelatedVessels);

    // Zoom to fit port + all related vessels
    const isMobile = isMobileDevice();
    const bounds = L.latLngBounds();

    // Add port to bounds
    if (port.lat &amp;&amp; port.lon) {
      bounds.extend([port.lat, port.lon]);
    }

    // Add all vessels to bounds
    allRelatedVessels.forEach(vessel => {
      if (vessel.position &amp;&amp; vessel.position.lat &amp;&amp; vessel.position.lon) {
        bounds.extend([vessel.position.lat, vessel.position.lon]);
      }
    });

    // Fit bounds with appropriate padding
    if (bounds.isValid()) {
      if (isMobile) {
        map.fitBounds(bounds, {
          paddingTopLeft: [20, 80],
          paddingBottomRight: [20, 450],
          maxZoom: 2 // Allow very wide zoom out for intercontinental routes
        });
      } else {
        map.fitBounds(bounds, {
          paddingTopLeft: [50, 50],
          paddingBottomRight: [300, 50] // More padding for panel + dragging space
        });
      }
    }

    // Show port panel
    showPortPanel(port, vessels);

    // Fetch demand data asynchronously (port data from overview doesn't include demand)
    if (window.harborMap &amp;&amp; window.harborMap.fetchAndUpdatePortDemand) {
      window.harborMap.fetchAndUpdatePortDemand(portCode);
    }
  } catch (error) {
    console.error(`Error selecting port ${portCode}:`, error);
  }
}

/**
 * Deselects current selection and returns to overview
 *
 * @returns {Promise&lt;void>}
 * @example
 * await deselectAll();
 */
export async function deselectAll() {
  // Reset selection state
  selectedVesselId = null;
  selectedPortCode = null;

  // Clear current markers
  vesselClusterGroup.clearLayers();
  portLocationClusterGroup.clearLayers();
  clearRoute();

  // Clear previous state
  previousMapState = {
    vessels: [],
    ports: [],
    zoom: null,
    center: null
  };

  // IMPORTANT: Always use applyFiltersAndRender() to ensure filters are applied
  // This ensures that the current filter selection is respected when closing panels
  // forceRender=true bypasses the active selection check (prevents race condition with panel close)
  await applyFiltersAndRender(true);

  // Always center map at default zoom (1.8) when closing panels
  const defaultZoom = 1.8;
  const defaultCenter = [20, 0];

  map.setView(defaultCenter, defaultZoom, {
    animate: true,
    duration: 0.5
  });
}

/**
 * Gets the currently selected port code
 *
 * @returns {string|null} Port code or null if no port selected
 * @example
 * const portCode = getSelectedPortCode();
 */
export function getSelectedPortCode() {
  return selectedPortCode;
}

/**
 * Updates weather data setting and applies changes immediately to the map
 * WITHOUT reloading the entire map
 *
 * @param {boolean} enabled - Whether weather data should be enabled
 * @returns {void}
 */
export function updateWeatherDataSetting(enabled) {
  // This function is called when settings change
  // Weather controls are only initialized/removed on page load (not dynamically)
  // User must reload page for changes to take effect
  logger.debug('[Harbor Map] Weather data setting updated to:', enabled, '(reload required)');
}

/**
 * Gets a vessel by ID from current vessels cache
 *
 * @param {number} vesselId - Vessel ID to find
 * @returns {Promise&lt;Object|null>} Vessel object or null if not found
 * @example
 * const vessel = await getVesselById(1234);
 */
export async function getVesselById(vesselId, skipCache = false) {
  // If skipCache is false, try to find in current cache first
  if (!skipCache) {
    const cachedVessel = currentVessels.find(v => v.id === vesselId);
    if (cachedVessel) {
      return cachedVessel;
    }
  }

  // Refresh overview from server with cache-busting timestamp
  try {
    const timestamp = Date.now();
    const response = await fetch(window.apiUrl(`/api/harbor-map/overview?filter=all_ports&amp;_=${timestamp}`));

    if (!response.ok) {
      throw new Error(`Failed to fetch harbor map overview: ${response.statusText}`);
    }

    const overview = await response.json();
    currentVessels = overview.vessels || [];
    currentPorts = overview.ports || [];

    console.log(`[Harbor Map] Fetched fresh data from server, found ${currentVessels.length} vessels`);

    return currentVessels.find(v => v.id === vesselId) || null;
  } catch (error) {
    console.error('[Harbor Map] Failed to get vessel by ID:', error);
    return null;
  }
}

/**
 * Updates a single vessel marker on the map without full refresh
 *
 * @param {number} vesselId - Vessel ID to update
 * @returns {Promise&lt;void>}
 * @example
 * await updateVesselMarker(1234);
 */
export async function updateVesselMarker(vesselId) {
  const vessel = await getVesselById(vesselId);
  if (!vessel) {
    console.warn('[Harbor Map] Vessel not found for marker update:', vesselId);
    return;
  }

  // Re-render all vessels to update the marker
  // This keeps the vessel visible on the map with updated status
  renderVessels(currentVessels);
  logger.debug('[Harbor Map] Vessel marker updated:', vesselId);
}

/**
 * Updates the route dropdown with port-pair groups
 * Groups vessels by origin&lt;>destination port pairs (e.g., "DE HAM &lt;> US NYC")
 *
 * @returns {void}
 * @example
 * updateRouteDropdown();
 */
function updateRouteDropdown() {
  // Route dropdown is now in the filter modal (harborFilterRoute)
  // This function updates the route data but the modal populates its own dropdowns
  // We just need to validate the current route filter is still valid

  // Use port-pair groups from API response
  if (!currentPortPairGroups || !currentPortPairGroups.groups) {
    logger.debug('[Harbor Map] No port-pair groups available');
    return;
  }

  const groups = currentPortPairGroups.groups;
  console.log(`[Harbor Map] Found ${groups.length} port-pair groups`);

  // Validate current route filter still exists
  const pairKeys = groups.map(g => g.pairKey);
  if (currentRouteFilter &amp;&amp; !pairKeys.includes(currentRouteFilter)) {
    currentRouteFilter = null;
    localStorage.removeItem('harborMapRouteFilter');
    logger.debug('[Harbor Map] Current route filter no longer valid, resetting');
  }
}

/**
 * Sets the route filter and re-renders map with filtered vessels
 * Also opens the route vessels panel if a route is selected
 * When a port-pair is selected, draws the route path and shows only origin/destination ports
 *
 * @param {string} pairKey - Port pair key to filter by (e.g., "hamburg&lt;>new_york", empty = all routes)
 * @returns {Promise&lt;void>}
 * @example
 * await setRouteFilter('hamburg&lt;>new_york');
 */
export async function setRouteFilter(pairKey) {
  currentRouteFilter = pairKey || null;

  // Save to localStorage
  if (currentRouteFilter) {
    localStorage.setItem('harborMapRouteFilter', currentRouteFilter);
  } else {
    localStorage.removeItem('harborMapRouteFilter');
  }

  // Update the modal dropdown to reflect the new selection (if modal is open)
  const routeSelect = document.getElementById('harborFilterRoute');
  if (routeSelect &amp;&amp; routeSelect.value !== (pairKey || '')) {
    routeSelect.value = pairKey || '';
  }

  console.log(`[Harbor Map] Route filter changed to: ${currentRouteFilter || 'All Routes'}`);

  // Find the port pair group if filtering
  let portPairGroup = null;
  if (currentRouteFilter &amp;&amp; currentPortPairGroups &amp;&amp; currentPortPairGroups.groups) {
    portPairGroup = currentPortPairGroups.groups.find(g => g.pairKey === currentRouteFilter);
  }

  // Filter vessels by port pair (vessels with matching origin&lt;>destination)
  let vesselsToRender;
  if (currentRouteFilter &amp;&amp; portPairGroup) {
    // Get vessel IDs from the port pair group
    const vesselIds = new Set(portPairGroup.vessels.map(v => v.id));
    vesselsToRender = rawVessels.filter(v => vesselIds.has(v.id));
  } else {
    vesselsToRender = currentVessels;
  }

  console.log(`[Harbor Map] Rendering ${vesselsToRender.length} vessels (filtered by port pair)`);

  if (currentRouteFilter &amp;&amp; portPairGroup &amp;&amp; vesselsToRender.length > 0) {
    // Close all other panels before showing route panel
    await closeAllPanels();

    // Get port codes from the pair group
    const portA = portPairGroup.portA;
    const portB = portPairGroup.portB;

    // Filter ports to show only origin and destination
    const routePorts = rawPorts.filter(p => p.code === portA || p.code === portB);

    // Clear all markers before rendering
    vesselClusterGroup.clearLayers();
    portLocationClusterGroup.clearLayers();

    // Render vessels and route ports
    renderVessels(vesselsToRender);
    renderPorts(routePorts);

    // Try to draw route from first enroute vessel
    const enrouteVessel = vesselsToRender.find(v => v.status === 'enroute' &amp;&amp; v.active_route?.path);
    if (enrouteVessel) {
      const isReversed = enrouteVessel.active_route.reversed === true;
      const route = {
        path: isReversed
          ? enrouteVessel.active_route.path.slice().reverse()
          : enrouteVessel.active_route.path,
        origin: portA,
        destination: portB
      };
      drawRoute(route, rawPorts, true);
      console.log(`[Harbor Map] Route drawn: ${portA} &lt;> ${portB}, ${route.path.length} points`);
    } else {
      // No enroute vessel - just zoom to ports without drawing route
      clearRoute();
      console.log(`[Harbor Map] No enroute vessel for route path, showing ports: ${portA} &lt;> ${portB}`);
    }

    // Show route vessels panel with display name
    showRouteVesselsPanel(portPairGroup.displayName, vesselsToRender);
  } else if (currentRouteFilter &amp;&amp; !portPairGroup) {
    // Historical route - filter is set but no active vessels on this route
    // Parse port codes from pairKey (format: "portA&lt;>portB")
    const [portA, portB] = currentRouteFilter.split('&lt;>');

    if (portA &amp;&amp; portB) {
      console.log(`[Harbor Map] Historical route detected: ${portA} &lt;> ${portB} (no active vessels)`);

      // Close all other panels before showing route panel
      await closeAllPanels();

      // Filter ports to show only origin and destination
      const routePorts = rawPorts.filter(p => p.code === portA || p.code === portB);

      // Clear all markers before rendering
      vesselClusterGroup.clearLayers();
      portLocationClusterGroup.clearLayers();

      // Render only the route ports (no vessels)
      renderPorts(routePorts);
      clearRoute();

      // Format port names for display using game codes
      const displayName = `${toGameCode(portA)} - ${toGameCode(portB)}`;

      // Show route vessels panel with empty vessels array (will show "No vessels" message)
      showRouteVesselsPanel(`${displayName} (Historical)`, []);
    } else {
      // Invalid pairKey format - fall back to showing all
      renderVessels(vesselsToRender);
      renderPorts(currentPorts);
      clearRoute();
      hideRouteVesselsPanel();
    }
  } else {
    // No route selected - show all vessels and ports
    renderVessels(vesselsToRender);
    renderPorts(currentPorts);
    clearRoute();
    hideRouteVesselsPanel();
  }
}

/**
 * Shows the route vessels panel with a list of all vessels on the selected route
 *
 * @param {string} routeName - Name of the route
 * @param {Array&lt;Object>} vessels - Vessels on this route
 * @returns {void}
 */
async function showRouteVesselsPanel(routeName, vessels) {
  const { showRoutePanel } = await import('./route-vessels-panel.js');
  showRoutePanel(routeName, vessels);
}

/**
 * Hides the route vessels panel
 *
 * @returns {void}
 */
async function hideRouteVesselsPanel() {
  const { hideRoutePanel } = await import('./route-vessels-panel.js');
  hideRoutePanel();
}

/**
 * Highlights specific ports on the map (for route planner)
 * Shows only the specified ports, hiding all others
 *
 * @param {Array&lt;Object>} ports - Array of port objects to highlight
 * @param {number} vesselId - ID of the vessel for route planning
 * @returns {void}
 */
export function highlightPorts(ports, vesselId) {
  if (!ports || ports.length === 0) {
    console.warn('[Harbor Map] No ports to highlight');
    return;
  }

  console.log(`[Harbor Map] Highlighting ${ports.length} ports for vessel ${vesselId}`);

  // Clear existing port markers
  portLocationClusterGroup.clearLayers();

  // Find matching ports in rawPorts (to get full port data)
  const portCodes = ports.map(p => p.code || p);
  const fullPorts = rawPorts.filter(p => portCodes.includes(p.code));

  // Render only the highlighted ports
  renderPorts(fullPorts);

  // Keep the current vessel visible on the map
  if (vesselId) {
    const vessel = currentVessels.find(v => v.id === vesselId);
    if (vessel) {
      vesselClusterGroup.clearLayers();
      renderVessels([vessel]);
      console.log(`[Harbor Map] Keeping vessel ${vesselId} visible during port highlight`);
    }
  }
}

/**
 * Resets port display to show all ports (called when route planner closes)
 *
 * @returns {void}
 */
export function resetPortDisplay() {
  logger.debug('[Harbor Map] Resetting port display');

  // Clear and re-render all ports
  portLocationClusterGroup.clearLayers();
  renderPorts(currentPorts);
}

// Expose functions to window for cross-module access (analytics, route-planner)
window.harborMap = window.harborMap || {};
window.harborMap.setRouteFilter = setRouteFilter;
window.harborMap.getOverviewData = getOverviewData;
</code></pre>
        </article>
    </section>





    
</div>

<br class="clear">

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

</body>
</html>
